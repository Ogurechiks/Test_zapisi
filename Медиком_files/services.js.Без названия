"use strict";function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(r){if(Array.isArray(r))return r}function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function _regeneratorRuntime(){function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={},p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}if(this.done)throw e;for(var r=this,o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}var a=n.apply(t,e);_next(void 0)})}}function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function _regeneratorRuntime(){function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={},p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}if(this.done)throw e;for(var r=this,o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}var a=n.apply(t,e);_next(void 0)})}}function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}var BookingAppServices=angular.module("BookingApp.services",["ngResource"]);BookingAppServices.factory("eventsService",function(){return{debounce:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("EmployeesForAboutCompanyEmployee",[function(){function Employees(employees){function Employees(employees){var arr=[],$this=this;angular.forEach(employees,function(employee){var emp=new Employee(employee);$this.initEventsForEmployee(emp),arr.push(emp)}),this.data=arr}return Employees.prototype=new CreateEvent,Employees.prototype.initEventsForEmployee=function(emp){var $this=this;this.emit("initEmployee",emp),emp.on("showComment",function(comment,employee){$this.emit("showCommentForEmployee",comment,employee)}),emp.on("endShowComments",function(employee){$this.emit("endShowCommentsForEmployee",employee)})},Employees.prototype.initCompliments=function(compliments){angular.forEach(this.data,function(employee){angular.forEach(employee.ratingDescriptions,function(ratingDescription){angular.forEach(compliments,function(compliment){ratingDescription.aliasName===compliment.alias&&employee.compliments.push(Object.assign({},compliment,ratingDescription))})})})},new Employees(employees)}function Employee(employee){function Employee(employee){this.id=employee.id,this.name=employee.firstname+" "+employee.lastname,this.position=employee.position?employee.position.name:"",this.logo=employee.photo?employee.photo:"/booking/images/default-employee.png",this.rank=employee.avarageRating?employee.avarageRating:0,this.description=employee.description,this.ratingDescriptions=employee.ratingDescriptions,this.compliments=[],this.comments=[]}return Employee.prototype=new CreateEvent,Employee.prototype.addComments=function(comments){for(var i=0,len=comments.length;i<len;i++){var d=comments[i].date.split(/[^0-9]/);this.comments.push({date:new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5]),text:comments[i].clientComment,visible:"boolean"==typeof comments[i].visible&&comments[i].visible,animate:!1})}angular.forEach(this.comments,function(comment){comment.visible&&(comment.animate=!1)})},Employee.prototype.getCountVisibleComments=function(){var count=0;return angular.forEach(this.comments,function(comment){comment.visible&&count++}),count},Employee.prototype.showAllComments=function(){var i=1,$this=this;new Promise(function(resolve,reject){var isOneVisibleComment=!1;angular.forEach($this.comments,function(value,key){!1===value.visible?(isOneVisibleComment=!0,setTimeout(function(){value.visible=!0,value.animate=!0,$this.emit("showComment",value,$this),$this.comments.length-1===key&&resolve()},200*i++)):isOneVisibleComment||$this.comments.length-1!==key||resolve()})}).then(function(){$this.emit("endShowComments",$this)})},new Employee(employee)}return Employees}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("addtohomescreen",function(){var _ua=window.navigator.userAgent,obj=addToHomescreen;return obj.isAndroidBrowser=-1!=_ua.indexOf("Android")&&!/Chrome\/[.0-9]*/.test(_ua),obj.isCompatible=obj.isCompatible||obj.isAndroidBrowser,"unsupported"==obj.OS&&obj.isAndroidBrowser&&(obj.OS="android"),{addtohome:obj({autostart:!1,skipFirstVisit:!1,startDelay:0,lifespan:0,displayPace:0,privateModeOverride:!0,maxDisplayCount:0}),isCompatible:!!obj.isCompatible}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("BonusesLastOperation",[function(){function BonusesLastOperation(items){this.items={},this.isLoadBonuses=!0,this.addItems(items)}return BonusesLastOperation.prototype.addItems=function(items){for(var item in items){this.items[item]=items[item];var d=this.items[item].date.split(/[^0-9]/g);this.items[item].date=new Date(d[0],d[1]-1,d[2])}Object.keys(items).length<10&&(this.isLoadBonuses=!1)},BonusesLastOperation.prototype.getCountItems=function(){return Object.keys(this.items).length},BonusesLastOperation}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("bookingCombo",["$location","$route","ServiceCollection","EmployeeStorage","$q","$http","settings",function($location,$route,ServiceCollection,EmployeeStorage,$q,$http,settings){return{isCombo:function(){return/\/combo/g.test($location.path())},useEmployee:function(){for(var params=Object.values($route.current.params),deferred=$q.defer(),_i=0,_params=params;_i<_params.length;_i++){var param=_params[_i];if(/e\d+/g.test(param)){var employeeId=Number(param.slice(1));return EmployeeStorage.getEmployeeByID(employeeId).success(deferred.resolve),deferred.promise}}return deferred.resolve(null),deferred.promise},useServices:function(){var serviceIds=this.getServiceIds(),deferred=$q.defer();return ServiceCollection.loadForIds(serviceIds).success(function(_ref){var success=_ref.success;deferred.resolve(success)}),deferred.promise},getServiceIds:function(){for(var params=Object.values($route.current.params),_i2=0,_params2=params;_i2<_params2.length;_i2++){var param=_params2[_i2];if(/s\d+/g.test(param))return param.slice(1).split("_").map(Number)}return[]},useCombo:function(){for(var deferred=$q.defer(),id=0,_i3=0,_Object$values=Object.values($route.current.params);_i3<_Object$values.length;_i3++){var param=_Object$values[_i3];if(/i\d+/g.test(param)){id=Number(param.slice(1));break}/c[\w\d_]/g.test(param)&&(id=param.slice(1))}return id?($http.get(window.HOST+"/booking/booking/bookingCombo/",{params:{orgid:settings.ORG_ID,id:id}}).success(function(comboInformation){var services=comboInformation.services,employee=comboInformation.employee,promiseService=services&&services.length?ServiceCollection.loadForIds(services):null,promiseEmployee=employee?EmployeeStorage.getEmployeeByID(employee):null;Promise.all([promiseService,promiseEmployee]).then(function(_ref2){var _ref3=_slicedToArray(_ref2,2),responseService=_ref3[0],responseEmployee=_ref3[1];return deferred.resolve([responseService?responseService.data.success:null,responseEmployee?responseEmployee.data:null])})}),deferred.promise):null}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("BookingSteps",["$location",function($location){return{goToVisit:function(serviceList){var strServicesIds="";return angular.forEach(serviceList,function(service){strServicesIds+=service.id+","}),$location.path("/visit/"+strServicesIds.substring(0,strServicesIds.length-1)),!0}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("Cart",[function(){function isEqualItem(item1,item2){return item1.Type===item2.Type&&item1.Id===item2.Id}return{items:[],itemsCount:{},add:function(item){var count=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.check(item)&&this.delete(item),this.items.push(item),"qtyTotal"in item?count<item.qtyTotal?this.itemsCount[item.Id]=count:this.itemsCount[item.Id]=item.qtyTotal:this.itemsCount[item.Id]=count},delete:function(item){for(var i=0,len=this.items.length;i<len;i++)if(isEqualItem(this.items[i],item)){this.items.splice(i,1);break}item.Id in this.itemsCount&&delete this.itemsCount[item.Id]},updateItems:function(items){if(!this.isEmpty()){var resultItems=[],$this=this;angular.forEach(items,function(category){angular.forEach(category.commodities,function(commodity){resultItems.push(commodity)});var nextLevel=$this.treeToCollection(category);angular.forEach(nextLevel,function(child){child.haveCommodity&&angular.forEach(child.commodities,function(commodity){resultItems.push(commodity)})})}),angular.forEach(resultItems,function(item){$this.check(item)&&$this.add(item,$this.getCountItem(item))})}},addCommodityItemsByIds:function(items,ids){var resultItems=[],$this=this;angular.forEach(items,function(category){if(-2!==category.id&&-3!==category.id){angular.forEach(category.commodities,function(commodity){resultItems.push(commodity)});var nextLevel=$this.treeToCollection(category);angular.forEach(nextLevel,function(child){child.haveCommodity&&angular.forEach(child.commodities,function(commodity){resultItems.push(commodity)})})}}),angular.forEach(resultItems,function(item){angular.forEach(ids,function(id){parseInt(item.Id)===parseInt(id)&&$this.add(item,1)})})},addAbonementItemsByIds:function(items,ids){var resultItems=[],$this=this;angular.forEach(items,function(category){if(-2===category.id){angular.forEach(category.commodities,function(commodity){resultItems.push(commodity)});var nextLevel=$this.treeToCollection(category);angular.forEach(nextLevel,function(child){child.haveCommodity&&angular.forEach(child.commodities,function(commodity){resultItems.push(commodity)})})}}),angular.forEach(resultItems,function(item){angular.forEach(ids,function(id){parseInt(item.Id)===parseInt(id)&&$this.add(item,1)})})},addCertificateItemsByIds:function(items,ids){var resultItems=[],$this=this;angular.forEach(items,function(category){if(-3===category.id){angular.forEach(category.commodities,function(commodity){resultItems.push(commodity)});var nextLevel=$this.treeToCollection(category);angular.forEach(nextLevel,function(child){child.haveCommodity&&angular.forEach(child.commodities,function(commodity){resultItems.push(commodity)})})}}),angular.forEach(resultItems,function(item){angular.forEach(ids,function(id){parseInt(item.Id)===parseInt(id)&&$this.add(item,1)})})},treeToCollection:function(category){return category.oneLevelChildren=[],this.getChildren(category,category.oneLevelChildren),category.oneLevelChildren.reverse()},getChildren:function(childrenCat,mainCat){var $this=this;angular.forEach(childrenCat.children,function(value,key){$this.getChildren(value,mainCat),mainCat.push(value)})},check:function(item){for(var check=!1,i=0,len=this.items.length;i<len;i++)if(isEqualItem(this.items[i],item)){check=!0;break}return check},getSum:function(){for(var sum=0,i=0,len=this.items.length;i<len;i++)sum+=this.items[i].Sellprice*this.getCountItem(this.items[i]);return sum},getSumWithDiscount:function(){for(var item,sum=0,i=0,len=this.items.length;i<len;i++)item=this.items[i],sum+="discountSum"in item?this.getCountItem(item)*(item.Sellprice-Number(item.discountSum)):item.Sellprice*this.getCountItem(item);return sum},getSumItem:function(item){return this.getCountItem(item)*item.Sellprice},getSumItemWithDiscount:function(item){return"discountSum"in item?this.getCountItem(item)*(item.Sellprice-Number(item.discountSum)):this.getCountItem(item)*item.Sellprice},checkItemsHasDiscount:function(){for(var item,check=!1,i=0,len=this.items.length;i<len;i++)if("discountSum"in(item=this.items[i])&&item.discountSum>0){check=!0;break}return check},getAll:function(){return this.items},getAllWithCtq:function(){for(var i=0,len=this.items.length;i<len;i++)this.items[i].qty=this.getCountItem(this.items[i]);return this.items},getCount:function(){return this.items.length},getCountItem:function(item){return item.Id in this.itemsCount?this.itemsCount[item.Id]:0},increaseCountItem:function(item){item.Id in this.itemsCount&&("qtyTotal"in item?this.getCountItem(item)<item.qtyTotal?this.itemsCount[item.Id]++:this.itemsCount[item.Id]=item.qtyTotal:this.itemsCount[item.Id]++)},decreaseCountItem:function(item){this.getCountItem(item)>1&&this.itemsCount[item.Id]--},isEmpty:function(){return 0===this.getCount()},clear:function(){this.items=[],this.itemsCount={}}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("checkTile",["timeFormatter",function(timeFormatter){return{isFatter:function(masterInfo1,masterInfo2){return Object.keys(masterInfo1.servicesList).length<Object.keys(masterInfo2.servicesList).length||Object.keys(masterInfo1.servicesList).length===Object.keys(masterInfo2.servicesList).length&&masterInfo1.duration<masterInfo2.duration},buildServicesArray:function(serviceCollection){var servicesArray=[];return angular.forEach(serviceCollection,function(service){servicesArray[service.id]={duration:1*service.duration}}),servicesArray},getFatMaster:function(intervalStartMin,intervalEndMin,servicesArray,empsToServices,emps,backDirection){var fatMasterInfoTmp,local=this,fatMasterInfo={duration:0,employeeId:0,servicesList:[],nextLimitMin:intervalStartMin};return angular.forEach(emps,function(employeeIntervals,employeeID){fatMasterInfoTmp={duration:0,servicesList:[]},empsToServices&&fatMasterInfo&&empsToServices[employeeID]&&Object.keys(empsToServices[employeeID]).length>=Object.keys(fatMasterInfo.servicesList).length&&(angular.forEach(empsToServices[employeeID],function(serviceId){void 0!==servicesArray[serviceId]&&(fatMasterInfoTmp.duration+=1*servicesArray[serviceId].duration,fatMasterInfoTmp.servicesList.push(serviceId))}),angular.forEach(employeeIntervals,function(empInterval){var empStartMin=timeFormatter.stringToMinutes(empInterval.startTime),empEndMin=timeFormatter.stringToMinutes(empInterval.endTime),totalTime=0,isHole=!1;backDirection?(empEndMin<intervalEndMin&&(isHole=!0),totalTime=intervalEndMin-Math.max(empStartMin,intervalStartMin)):(empStartMin>intervalStartMin&&(isHole=!0),totalTime=Math.min(empEndMin,intervalEndMin)-intervalStartMin),!isHole&&totalTime>=fatMasterInfoTmp.duration&&local.isFatter(fatMasterInfo,fatMasterInfoTmp)&&(fatMasterInfo.duration=fatMasterInfoTmp.duration,fatMasterInfo.employeeId=employeeID,fatMasterInfo.servicesList=fatMasterInfoTmp.servicesList,fatMasterInfo.nextLimitMin=backDirection?intervalEndMin-fatMasterInfo.duration:intervalStartMin+fatMasterInfo.duration)}))}),fatMasterInfo},getMasterVisitItems:function(serviceIntervalStartMin,master,servicesArray){var visitItems=[];return angular.forEach(master.servicesList,function(serviceId){visitItems.push({employeeId:master.employeeId,serviceId:serviceId,startTime:timeFormatter.minutesToString(serviceIntervalStartMin)}),serviceIntervalStartMin+=servicesArray[serviceId].duration}),visitItems},getTileVisitItems:function(tileStartTime,servicesArray,empsToServices,emps){var visitItems=[],local=this,servicesArrayLocal=[];angular.forEach(servicesArray,function(service,serviceId){servicesArrayLocal[serviceId]=angular.copy(service)});var empsLocal=angular.copy(emps),intervalStartMin=timeFormatter.stringToMinutes(tileStartTime),intervalEndMin=intervalStartMin;angular.forEach(servicesArrayLocal,function(service){intervalEndMin+=1*service.duration});for(var limit=100;Object.keys(servicesArrayLocal).length>0&&limit>0;){var fatMasterForward=local.getFatMaster(intervalStartMin,intervalEndMin,servicesArrayLocal,empsToServices,empsLocal,!1);if(!Object.keys(fatMasterForward.servicesList).length){visitItems=[];break}var masterId=fatMasterForward.employeeId,masterVisitItems=local.getMasterVisitItems(intervalStartMin,fatMasterForward,servicesArrayLocal);intervalStartMin=fatMasterForward.nextLimitMin,visitItems=visitItems.concat(masterVisitItems),angular.forEach(masterVisitItems,function(visitItem){delete servicesArrayLocal[visitItem.serviceId]}),delete empsLocal[masterId],limit--}return limit||(visitItems=[]),visitItems}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("ClientInfo",["$http","$rootScope","settings","ServiceCollection","EmployeeStorage","CREATE_VISIT","Cart","$timeout","Loadbar","$cookies","$q","bookingCombo",function($http,$rootScope,settings,ServiceCollection,EmployeeStorage,CREATE_VISIT,Cart,$timeout,Loadbar,$cookies,$q,bookingCombo){var ClientInfo={errors:{},missingCommodities:{},hash:null,isAuth:null,currency:{},selectedClient:null,selectedEmployee:{},selectedEmployeeModal:{},selectedEmployeeModalTab:"",selectedCommodityModal:{},selectedToCartCommodityModal:{},showEmployeeModal:!1,showCommodityModal:!1,showToCartModal:!1,selectedDate:{},selectedTime:null,selectedTaps:"services",selectedCategory:null,loaderProcess:!1,isSelectedAnyEmployee:!1,showAnyEmployee:!1,goToEmployeesChangeVisit:!1,type:CREATE_VISIT,serviceCollection:ServiceCollection,calendarPage:!1,endTimeVisit:null,goToService:{},yandexMapScriptLoaded:!1,showServicesSearchModal:!1,showPaymentModal:!1,showStories_Mobile:!1,servicesData:[],storiesData:[],responseVisitData:{},paymentVisitType:"",paymentUrl:"",paymentShpIds:"",paymentSign:"",paymentSum:"",paymentInvId:"",LANG:"",HOST:"",organization:null,showNearestRecordLoader:!0,nearestRecordLoading:!1,onlyAnyEmployeeForNearestRecord:!1,updateServiceInProgress:!1,data:{proccesingOfPersonalData:!0,isCheckPhone:!0},resetSelection:function(){this.selectedTime=null,this.endTimeVisit=null,this.selectedTaps="services",this.selectedCategory=null,this.selectedDate=new Date,this.selectedEmployee={},this.type=CREATE_VISIT,ServiceCollection.clear()},resetDateTime:function(){ClientInfo.selectedDate=new Date,ClientInfo.selectedTime=null,ClientInfo.endTimeVisit=null},resetPayment:function(){ClientInfo.responseVisitData={},ClientInfo.paymentVisitType="",ClientInfo.paymentUrl="",ClientInfo.paymentShpIds="",ClientInfo.paymentSign="",ClientInfo.paymentSum="",ClientInfo.paymentInvId=""},getDurationServices:function(){return ClientInfo.serviceCollection.reduce(function(sum,item){return sum+parseInt(item.duration)},0)},getPersonalMonth:function(){var months={};return months[0]="january",months[1]="february",months[2]="march",months[3]="april",months[4]="may",months[5]="june",months[6]="july",months[7]="august",months[8]="september",months[9]="october",months[10]="november",months[11]="december",months},getPersonalMonthSm:function(){var months={};return months[0]="januarySm",months[1]="februarySm",months[2]="marchSm",months[3]="aprilSm",months[4]="maySm",months[5]="juneSm",months[6]="julySm",months[7]="augustSm",months[8]="septemberSm",months[9]="octoberSm",months[10]="novemberSm",months[11]="decemberSm",months},getPersonalDayShort:function(){var days={};return days["пн"]="mondaySm",days["вт"]="tuesdaySm",days["ср"]="wednesdaySm",days["чт"]="thursdaySm",days["пт"]="fridaySm",days["сб"]="saturdaySm",days["вс"]="sundaySm",days},getCalendarMonth:function(monthNumber){if(ClientInfo.organization)return ClientInfo.organization.personal.months[ClientInfo.getPersonalMonth()[monthNumber]]},getCalendarMonthSm:function(monthNumber){if(ClientInfo.organization)return ClientInfo.organization.personal.months[ClientInfo.getPersonalMonthSm()[monthNumber]]},getCalendarDay:function(day){if(ClientInfo.organization)return ClientInfo.organization.personal.days[ClientInfo.getPersonalDayShort()[day]]},init:function(){var sessionCookie=window.localStorage.getItem("client_session_id");if(window.HOST){var sessionCookie=window.localStorage.getItem("client_session_id");sessionCookie?($cookies.put("client_session_id",sessionCookie),document.addEventListener("deviceready",function(){$http.get(window.HOST+"/booking/client/setCookies?name=client_session_id&value="+sessionCookie,{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).then(function(){$http.get(window.HOST+"/booking/client/isAuthorization",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,sesid:sessionCookie}}).success(function(data){data?ClientInfo.login().then(function(response){$rootScope.$broadcast("ClientInfo.init",response.data)}):$rootScope.$broadcast("ClientInfo.init")}).error(function(err){Loadbar.hide()})})},!1)):$http.get(window.HOST+"/booking/client/isAuthorization",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).success(function(data){data?ClientInfo.login().then(function(response){$rootScope.$broadcast("ClientInfo.init",response.data)}):$rootScope.$broadcast("ClientInfo.init")})}window.HOST||$http.get(window.HOST+"/booking/client/isAuthorization",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,sesid:sessionCookie}}).success(function(data){data?ClientInfo.login().then(function(response){$rootScope.$broadcast("ClientInfo.init",response.data)}):$rootScope.$broadcast("ClientInfo.init")})},login:function(){ClientInfo.isAuth=!0,ClientInfo.serviceCollection=ServiceCollection;var http=ClientInfo.getClientInfo();return http.then(function(response){var data=response.data,goToNetwork=window.localStorage.getItem("goToNetwork");if(data&&data.lastOrgid&&!settings.ORG_ID&&"true"!==goToNetwork){settings.ORG_ID=data.lastOrgid;var redirectURL=window.location.origin+window.location.pathname+"?orgid="+settings.ORG_ID+"&networkid="+settings.NETWORK_ID+"#main";return window.location.assign(redirectURL)}Cart.isEmpty()||($http.get(window.HOST+"/booking/booking/getCommoditiesCategoriesList",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).success(function(data){Cart.updateItems(data)}),ServiceCollection.update()),$rootScope.$broadcast("ClientInfo.login",response.data)}),http},logout:function(){return ClientInfo.isAuth=!1,ClientInfo.data._telephone=null,ClientInfo.data.isCheckPhone=!1,ClientInfo.data.id=null,ClientInfo.data.discount=null,ClientInfo.selectedClient=null,ClientInfo.data.additionalClients=null,ClientInfo.serviceCollection=ServiceCollection,window.clearCookies&&clearCookies(),window.localStorage.removeItem("client_session_id"),$http.get(window.HOST+"/booking/client/logout",{params:{orgid:settings.ORG_ID,networkid:settings.NETWORK_ID}}).then(function(){Cart.isEmpty()||$http.get(window.HOST+"/booking/booking/getCommoditiesCategoriesList",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).success(function(data){Cart.updateItems(data)}),"stories"in ClientInfo.data&&ClientInfo.storiesData.length>0?angular.forEach(ClientInfo.storiesData,function(story){story.liked=!1,story.disliked=!1,angular.forEach(ClientInfo.data.stories,function(val,storyID){parseInt(story.id)===parseInt(storyID)&&("like"===val?story.liked=!0:"dislike"===val&&(story.disliked=!0))})}):ClientInfo.storiesData.length>0&&angular.forEach(ClientInfo.storiesData,function(story){story.liked=!1,story.disliked=!1}),ServiceCollection.update(),ClientInfo.updateServiceCollectionWithDiscounts(),$rootScope.$broadcast("ClientInfo.logout")})},skip:function(){$rootScope.$broadcast("ClientInfo.skip")},verifyCode:function(code){var http=$http.post(window.HOST+"/booking/client/verificationCode",{phone:this.data.phone,code:code,hash:this.hash},{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}});return http.then(function(response){response.data&&!ClientInfo.isAuth&&(window.localStorage.setItem("client_session_id",response.data),$http.get(window.HOST+"/booking/client/setCookies?name=client_session_id&value="+response.data,{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).then(function(){$http.get(window.HOST+"/booking/client/setCookies?name=pushID&value="+window.playerID,{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).then(function(){ClientInfo.login()})}))}),http},sendPhone:function(phone,msgType){this.data.phone=phone;var http=$http.get(window.HOST+"/booking/client/sendCode5?orgid="+settings.ORG_ID+"&networkid="+settings.NETWORK_ID+"&phone="+phone+"&msgType="+msgType);return http.then(function(response){var hash=response.data.hash;ClientInfo.hash=hash||null,hash||alert("Ошибка отправки сообщения")}).catch(function(err){console.log(err),alert("Ошибка отправки сообщения")}),http},getClientInfo:function(){var sessionCookie=window.localStorage.getItem("client_session_id");if(ClientInfo.getClientInfo.http)return ClientInfo.getClientInfo.http;var $this=this,r=function(){return $http.get(window.HOST+"/booking/booking/getClientInfo",{params:{orgid:settings.ORG_ID,networkid:settings.NETWORK_ID,sesid:sessionCookie}})};return ClientInfo.getClientInfo.http=$q(function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(resolve){return _regeneratorRuntime().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!$rootScope.clientInfoGetClientInfoAfter){_context.next=3;break}return _context.next=3,$rootScope.clientInfoGetClientInfoAfter;case 3:return _context.t0=resolve,_context.next=6,r();case 6:_context.t1=_context.sent,(0,_context.t0)(_context.t1);case 8:case"end":return _context.stop()}},_callee)}));return function(_x){return _ref.apply(this,arguments)}}()),ClientInfo.getClientInfo.http.success=ClientInfo.getClientInfo.http.then,ClientInfo.getClientInfo.http.error=ClientInfo.getClientInfo.http.catch,ClientInfo.getClientInfo.http.then(function(response){Object.assign(ClientInfo.data,response.data),ClientInfo.getClientInfo.http=null,ClientInfo.data.abonement=$this.updateAbonementClientInfo(ClientInfo.data.abonement),ClientInfo.data.certificate=$this.updateAbonementClientInfo(ClientInfo.data.certificate),$rootScope.$broadcast("ClientInfo.update",ClientInfo.data)}),ClientInfo.getClientInfo.http},updateAbonementClientInfo:function(arrAbonement){return angular.forEach(arrAbonement,function(abonement){if(abonement.planEndTime){var sDate=abonement.planEndTime.split(/[^0-9]/);abonement.planEndTime=new Date(sDate[0],sDate[1]-1,sDate[2],sDate[3],sDate[4],sDate[5])}}),arrAbonement||[]},getWorkingDaysForEmployee:function(employee){var result={},employeeId=Number(employee.id);return angular.forEach(EmployeeStorage.scheduleCache,function(employees,date){employees[employeeId]>=0&&(result[date]=!0)}),result},getWorkingDaysForTempEmployee:function(employee){var result={},employeeId=Number(employee.id);return angular.forEach(EmployeeStorage.tempScheduleCache,function(employees,date){employees[employeeId]>=0&&(result[date]=!0)}),result},selectEmployee:function(employee){employee&&!employee.workingDays&&(employee.workingDays=this.getWorkingDaysForEmployee(employee)),this.selectedEmployee=employee},selectTempEmployee:function(employee){0!==Number(employee.id)&&(employee.workingDays=this.getWorkingDaysForTempEmployee(employee)),this.selectedEmployee=employee},getMasterName:function(item){return item.firstname&&item.lastname?item.firstname+" "+item.lastname:item.firstname&&item.patronymic?item.firstname+" "+item.patronymic:item.firstname?item.firstname:item.lastname?item.lastname:item.patronymic},declOfNum:function(number,titles){var cases=[2,0,1,1,1,2];return titles[number%100>4&&number%100<20?2:cases[number%10<5?number%10:5]]},serviceTimeConvert:function(min){var hours=["час","часа","часов"],minPersonal="мин";if(this.organization){var personal=this.organization.personal;minPersonal=personal.units.min,hours=[personal.units.hour,personal.units.hour2,personal.units.hours]}var minutes=parseInt(min),result="";if(0===minutes)return"";if(minutes<60)return minutes+" "+minPersonal+".";var result_hours=Math.floor(minutes/60),result_minutes=minutes%60,need_minutes=result_minutes>0;return result+=result_hours+" "+this.declOfNum(result_hours,hours),need_minutes&&(result+=" "+result_minutes+" "+minPersonal+"."),result},showEmployeesLoader:function(){return EmployeeStorage.showEmployeesLoader},getEndTimeVisit:function(){var date=new Date,arr=ClientInfo.selectedTime.timeFormatted.split(":"),minutes=0;date.setHours(parseInt(arr[0]),parseInt(arr[1])),angular.forEach(ClientInfo.serviceCollection,function(svc){minutes+=Number(svc.duration)});var result=new Date(date.getTime()+6e4*minutes);return result.getHours()+":"+(result.getMinutes()<10?"0":"")+result.getMinutes()},getReminderDevision:function(number,step){return number.split(",",step)[0]},getClearPrice:function(item,priceType){priceType||(priceType="price");var price=parseFloat(item[priceType]);return String(price.toFixed(2)).split(".")[0]},getClearDiscPrice:function(item,priceType){if(priceType||(priceType="price"),"priceTill"===priceType)var price=parseFloat(item[priceType])-parseFloat(item.priceTillDiscountSum);else var price=parseFloat(item[priceType])-parseFloat(item.discountSum);return String(price.toFixed(2)).split(".")[0]},getClearCommodityPopupPrice:function(item){var price=parseFloat(item.Sellprice)*item.count;return String(price.toFixed(2)).split(".")[0]},getClearPriceCent:function(item,priceType){priceType||(priceType="price");var price=parseFloat(item[priceType]);return String(price.toFixed(2)).split(".")[1]},getClearDiscPriceCent:function(item,priceType){if(priceType||(priceType="price"),"priceTill"===priceType)var price=parseFloat(item[priceType])-parseFloat(item.priceTillDiscountSum);else var price=parseFloat(item[priceType])-parseFloat(item.discountSum);return String(price.toFixed(2)).split(".")[1]},getClearCommodityPopupPriceCent:function(item){var price=parseFloat(item.Sellprice)*item.count;return String(price.toFixed(2)).split(".")[1]},mobileWidth:function(){return!!window.fromSalonmap||(window.iFrame?screen.width<768:window.matchMedia("(max-width: 768px)").matches)},getScrollBarWidth:function(){var $outer=$("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),widthWithScroll=$("<div>").css({width:"100%"}).appendTo($outer).outerWidth();return $outer.remove(),100-widthWithScroll},getCommodityPhoto:function(commodity){return commodity&&"photoObj"in commodity&&Object.keys(commodity.photoObj).length>0?HOST+commodity.photoObj[Object.getOwnPropertyNames(commodity.photoObj)[0]].url:FILE_PATH+"images/noCommodity.svg"},updateServiceCollectionWithDiscounts:function(){ClientInfo.updateServiceInProgress=!0;var servicesIds="";bookingCombo.isCombo()&&(servicesIds+=bookingCombo.getServiceIds().join(",")),angular.forEach(ServiceCollection,function(service){servicesIds+=service.id+","}),$http.get(window.HOST+"/booking/services/updateServiceCollection",{params:{clientID:ClientInfo.selectedClient?ClientInfo.selectedClient.id:ClientInfo.data.id,networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,employeeID:this.selectedEmployee.id,services:servicesIds}}).success(function(data){var services=data,ids=[],result=[],resultSort=[];angular.forEach(ServiceCollection,function(service){ids.push(service.id)}),angular.forEach(services,function(service){ids.includes(service.id)&&result.push(service)}),angular.forEach(ids,function(id){angular.forEach(result,function(res){res.id==id&&resultSort.push(res)})}),ServiceCollection.clear(),angular.forEach(resultSort,function(service){ServiceCollection.add(service)}),ClientInfo.updateServiceInProgress=!1,$rootScope.$broadcast("ClientInfo.updateServiceCollection")})},getFIO:function(client){client.surname&&(client.lastname=client.surname);var fio="";return client.lastname&&(fio=fio+client.lastname+" "),client.firstname&&(fio=fio+client.firstname+" "),client.patronymic&&(fio+=client.patronymic),fio}};return ClientInfo.init(),ClientInfo}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("CreateVisitForOtherClient",["$resource","settings","$rootScope",function($resource,settings,$rootScope){var resource=$resource(window.HOST+"/booking/booking/getCanCreateVisitForOtherClient?orgid=:orgid&networkid=:networkid",{},{get:{method:"GET"}});return $rootScope.createVisitForOtherClient=!1,{getValue:function(){return $rootScope.createVisitForOtherClient},uploadValue:function(){resource.get({orgid:settings.ORG_ID,networkid:settings.NETWORK_ID},function(response){$rootScope.createVisitForOtherClient=response.result})}}}]),function(module){module.factory("DateTools",function(){return{haveSameDates:function(date1,cmpdata){var isDate=cmpdata instanceof Date,year=isDate?cmpdata.getFullYear():cmpdata.year,month=isDate?cmpdata.getMonth():cmpdata.month,date=isDate?cmpdata.getDate():cmpdata.date;return date1.getFullYear()===year&&date1.getMonth()===month&&date1.getDate()===date}}})}(angular.module("BookingApp.services"));var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("employeeFilter",["$http","$q","$timeout","EmployeeStorage",function($http,$q,$timeout,EmployeeStorage){return{savedEmployees:{},getEmployeesByServiceCollection:function(serviceCollection,organizationID){if(0==Object.keys(serviceCollection).length)return $q.when([]);var local=this,serviceCollectionIds=[],key="org="+organizationID;return angular.forEach(serviceCollection,function(service){serviceCollectionIds.push(service.id)}),key+="&serv="+serviceCollectionIds.join(","),void 0!==local.savedEmployees[key]?$q.when(local.savedEmployees[key]):$http.get(window.HOST+"/booking/employee/idsByServiceCollection",{params:{organizationID:organizationID,"serviceCollection[]":serviceCollectionIds}}).then(function(response){return response?(local.savedEmployees[key]=response.data,response.data):console.warn("Error: idsByServiceCollection")},function(){return{}})},isArrayContainsArray:function(array1,array2){var contains=!0;return angular.forEach(array2,function(element2){contains&&-1===array1.indexOf(element2)&&(contains=!1)}),contains},getEmployeesOfAllServiceCollection:function(employeesToServices,serviceCollection){var local=this,employeesToAllServices={},serviceCollectionIds=[];return angular.forEach(serviceCollection,function(service){serviceCollectionIds.push(1*service.id)}),angular.forEach(employeesToServices,function(employeeServices,employeeId){local.isArrayContainsArray(employeeServices,serviceCollectionIds)&&(employeesToAllServices[employeeId]=serviceCollectionIds)}),employeesToAllServices},getUnavailableServices:function(employeesToServices,serviceCollection){var unavailableServices=[];return angular.forEach(serviceCollection,function(service){var isAvailable=!1,serviceId=1*service.id;angular.forEach(employeesToServices,function(employeeServices){isAvailable||-1!==employeeServices.indexOf(serviceId)&&(isAvailable=!0)}),isAvailable||unavailableServices.push(service.id)}),unavailableServices}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("EmployeeStorage",["$rootScope","$http","$q","settings","Utils",function($rootScope,$http,$q,settings,Utils){var EmployeeStorage={employees:[],tempEmployees:[],showEmployeesLoader:!1,scheduleCache:{},tempScheduleCache:{},cabinets:{},init:function(){return this.updateEmployeesData()},setData:function(newData){var $this=this;this.employees.splice(0,this.employees.length),angular.forEach(newData.employees,function(employee){employee.visible=!0,Utils.loadEmployeeCompliments(employee).then(function(response){employee.complimentsCount=response.length})}),Object.assign(this.employees,newData.employees),Object.assign(this.cabinets,newData.cabinets),angular.forEach(this.scheduleCache,function(el,index){delete $this.scheduleCache[index]}),angular.forEach(newData.scheduleCache,function(el,index){$this.scheduleCache[index]=el})},replaceData:function(newData){var $this=this;this.tempEmployees.splice(0,this.tempEmployees.length),angular.forEach(newData.employees,function(employee){employee.visible=!0,$this.tempEmployees.push(employee)}),angular.forEach(newData.scheduleCache,function(el,index){$this.tempScheduleCache[index]=el})},getData:function(){var $this=this;return this.employees.length&&Object.keys(this.scheduleCache).length?$q(function(resolve){resolve($this)}):new Promise(function(){var _ref=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(resolve){var params,response;return _regeneratorRuntime().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return params={params:{organizationID:settings.ORG_ID,networkid:settings.NETWORK_ID,firstMonthDay:null}},$this.showEmployeesLoader=!0,_context.next=4,$http.get(window.HOST+"/booking/employee/getEmployeesData",params);case 4:response=_context.sent,$this.showEmployeesLoader=!1,resolve(response.data);case 7:case"end":return _context.stop()}},_callee)}));return function(_x){return _ref.apply(this,arguments)}}())},getTempData:function(){var $this=this;return $q(function(resolve){resolve($this)})},getEmployeeForId:function(employeeId){var employee={};return angular.forEach(this.employees,function(empl){Number(empl.id)===Number(employeeId)&&(employee=empl)}),employee},updateEmployeesData:function(){var firstMonthDay=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,$this=this;return $this.showEmployeesLoader=!0,this.loadData=$http.get(window.HOST+"/booking/employee/getEmployeesData",{params:{organizationID:settings.ORG_ID,networkid:settings.NETWORK_ID,firstMonthDay:firstMonthDay}}),this.loadData.success(function(data){firstMonthDay||$this.setData(data),$this.showEmployeesLoader=!1,setTimeout(function(){$rootScope.$broadcast("getEmployeesDataFinish")},500)}),this.loadData},replaceEmployeesData:function(firstMonthDay){var $this=this;return this.loadData=$http.get(window.HOST+"/booking/employee/getEmployeesData",{params:{organizationID:settings.ORG_ID,networkid:settings.NETWORK_ID,firstMonthDay:firstMonthDay}}),this.loadData.success(function(data){$this.replaceData(data)}),this.loadData},getNearestRecordData:function(employeesIds,durationServices,date){return $http.get("".concat(HOST,"/booking/booking/getNearestRecordDate"),{params:{organizationID:settings.ORG_ID,networkid:settings.NETWORK_ID,ids:employeesIds,duration:durationServices,date:date}}).then(function(res){return res.data}).catch(function(error){console.log(error)})},deleteData:function(){this.employees.splice(0,data.employees.length),this.tempEmployees.splice(0,data.tempEmployees.length)},getEmployeeByID:function(employeeId){return $http.get(window.HOST+"/booking/employee/getEmployeeByID",{params:{organizationID:settings.ORG_ID,networkid:settings.NETWORK_ID,employeeId:employeeId}})}};return settings.ORG_ID&&EmployeeStorage.init(),EmployeeStorage}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("Lang",["$resource",function($resource){return{_data:null,name:null,init:function(){var $this=this;this.name=window.LANGUAGE,$resource(window.HOST+"/booking/lang-"+window.LANGUAGE+".json").get(function(data){$this._data=data})},get:function(value){return this._data?this._data[value]?this._data[value]:value:""},getName:function(){return this.name}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("MetrikaService",["$rootScope","$http","$q","settings","Utils",function($rootScope,$http,$q,settings,Utils){var MetrikaService={counterId:"",isWidget:!1,isMobile:!1};return MetrikaService.init=function(){window.Ya&&window.Ya._metrika&&window.Ya._metrika.counters&&(MetrikaService.counterId=Object.keys(window.Ya._metrika.counters)[0].split(":")[0]),document.getElementsByClassName("widget-frame").length>0&&(MetrikaService.isWidget=!0),window.MOBILE_APP&&(MetrikaService.isMobile=!0),window.MetrikaService=MetrikaService,MetrikaService.counterId&&MetrikaService.sendEvent("enter")},MetrikaService.sendEvent=function(eventName){MetrikaService.counterId&&(MetrikaService.isWidget?window.ym(MetrikaService.counterId,"reachGoal","widget_"+eventName):MetrikaService.isMobile?window.ym(MetrikaService.counterId,"reachGoal","app_"+eventName):window.ym(MetrikaService.counterId,"reachGoal",eventName))},MetrikaService}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("nearestRecord",["$rootScope","$http","ClientInfo","timeCalculator","Lang","CREATE_VISIT","CHANGE_VISIT","$filter","timeFormatter",function($rootScope,$http,ClientInfo,timeCalculator,Lang,CREATE_VISIT,CHANGE_VISIT,$filter,timeFormatter){return function(e,s,d,c,date){function getAvailableIntervals(){return employee.interval}function cabinetTimesCheck(tile){var cabinetForCheck=[];if(angular.forEach(ClientInfo.serviceCollection,function(service){angular.forEach(cabinets,function(cabinet){cabinet.services&&cabinet.services.includes(parseInt(service.id))&&cabinetForCheck.push(cabinet)})}),!cabinetForCheck.length)return!0;var check=!1,cabChecks=[];return cabinetForCheck&&(angular.forEach(cabinetForCheck,function(cabinet){if(Array.isArray(cabinet.employees)&&cabinet.employees.includes(parseInt(employee.id))||0===employee.id){var cabCheck=!0;angular.forEach(cabinet.intervals,function(interval){var startInterval=timeFormatter.stringToMinutes(interval.startTime),endInterval=timeFormatter.stringToMinutes(interval.endTime);tile.time>startInterval-durationServices&&tile.time<endInterval&&(cabCheck=!1)}),cabChecks.push(cabCheck)}}),angular.forEach(cabChecks,function(c){c&&(check=!0)})),check}function getTimeElements(){var isDefineStartEndWorkTimes=!!employee.startEndWorkTimes,start=employee.minMaxTimes[0],end=employee.minMaxTimes[1];isDefineStartEndWorkTimes&&(void 0!==employee.startEndWorkTimes.from&&(start=employee.startEndWorkTimes.from),void 0!==employee.startEndWorkTimes.till&&(end=employee.startEndWorkTimes.till));var te=intervals(start,end).filter(function(time){return!!availableIntervals.find(function(item){var endTime;return ClientInfo.type===CREATE_VISIT?endTime=moment(item.endTime,"HH:mm").add(-durationServices,"minutes"):ClientInfo.type===CHANGE_VISIT&&(endTime=moment(item.endTime,"HH:mm").add(durationServices,"minutes")),time.endTime>=moment(item.startTime,"hh:mm")&&time.endTime<=endTime})}).map(function(time){return time.selected=ClientInfo.selectedTime&&ClientInfo.selectedEmployee&&ClientInfo.selectedTime.timeFormatted===time.step&&ClientInfo.selectedEmployee.id===employee.id,time.time=60*time.endTime.hours()+time.endTime.minutes(),time}).filter(function(item){return cabinetTimesCheck(item)});return te.length&&isToday(moment(employee.date))&&(te=filterTodayTimeElements(te)),te}function _getTitleText(){var str={today:ClientInfo.organization.personal.employee.today,tomorrow:ClientInfo.organization.personal.employee.tomorrow},mDate=moment(nearestRecordDate),key=nearestRecordDate&&isToday(mDate)&&"today";return key=key||nearestRecordDate&&isTomorrow(mDate)&&"tomorrow",timeElements.length?"".concat(ClientInfo.organization.personal.employee.nearestRecord," ").concat(key?str[key]:"").concat(key?",":""," ").concat($filter("date")(nearestRecordDate,"d")," ").concat(ClientInfo.getCalendarMonthSm(nearestRecordDate.getMonth())):"К сожалению, нет возможности записаться на выбранные услуги на ближайшее время. Выберите ".concat(Lang.get("мастера")," и подберите удобное время.")}function isToday(momentDate){return momentDate.isSame(moment().startOf("day"),"d")}function isTomorrow(momentDate){return momentDate.isSame(moment().subtract(-1,"days").startOf("day"),"d")}function intervals(start,end){var result=[],current=moment(start,"hh:mm"),i=1;for(end=moment(end,"hh:mm");current<=end;)result.push({timeFormatted:current.format("HH:mm"),startTime:moment(current).add(-(1===i?0:step),"minutes"),endTime:moment(current)}),current.add(step,"minutes"),1===i&&i++;return result}function filterTodayTimeElements(te){return te.filter(function(item){return item.endTime>today})}var employee=e,step=Number(s),durationServices=Number(d),cabinets=c,today=moment(date),nearestRecordDate=moment(employee.date).toDate(),availableIntervals=getAvailableIntervals(),timeElements=getTimeElements();return{getTimeElements:function(){return timeElements},getTitleText:function(){return _getTitleText()},getNearestRecordDate:function(){return nearestRecordDate},checkTimeElements:function(){return timeElements.length>0}}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("ObjTools",function(){return{get:function(object,properties,defaultNullValue){if(!angular.isObject(object)||$.isEmptyObject(object))return defaultNullValue;var props=properties.split("."),sought=object;for(var i in props){var prop=props[i];if(!angular.isObject(sought))return defaultNullValue;sought=sought[prop]}return sought},isset:function(object,properties){return void 0!==this.get(object,properties)},isEmpty:function(object){return!object||$.isEmptyObject(object)},sortByKey:function(obj,order){function compareFunction(a,b){return(order="desc")?b-a:a-b}order=order||"asc";var keys=Object.keys(obj),len=keys.length;keys.sort(compareFunction);for(var newObj={},i=0;i<len;i++){var k=keys[i];newObj[i]=obj[k]}return newObj},flip:function(trans,isArray,trueToIndex){var key,tmp_ar=isArray?[]:{},index=0;for(key in trans)trans.hasOwnProperty(key)&&(tmp_ar[trueToIndex?index++:trans[key]]=key);return tmp_ar}}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("PaymentMobile",["$rootScope","ClientInfo",function($rootScope,ClientInfo){return{open:function(){if(window.MOBILE_APP){var options="android"===window.cordova.platformId?"location=yes":"location=no,closebuttoncaption=Закрыть",ref=window.open(ClientInfo.paymentUrl,"_blank",options);ref.addEventListener("loadstart",function(event){(event.url.indexOf("RkSuccess")>=0||event.url.indexOf("RkFail")>=0)&&ref.close()}),ref.addEventListener("exit",function(event){$rootScope.$broadcast("checkVisitPayment")})}}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("paymentSettings",function($rootScope){var paymentEnabled=function(){var organization=window.organization;return organization&&"robokassa"in organization&&null!==organization.robokassa&&!1!==organization.robokassa&&"enable"in organization.robokassa&&organization.robokassa.enable};return{paymentEnabled:paymentEnabled,paymentEnabledServices:function(){var organization=window.organization;return!!paymentEnabled()&&organization.robokassa.enableService},paymentEnabledCommodities:function(){var organization=window.organization;return!!paymentEnabled()&&organization.robokassa.enableCommodity}}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("RatingEmployee",["RatingStar","$http",function(Star,$http){function Employee(employee){function Employee(employee){var $this=this;this.id=employee.id,this.name=employee.firstname+" "+employee.lastname,this.position=employee.position,this.isAdmin=employee.isAdmin,this.service=employee.service?employee.service.ServiceName:"",this.logo=employee.photo?employee.photo:"/booking/images/default-employee.png",this.mark=null,this.compliment=null,this.visible(!0),this.stars=new Star(5),this.stars.on("select",function(star){$this.mark=star.mark,$this.emit("mark",$this)}),this.stars.on("reset",function(){$this.mark=null,$this.visible(!1),$this.emit("reset-mark",$this)})}return Employee.prototype=new CreateEvent,Employee.prototype.constructor=Employee,Employee.prototype.visible=function(value){return"boolean"==typeof value&&(this._visible=value,value||this.emit("visible",this)),this._visible},Employee.prototype.getMark=function(){return this.mark},Employee.prototype.setCompliment=function(compliment){this.compliment&&(this.compliment.select=!1),compliment.select=!0,this.compliment=compliment,this.emit("set-compliment",this)},new Employee(employee)}return Employee}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("RatingEmployees",["RatingEmployee",function(Employee){function Employees(employees){function Employees(employees){this.marks={},this.compliments={},this.data=[];for(var i=0,len=employees.length;i<len;i++){var emp=new Employee(employees[i]);emp.on("mark",this.callbackonmark.bind(this)),emp.on("reset-mark",this.callbackonresetmark.bind(this)),emp.on("set-compliment",this.callbackOnSetCompliment.bind(this)),this.data.push(emp)}}return Employees.prototype=new CreateEvent,Employees.prototype.callbackonmark=function(employee){this.marks[employee.id]=employee.mark,0===this.getCountAllVisibles()&&this.emit("without-marks",this.marks),this.getCountMarks()===this.getCountAllVisibles()&&this.emit("all-marks",this.marks)},Employees.prototype.callbackonresetmark=function(employee){this.marks[employee.id]&&delete this.marks[employee.id],0===this.getCountAllVisibles()&&this.emit("without-marks",this.marks),this.getCountMarks()===this.getCountAllVisibles()&&this.emit("all-marks",this.marks)},Employees.prototype.callbackOnSetCompliment=function(employee){this.compliments[employee.id]=employee.compliment.alias},Employees.prototype.getCountAllVisibles=function(){var count=0;return angular.forEach(this.data,function(employee){employee.visible()&&count++}),count},Employees.prototype.getCountMarks=function(){return Object.keys(this.marks).length},Employees.prototype.getCompliments=function(){return this.compliments},new Employees(employees)}return Employees}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("RatingStar",[function(){function Star(count){function Star(count){this.elements=new Array;for(var arr=[],i=0;i<count;i++)arr.push({id:i,hover:null,mark:i+1});return arr.__proto__=this,this.items=arr,arr}return"number"!=typeof count?console.error("count is not number"):(Star.prototype=new CreateEvent,Star.prototype.constructor=Star,Star.prototype.starEnter=function(item){for(var id=item.id,i=0;i<=id;i++)this.items[i].hover=!0},Star.prototype.starLeave=function(item){for(var endItem=this.selected?this.selected.id:-1,i=this.items.length-1;i>endItem;i--)this.items[i].hover=!1},Star.prototype.select=function(item){item.select=!0,this.selected=item,this.starLeave(item),this.emit("select",item),navigator.vibrate&&navigator.vibrate(80)},Star.prototype.reset=function(item){for(var i=0,len=this.items.length;i<len;i++)this.items[i].hover=!1;this.selected&&(this.selected.select=!1),this.selected=null,this.emit("reset",item)},new Star(count))}return Star}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("robokassa",function($rootScope){var initialPaymentParameters={MerchantLogin:"",OutSum:"",InvId:"",Description:"",SignatureValue:"",Shp_ids:"",Shp_orgid:"",IncCurrLabel:"",Culture:"ru",Encoding:"utf-8",Receipt:"",isTest:window.isTest||0},paymentParameters=initialPaymentParameters;return{getPaymentParameters:function(){return paymentParameters},clearPaymentParameters:function(){paymentParameters=initialPaymentParameters},setMerchatLogin:function(value){paymentParameters.MerchantLogin=value},setOutSum:function(value){paymentParameters.OutSum=value},setInvId:function(value){paymentParameters.InvId=value},setDescription:function(value){paymentParameters.Description=value},setSignatureValue:function(value){paymentParameters.SignatureValue=value},setShpIds:function(value){paymentParameters.Shp_ids=value},setShpOrgid:function(value){paymentParameters.Shp_orgid=value},setReceipt:function(receipt){receipt&&(paymentParameters.Receipt=receipt)}}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("ServiceCollection",["$rootScope","$http","$q","settings","Utils",function($rootScope,$http,$q,settings,Utils){var ServiceCollection=[];return ServiceCollection.delete=function(service){var indexFinderService=null;angular.forEach(this,function(serviceEl,index){serviceEl.id===service.id&&(indexFinderService=index)}),null!==indexFinderService&&this.splice(indexFinderService,1)},ServiceCollection.clear=function(){this.length=0},ServiceCollection.update=function(items){var ids=[];items?angular.forEach(items,function(serviceId){ids.push(serviceId)}):angular.forEach(this,function(service){ids.push(service.id)}),this.clear(),ids.length&&this.loadForIds(ids)},ServiceCollection.add=function(service){if(this.length<1)return this.push(service);var finderService=!1;angular.forEach(this,function(item){item.id===service.id&&(finderService=!0)}),finderService||this.push(service)},ServiceCollection.treeToCollection=function(category){return category.oneLevelChildren=[],this.getChildren(category,category.oneLevelChildren),category.oneLevelChildren=category.oneLevelChildren.reverse(),category.oneLevelChildren.reverse()},ServiceCollection.getChildren=function(childrenCat,mainCat){var $this=this;angular.forEach(childrenCat.children,function(value,key){$this.getChildren(value,mainCat),mainCat.push(value)})},ServiceCollection.getAllServices=function(items){var resultItems=[],$this=this;return angular.forEach(items,function(category){var rootCategoryName=category.name,rootCategoryId=category.id;angular.forEach(category.services,function(service){service.categoryName=rootCategoryName,service.rootCategoryId=rootCategoryId,resultItems.push(service)});var nextLevel=$this.treeToCollection(category);angular.forEach(nextLevel,function(child){child.haveServices&&angular.forEach(child.services,function(service){service.categoryName=rootCategoryName,service.rootCategoryId=rootCategoryId,resultItems.push(service)})})}),resultItems},ServiceCollection.loadForIds=function(serviceIds){var http=$http.get(window.HOST+"/booking/services/byId",{params:{orgid:settings.ORG_ID,ids:JSON.stringify(serviceIds)}}),$this=this;return http.success(function(serviceList){var allServices=$this.getAllServices(Utils.servicesData);angular.forEach(allServices,function(service){angular.forEach(serviceList.success,function(service2){service.id===service2.id&&(service2.rootCategoryId=service.rootCategoryId)})}),angular.forEach(serviceList.success,function(service){$this.add(service)})}),http},ServiceCollection.getServiceCollection=function(){var promise={};return this.length>0&&(promise=$q(function(resolve){resolve(ServiceCollection)})),promise},ServiceCollection}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("ServiceUpdater",["$resource","settings",function($resource,settings){var updater=$resource(window.HOST+"/booking/services/update?orgid=:orgid",{},{update:{method:"POST"}}),mergeServices=function(fromServices,toServices){for(var i in fromServices){var fromS=fromServices[i];for(var j in toServices){var toS=toServices[j];fromS.id==toS.id&&angular.merge(toS,fromS)}}};return{update:function(services,date,startTime){var data={};data.servicesIds=[],angular.forEach(services,function(serv){data.servicesIds.push(serv.id)}),data.date=date,data.startTime=startTime,updater.update({orgid:settings.ORG_ID},data,function(response){var gettedServices=response.result;mergeServices(gettedServices,services)})}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.service("starService",function(){this.initNumber=function(data){for(var result=0,i=0,len=data;i<len;i++)result+=1;return new Array(result)},this.initArray=function(data){for(var result=0,i=0,len=data.length;i<len;i++)result+=+data[i];return result/=data.length,isNaN(result)?new Array(0):(result=Math.floor(result),new Array(result))}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("thanksService",["$rootScope","timeFormatter",function($rootScope,timeFormatter){console.log("init thanksService");var timeFormatter=timeFormatter;return $rootScope.thanksService={clientVisit:{}},{groupVisitItems:function(items){var arr=[];return angular.forEach(items,function(visit){if(arr.length){var keyFind=null;angular.forEach(arr,function(groupVisitArr,groupVisitKeyArr){groupVisitArr.length&&groupVisitArr[0].employee.id===visit.employee.id&&(keyFind=groupVisitKeyArr)}),"number"==typeof keyFind?arr[keyFind].push(visit):arr.push([visit])}else arr.push([visit])}),arr},getStartDateToVisits:function(items){var sortTime;return angular.forEach(items,function(item,key){sortTime=!1,angular.forEach(item,function(item2){if(items[key].dateVizit=new Date(item2.date).getTime(),sortTime){var checkSortTime=timeFormatter.stringToMinutes(item2.time);checkSortTime<sortTime&&(items[key].startTimeVizit=item2.time,items[key].sortTime=checkSortTime)}else sortTime=timeFormatter.stringToMinutes(item2.time),items[key].startTimeVizit=item2.time,items[key].sortTime=sortTime})}),items},sortVisits:function(visitItems){return this.getStartDateToVisits(this.groupVisitItems(visitItems))},get clientVisitName(){return $rootScope.thanksService.clientVisit.name||($rootScope.thanksService.clientVisit.name=$rootScope.clientInfoName()),$rootScope.thanksService.clientVisit.name},set clientVisitName(value){$rootScope.thanksService.clientVisit.name=value}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("timeCalculator",["checkTile","timeFormatter",function(checkTile,timeFormatter){var defaultStep=30;return{getTimes:function(iMin,iMax,oMin,oMax){return function(step){for(var stepValue=step||defaultStep,i=iMin,times=[];i<iMax;)times.push({time:i,timeFormatted:timeFormatter.minutesToString(i),enabled:!1,exclusion:i<oMin||i>oMax}),i=Number(i)+Number(stepValue);return times}},getFreeTiles:function($scope,emps,orgMinTime,serviceRequired){var self=this,orgTiles=angular.copy($scope.orgTiles),serviceCollection=serviceRequired?angular.copy($scope.getServiceCollection()):[],empsToServices=angular.copy($scope.empsToServices),bookingDuration=angular.copy($scope.getBookingDuration()),selectedDay=new Date(angular.copy($scope.selectedDay)),serverToUserTimeDiff=angular.copy($scope.serverToUserTimeDiff),existMastersForAllServices=angular.copy($scope.existMastersForAllServices),now=new Date,nowHours=now.getHours()<10?"0"+now.getHours():now.getHours(),nowMinutes=now.getMinutes()<10?"0"+now.getMinutes():now.getMinutes(),nowCountMinutes=timeFormatter.stringToMinutes(nowHours+":"+nowMinutes)+serverToUserTimeDiff,newTimes={},beforeOrgTimes={},allTimes={},atLeastOneTimeEnabled=!1,currentDateNumberFormatted=new Date(now.getFullYear(),now.getMonth(),now.getDate()),selectedDateNumberFormatted=new Date(selectedDay.getFullYear(),selectedDay.getMonth(),selectedDay.getDate()),isFutureDate=currentDateNumberFormatted<selectedDateNumberFormatted;return angular.forEach(orgTiles,function(tile,tileNumber){if(allTimes[tileNumber]=angular.copy(tile),isFutureDate||!isFutureDate&&tile.time>=nowCountMinutes)if(!serviceRequired||existMastersForAllServices)allTimes[tileNumber]=self.isTileAvailableForSingleEmployee(allTimes[tileNumber],serviceCollection,emps,nowCountMinutes,bookingDuration,serviceRequired,$scope,self);else{var servicesArray=checkTile.buildServicesArray(serviceCollection);allTimes[tileNumber].visitItems=checkTile.getTileVisitItems(allTimes[tileNumber].timeFormatted,servicesArray,empsToServices,emps),allTimes[tileNumber].visitItems.length>0&&(allTimes[tileNumber].enabled=self.cabinetTimesCheckForAll(allTimes[tileNumber],$scope,bookingDuration,serviceCollection))}allTimes[tileNumber].enabled&&(atLeastOneTimeEnabled=!0),tile.time<orgMinTime?beforeOrgTimes[tileNumber]=allTimes[tileNumber]:newTimes[tileNumber]=allTimes[tileNumber]}),{allTimes:allTimes,beforeOrgTimes:beforeOrgTimes,newTimes:newTimes,atLeastOneTimeEnabled:atLeastOneTimeEnabled}},isTileAvailableForSingleEmployee:function(tile,serviceCollection,emps,nowCountMinutes,bookingDuration,serviceRequired,$scope,self){var visitItems=[],isAnyEmployee=Object.keys(emps).length>1;return bookingDuration||(bookingDuration=defaultStep),angular.forEach(emps,function(empIntervals,employeeId){angular.forEach(empIntervals,function(empInterval){if((Object.keys(serviceCollection).length||!serviceRequired)&&!tile.enabled){var startInterval=timeFormatter.stringToMinutes(empInterval.startTime),endInterval=timeFormatter.stringToMinutes(empInterval.endTime);if(tile.time>=startInterval&&tile.time+bookingDuration<=endInterval){tile.enabled=self.cabinetTimesCheck($scope.cabinets,employeeId,tile,bookingDuration,serviceCollection);var serviceTime=tile.time;serviceRequired&&angular.forEach(serviceCollection,function(service){var check=!0;angular.forEach(visitItems,function(item){service.id===item.serviceId&&(check=!1)}),check&&(visitItems.push({employeeId:isAnyEmployee?"0":employeeId,serviceId:service.id,startTime:timeFormatter.minutesToString(serviceTime)}),serviceTime+=1*service.duration)})}}})}),tile.visitItems=visitItems,tile},cabinetTimesCheck:function(cabinets,id,tile,bookingDuration,serviceCollection){if(cabinets&&0!==Object.keys(cabinets).length){var check=!1,filteredCabinets=[];if(angular.forEach(serviceCollection,function(service){angular.forEach(cabinets,function(cabinet){Array.isArray(cabinet.services)&&cabinet.services.includes(parseInt(service.id))&&filteredCabinets.push(cabinet)})}),!filteredCabinets.length>0)return!0;var cabChecks=[];return angular.forEach(filteredCabinets,function(cabinet){if(Array.isArray(cabinet.employees)&&cabinet.employees.includes(parseInt(id))){var cabCheck=!0;angular.forEach(cabinet.intervals,function(interval){var startInterval=timeFormatter.stringToMinutes(interval.startTime),endInterval=timeFormatter.stringToMinutes(interval.endTime);tile.time>startInterval-bookingDuration&&tile.time<endInterval&&(cabCheck=!1)}),cabChecks.push(cabCheck)}}),angular.forEach(cabChecks,function(c){c&&(check=!0)}),check}return!0},cabinetTimesCheckForAll:function(tile,$scope,bookingDuration,serviceCollection){if($scope.cabinets&&0!==Object.keys($scope.cabinets).length){var itemsChecks=[],result=!1;return angular.forEach(tile.visitItems,function(item){var check=!1,filteredCabinets=[];if(angular.forEach(serviceCollection,function(service){angular.forEach($scope.cabinets,function(cabinet){cabinet.services.includes(parseInt(service.id))&&filteredCabinets.push(cabinet)})}),!filteredCabinets.length>0&&(check=!0),filteredCabinets.length>0){var cabChecks=[];angular.forEach($scope.cabinets,function(cabinet){if(Array.isArray(cabinet.employees)&&cabinet.employees.includes(parseInt(item.employeeId))){var cabCheck=!0;angular.forEach(cabinet.intervals,function(interval){var startInterval=timeFormatter.stringToMinutes(interval.startTime),endInterval=timeFormatter.stringToMinutes(interval.endTime);tile.time>startInterval-bookingDuration&&tile.time<endInterval&&(cabCheck=!1)}),cabChecks.push(cabCheck)}}),angular.forEach(cabChecks,function(c){c&&(check=!0)})}itemsChecks.push(check)}),angular.forEach(itemsChecks,function(c){c&&(result=!0)}),result}return!0},getBookingDuration:function($scope,SERVICE_REQUIRED,STEP){var duration=0;if(SERVICE_REQUIRED){var serviceCollection=$scope.getServiceCollection();if(angular.forEach(serviceCollection,function(service){duration>=0&&(service||(duration=-1),duration+=parseInt(service.duration))}),duration<0)return!1}else duration=STEP;return duration}}}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("timeFormatter",function(){return{stringToMinutes:function(time){if(!time)return Number.NaN;if(time instanceof Date&&!isNaN(time.valueOf())){var hours=time.getHours(),minutes=time.getMinutes();return 60*Number(hours)+Number(minutes)}if("string"==typeof time||"object"===_typeof(time)&&"string"==typeof time.date){var timeValue=time;"object"===_typeof(time)&&"string"==typeof time.date&&(timeValue=time.date);var timeStringParsed=timeValue.split(":");if(timeStringParsed.length>=2){var _hours=0,hoursString=timeStringParsed[0];2===hoursString.split(" ").length?_hours=hoursString.split(" ")[1]:1===hoursString.split(" ").length&&(_hours=hoursString);var _minutes=timeStringParsed[1];if(_hours||_minutes)return 60*Number(_hours)+Number(_minutes)}}else if(time&&time.match(/(\d{2}):(\d{2})/))return 60*Number(RegExp.$1)+Number(RegExp.$2);return Number.NaN},minutesToString:function(number){var hours=Math.floor(Number(number)/60);1===hours.toString().length&&(hours="0"+hours);var minutes=Math.floor(Number(number)%60);return 1===minutes.toString().length&&(minutes="0"+minutes),hours+":"+minutes}}});var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("Utils",["$rootScope","$http","$q",function($rootScope,$http,$q){var Utils={complimentsData:{},servicesData:[],updateEmployeeCompliments:function(data,employee){var compliments=[],resultCompliments=[];return angular.forEach(data,function(compliment){"compliment"!==compliment.type&&"common"!==compliment.type||compliments.push(compliment)}),angular.forEach(employee.ratingDescriptions,function(ratingDescription){angular.forEach(compliments,function(compliment){ratingDescription.aliasName===compliment.alias&&resultCompliments.push(Object.assign({},compliment,ratingDescription))})}),resultCompliments},loadEmployeeCompliments:function(employee){return employee.ratingDescriptions&&employee.ratingDescriptions.length?Object.keys(Utils.complimentsData).length?Promise.resolve(Utils.updateEmployeeCompliments(Utils.complimentsData,employee)):$q(function(resolve){$http.get((window.MOBILE_APP?"":window.HOST+"/booking/")+"data/"+window.LANGUAGE+"/compliments_new.json").then(function(response){response&&response.data?(Utils.complimentsData=response.data,resolve(Utils.updateEmployeeCompliments(response.data,employee))):resolve([])}).catch(function(){resolve([])})}):Promise.resolve([])},getServicesData:function(){return this.servicesData},stopBodyScrolling:function(bool){!0===bool?document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1):document.body.removeEventListener("touchmove",function(e){e.preventDefault()},!1)},removeElement:function(elementId){var element=document.getElementById(elementId);element&&element.parentNode.removeChild(element)},setSalonBackgroundImage:function(organization){if("site"!==window.fromSite){var el=$("#background-image");el.removeAttr("style"),!window.vk&&!window.HOST&&organization&&"personal"in organization&&organization.personal&&"ozBackgroundImage"in organization.personal.main&&organization.personal.main.ozBackgroundImage&&el.css({"background-image":'url("'+organization.personal.main.ozBackgroundImage+'")',"background-size":"cover","background-attachment":"fixed","background-position":"center"})}},setSalonAccentColor:function(organization){this.removeElement("colors-desktop"),this.removeElement("colors-mobile"),this.removeElement("colors"),!window.vk&&!window.HOST&&organization&&"fieldsData"in organization&&organization.fieldsData&&"ozMainColor"in organization.fieldsData&&organization.fieldsData.ozMainColor&&Promise.resolve().then(function(){return window.customCSS?$http.get("/booking/booking/getColorsType?networkid="+organization.networkID+"&orgid="+organization.id).then(function(response){return Promise.resolve(response.data)}).then(function(colorsType){var resultPath="";return resultPath="network"===colorsType?"/booking/custom/"+organization.networkID+"/colors.json":"/booking/ac/colors.json",$http.get(resultPath)}).then(function(colorsFile){var colors=JSON.parse(JSON.stringify(colorsFile.data));return Promise.resolve(colors.colorHelper)}):Promise.resolve("ac"!==window.LANGUAGE?"#333333":"#5f7deb")}).then(function(color){angular.forEach(window.colorFiles,function(colorFile,name){$http.get(colorFile).success(function(data){var colorFileString=data.toString(),css=colorFileString.replace(new RegExp(color,"g"),organization.fieldsData.ozMainColor),head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.setAttribute("id",name),"colors-desktop"!==name&&"colors-mobile"!==name||(style.setAttribute("media","all"),"colors-desktop"===name?style.setAttribute("media","(min-width : "+window.cssMinWidth+"px)"):style.setAttribute("media","(max-width : "+window.cssMaxWidth+"px)")),head.appendChild(style),style.type="text/css",style.styleSheet?style.styleSheet.cssText=css:style.appendChild(document.createTextNode(css))}).error(function(err){console.log(err)})})})}};return Utils}]);var BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("workDays",function(){return{calcSchedule:function(schedule){var scheduleWeekday=[],scheduleWeekend=[],i=0;for(var key in schedule){var weekday,scheduleArray,item=schedule[key];switch(key){case"1":weekday="пн";break;case"2":weekday="вт";break;case"3":weekday="ср";break;case"4":weekday="чт";break;case"5":weekday="пт";break;case"6":weekday="сб";break;case"7":weekday="вс"}key<6?scheduleArray=scheduleWeekday:(i=0,scheduleArray=scheduleWeekend),0!==scheduleArray.length?item.startTime===scheduleArray[i].times[0]&&item.endTime===scheduleArray[i].times[1]?scheduleArray[i].days[1]=weekday:(i++,scheduleArray.push({days:[weekday],times:[item.startTime,item.endTime]})):scheduleArray.push({days:[weekday],times:[item.startTime,item.endTime]})}return{scheduleWeekday:scheduleWeekday,scheduleWeekend:scheduleWeekend}}}});