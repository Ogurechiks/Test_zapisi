"use strict";function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function autoResize($timeout){return{restrict:"A",link:function(scope,element,attributes,controller){element.css({height:"0px","overflow-y":"hidden"}),$timeout(function(){element.css("height",element[0].scrollHeight+"px")},100),element.on("input",function(){element.css({height:"0px","overflow-y":"hidden"}),element.css("height",element[0].scrollHeight+"px")})}}}function _typeof(o){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(o)}function _regeneratorRuntime(){function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={},p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}if(this.done)throw e;for(var r=this,o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}var a=n.apply(t,e);_next(void 0)})}}var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("accordeon",["$rootScope",function($rootScope){return{scope:{head:"@",text:"@"},restrict:"E",template:'<div class="accordeon">\n                       <div class="accordeon-title color" style="margin-top:0.8em; font-size:1em; font-weight: 600">\n                           <a ng-click="toggleText()">{{head}}<span class="icomoon check-list"></span></a>\n                       </div>\n                       <div class="accordeon-description" style="\n                           font-size:0.8em;\n                           margin-top:0.8em;\n                           overflow: hidden;\n                           height: 0;\n                           opacity: 0;\n                           transition-duration: 0.4s;\n                           transition-timing-function: ease-in-out;\n                           word-break: break-word;\n                           ">\n                           <p>{{text}}</p>\n                       </div>\n                       <div class="accordeon-bottom"></div>\n                   </div>',link:function(scope,element){scope.showText=!1,scope.toggleText=function(){scope.showText=!scope.showText,!0===scope.showText?(element.find(".check-list")[0].classList.add("upper"),element.find(".accordeon-description")[0].style.height="100%",element.find(".accordeon-description")[0].style.opacity=1,setTimeout(function(){element.find(".accordeon-description")[0].scrollIntoView(!0)},30)):(element.find(".check-list")[0].classList.remove("upper"),element.find(".accordeon-description")[0].style.height="0",element.find(".accordeon-description")[0].style.opacity=0)}}}}]);var BookingAppDirectives=angular.module("BookingApp.directives"),BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("AmplitudeEvent",[function(){return{logEvent:function(amplitudeEvent,data){amplitude.getInstance().logEvent(amplitudeEvent,data)}}}]),BookingAppDirectives.directive("amplitudeEvent",["AmplitudeEvent","settings",function(AmplitudeEvent,settings){return{restrict:"A",scope:{eventData:"="},link:function(scope,element,attrs){var data={};element.on("click",function(){data.orgid=settings.ORG_ID,AmplitudeEvent.logEvent(attrs.amplitudeEvent,data)})}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("androidTextarea",function(){return{link:function(scope,element,attrs){var nua=navigator.userAgent;if(nua.indexOf("Mozilla/5.0")>-1&&nua.indexOf("Android ")>-1&&nua.indexOf("AppleWebKit")>-1&&!nua.indexOf("Chrome")>-1){var placeholderDiv=angular.element('<div class="android-placeholder">'+attrs.placeholder+"</div>");element.attr("placeholder",""),placeholderDiv.insertAfter(element),element.hide(),placeholderDiv.bind("click",function(){placeholderDiv.hide(),element.show(),element.focus()}),element.bind("blur",function(){""==element.context.value&&(placeholderDiv.show(),element.hide())})}}}});var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("arncSlider",["$compile","$timeout","$window","eventsService","$q",function($compile,$timeout,$window,eventsService,$q){return{restrict:"E",replace:!0,transclude:!0,scope:!0,template:'<div class="arnc-slider-wrapper" ng-class="sliderClass"><div ng-if="isArrowCurrent" ng-click="arrowLeft()" ng-class="isArrowStatusClasses[\'prev\']" class="arrow"></div><div ng-if="isArrowCurrent" ng-click="arrowRight()" ng-class="isArrowStatusClasses[\'next\']" class="arrow"></div><div class="arnc-slider" ng-class=" {arnc_slider_has_arrow : isArrowExist} " ng-transclude=""></div></div>',link:function(scope,element,attrs){scope.calculateParams=function(){var widthWindow=angular.element($window).width(),typeDevicePrefix=widthWindow<600?"m":"d",widthParamName=typeDevicePrefix+"Width",arrowParamName=typeDevicePrefix+"Arrow";widthItem=attrs&&attrs[widthParamName]?parseInt(attrs[widthParamName]):1,scope.isArrowExist=!(!attrs||!attrs[arrowParamName])&&scope.$eval(attrs[arrowParamName])};var widthItem,elementSlider=element.find(".arnc-slider"),items=scope.$eval(attrs.items),maxItemCountSlide=parseInt(attrs.maxItemCountSlide),isElementSliderLoaded=!1;scope.isArrowExist,scope.calculateParams();var debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}},scrollFn=debounce(function(event){initItems();var elmItem=scope.$parent.currentPosition;elmItem&&items&&items[elmItem]?scope.$emit("changePosition",items[elmItem]):items&&items.length>0&&scope.$emit("changePosition",items[0]),scope.$$phase||scope.$apply()},250);elementSlider.on("scroll",function(event){if(isElementSliderLoaded){var leftOffset=elementSlider.scrollLeft(),position=Math.round(leftOffset/widthItem);position!=scope.$parent.currentPosition&&(scope.$parent.currentPosition=position,scope.$$phase||scope.$apply()),scope.isArrowStatus(),scrollFn(event)}});var doScroll=function(direction){scope.waitForElementSlider(function(loadedElementSlider){var leftOffset=loadedElementSlider.scrollLeft(),offset=maxItemCountSlide*widthItem;switch(direction){case"right":scope.$parent.currentPosition+=maxItemCountSlide,leftOffset+=offset;break;case"left":maxItemCountSlide>scope.$parent.currentPosition?(scope.$parent.currentPosition=0,leftOffset=0):(scope.$parent.currentPosition-=maxItemCountSlide,leftOffset-=offset);break;default:scope.newPos&&(leftOffset=scope.newPos*widthItem,scope.$parent.currentPosition=scope.newPos)}loadedElementSlider.animate({scrollLeft:leftOffset},200)})},getLoadedElementSlider=function getLoadedElementSlider(waitTime){return isElementSliderLoaded||elementSlider.width()>0&&elementSlider.children().length>0&&canScroll(elementSlider)?(isElementSliderLoaded=!0,$q.when(elementSlider)):$timeout(getLoadedElementSlider,waitTime,!0,waitTime+25).then(function(loadedElementSlider){return loadedElementSlider})},canScroll=function(elementToScroll){var oldScrollLeft=elementToScroll.scrollLeft();if(oldScrollLeft>0)return!0;var scrollSuccess=!1;return elementToScroll.scrollLeft(oldScrollLeft+1),scope.$$phase||scope.$apply(),elementToScroll.scrollLeft()==oldScrollLeft+1&&(scrollSuccess=!0),elementToScroll.scrollLeft(oldScrollLeft),scope.$$phase||scope.$apply(),scrollSuccess};scope.waitForElementSlider=function(func){var context=this;getLoadedElementSlider(50).then(function(loadedElementSlider){func.call(context,loadedElementSlider),scope.$$phase||scope.$apply()})};var getDate=function(dateInput){var date=new Date(dateInput);return date=new Date(date.getFullYear(),date.getMonth(),date.getDate()),date.toString()},initItems=function(){(!items||items&&!items.length)&&(items=scope.$eval(attrs.items))};scope.isArrowStatusClasses=[],scope.isArrowStatus=function(){scope.waitForElementSlider(function(loadedElementSlider){var curScrollLeft=loadedElementSlider.scrollLeft();scope.isArrowStatusClasses.prev=0==curScrollLeft?"arrow-left-disabled":"arrow-left-enabled",scope.isArrowStatusClasses.next=curScrollLeft+loadedElementSlider.width()>=loadedElementSlider.children().length*widthItem?"arrow-right-disabled":"arrow-right-enabled"})},scope.isArrowStatus(),scope.isArrowCurrent=!1,scope.isHasArrow=function(){scope.waitForElementSlider(function(loadedElementSlider){scope.isArrowCurrent=!!(scope.isArrowExist&&loadedElementSlider.children().length*widthItem>loadedElementSlider.width())})},scope.isHasArrow(),angular.element($window).bind("resize",function(){scope.calculateParams(),scope.isHasArrow()}),scope.arrowRight=function(){doScroll("right")},scope.arrowLeft=function(){doScroll("left")};var sliderValue;scope.$watch("sliderMonth",function(newVal){sliderValue=newVal,scope.goToSlideWithValue()}),scope.goToSlideWithValue=function(){scope.waitForElementSlider(function(loadedElementSlider){initItems(),angular.forEach(items,function(item,i){getDate(item.date)==getDate(sliderValue)&&(scope.newPos=i)}),doScroll()})}}}}]),BookingAppDirectives.directive("repeatFinished",function(){return{restrict:"A",link:function(scope,element,attrs){scope.$last&&scope.$emit("repeatFinished",scope.$index+1)}}});var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("backImg",function(){return function(scope,element,attrs){attrs.$observe("backImg",function(value){scope.$watch("screenWidth",function(val,old){scope.screenWidth=window.innerWidth,$(window).bind("resize",function(){element.css({"background-image":"url("+value+")"})})}),element.css({"background-image":"url("+value+")"})})}});var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("bookingTabs",function(){return{scope:!0,restrict:"A",link:function(scope){scope.$on("offAll",function(){scope.$broadcast("off")})}}}),BookingAppDirectives.directive("bookingTab",function(){return{scope:!0,restrict:"A",link:function(scope,element,attrs){var options=scope.$eval(attrs.bookingTab),target=document.querySelectorAll(options.target),activeClass=options["active-class"],on=function(){scope.$emit("offAll"),element.addClass(activeClass);for(var i=0;i<target.length;i++)target[i].style.display=""},off=function(){element.removeClass(activeClass);for(var i=0;i<target.length;i++)target[i].style.display="none"};scope.$eval(options["is-active"])?on():off(),scope.$on("off",off),element.on("click",on)}}});var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("cartButton",["$rootScope","$location","Cart",function($rootScope,$location,Cart){return{restrict:"E",replace:!0,scope:{},link:function(scope){scope.showCartButton=function(){return!Cart.isEmpty()},scope.getCount=function(){return Cart.getCount()},scope.toCart=function(){$rootScope.$broadcast("goTo","cart")}},template:'\n    <div title="Корзина" ng-show="showCartButton()" class="cart-button mobile background-color" ng-click="toCart()">{{ getCount() }}</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("commodityModal",["$rootScope","$http","ClientInfo","$location","$window","$document","settings","Cart",function($rootScope,$http,ClientInfo,$location,$window,$document,settings,Cart){return{restrict:"E",replace:!0,scope:!0,link:function(scope){scope.commodity={},scope.galleryThumbsSwiper_Desktop={},scope.galleryThumbsSwiper_Mobile={},scope.count=1,scope.photoUrl=null,scope.showCommodityModal=function(){return ClientInfo.showCommodityModal},scope.mobileWidth=function(){return ClientInfo.mobileWidth()},scope.closePopup=function(){ClientInfo.showCommodityModal=!1,ClientInfo.selectedCommodityModal={},scope.commodity={},scope.photoUrl=null;var body=$("body");body.removeAttr("style"),body.removeClass("ovh"),angular.element(document.querySelector(".swiper-wrapper2")).children().remove(),angular.element(document.querySelector(".swiper-pagination")).children().remove()},scope.$on("closeCommodityModal",function(){scope.closePopup()}),scope.countMinus=function(){scope.count>1&&(scope.count--,scope.checkInCart()&&Cart.decreaseCountItem(scope.commodity))},scope.countPlus=function(){"qtyTotal"in scope.commodity?scope.count<scope.commodity.qtyTotal&&scope.increaseCount():scope.increaseCount()},scope.increaseCount=function(){scope.count++,scope.checkInCart()&&Cart.increaseCountItem(scope.commodity)},scope.repeatFinishedInitSwiperCommodity_Desktop=function(init){init&&scope.initGalleryThumbsSwiper_Desktop()},scope.repeatFinishedInitSwiperCommodity_Mobile=function(init){init&&scope.initGalleryThumbsSwiper_Mobile()},angular.element(document).ready(function(){$("body").on("click",".swiper-slide2",function(){scope.photoUrl=$(this).find("img").eq(0).attr("src"),scope.$apply()})}),scope.initGalleryThumbsSwiper_Desktop=function(){scope.galleryThumbsSwiper_Desktop.initialized&&scope.galleryThumbsSwiper_Desktop.destroy(),setTimeout(function(){scope.galleryThumbsSwiper_Desktop=new Swiper(".swiper-desktop",{direction:"horizontal",touchRatio:1,spaceBetween:5,slidesPerView:3,mousewheel:!0,loop:!1,freeMode:!1,navigation:{nextEl:".commodity-button-next-desktop",prevEl:".commodity-button-prev-desktop"}})},0)},scope.initGalleryThumbsSwiper_Mobile=function(){scope.galleryThumbsSwiper_Mobile.initialized&&scope.galleryThumbsSwiper_Mobile.destroy(),setTimeout(function(){scope.galleryThumbsSwiper_Mobile=new Swiper(".swiper-mobile",{direction:"horizontal",touchRatio:1,spaceBetween:0,slidesPerView:"auto",mousewheel:!0,loop:!1,freeMode:!1,navigation:{nextEl:".commodity-button-next-mobile",prevEl:".commodity-button-prev-mobile"},pagination:{el:".swiper-pagination"}})},0)},scope.checkInCart=function(){return Cart.check(scope.commodity)},scope.choiceCommodity=function(){$rootScope.$broadcast("choiceCommodity",scope.commodity,scope.count,"/products"===$location.path())},scope.getClearPrice=function(){var price=parseFloat(scope.commodity.Sellprice)*scope.count;return String(price.toFixed(2)).split(".")[0]},scope.getClearPriceCent=function(){var price=parseFloat(scope.commodity.Sellprice)*scope.count;return String(price.toFixed(2)).split(".")[1]},scope.getCommodityPhoto=function(commodity){return ClientInfo.getCommodityPhoto(commodity)},angular.element($window).on("resize orientationchange",function(){"/products"===$location.path()&&(scope.galleryThumbsSwiper_Desktop.initialized||scope.initGalleryThumbsSwiper_Desktop(),scope.galleryThumbsSwiper_Mobile.initialized||scope.initGalleryThumbsSwiper_Mobile())}),scope.$watch(function(){return scope.showCommodityModal()},function(value){if(value){scope.commodity=ClientInfo.selectedCommodityModal;var cartItemCount=Cart.getCountItem(scope.commodity);scope.photoUrl=scope.getCommodityPhoto(scope.commodity),scope.count=0===cartItemCount?1:cartItemCount}}),scope.FILE_PATH=FILE_PATH,scope.HOST=HOST,scope.currency=ClientInfo.currency},template:'\n<div class="overlay commodity" ng-class="{open:showCommodityModal()}">\n    <div class="overlay-content">\n        <div class="app-commodity-popup-category-back">{{commodity.categoryName}}</div>\n        <div class="commodity-popup" context-panel="commodity-popup">\n            <div class="app-commodity-popup-left">\n                <div class="img-container" ng-class="{\'empty-photo\': commodity.photoObj.length === 0}">\n                    <img ng-src="{{ photoUrl }}" fallback-src="{{FILE_PATH}}images/noCommodity.svg" class="app-commodity-popup-main-img" alt="">\n                </div>\n                \n                \n                \n                <div ng-if="commodity.photoObj.length > 1" class="commodity-swiper-container swiper-desktop desktop">\n                    <div class="swiper-wrapper swiper-wrapper2">\n                        <div class="swiper-slide swiper-slide2 noselect" ng-init="repeatFinishedInitSwiperCommodity_Desktop($last)" ng-repeat="i in commodity.photoObj">\n                            <img alt="Изображение {{ $index + 1 }}" style="object-fit: cover; height: 58px;" ng-src="{{HOST}}{{i.url}}">\n                        </div>\n                    </div>\n                </div>\n                <div class="commodity-swiper-button-next commodity-button-next-desktop icomoon color-before desktop" ng-if="commodity.photoObj.length > 3" title="Следующее изображение"></div>\n                <div class="commodity-swiper-button-prev commodity-button-prev-desktop icomoon color-before desktop" ng-if="commodity.photoObj.length > 3" title="Предыдущее изображение"></div>\n                \n                \n                \n                <div ng-if="commodity.photoObj.length > 0" class="commodity-swiper-container swiper-mobile mobile">\n                    <div class="swiper-wrapper swiper-wrapper2">\n                        <div class="swiper-slide swiper-slide2 noselect" ng-init="repeatFinishedInitSwiperCommodity_Mobile($last)" ng-repeat="i in commodity.photoObj">\n                            <img alt="Изображение {{ $index + 1 }}" style="object-fit: cover; height: 58px;" ng-src="{{HOST}}{{i.url}}">\n                        </div>\n                    </div>\n                    <div ng-show="commodity.photoObj.length > 1" class="swiper-pagination"></div>\n                </div>\n                <div class="commodity-swiper-button-next commodity-button-next-mobile icomoon color-before mobile" ng-if="commodity.photoObj.length > 1" title="Следующее изображение"></div>\n                <div class="commodity-swiper-button-prev commodity-button-prev-mobile icomoon color-before mobile" ng-if="commodity.photoObj.length > 1" title="Предыдущее изображение"></div>\n                \n                \n                <div class="img-container-mobile" ng-show="commodity.photoObj.length === 0">\n                    <img ng-src="{{FILE_PATH}}images/noCommodity.svg" class="app-commodity-popup-main-img-mobile">\n                </div>            \n                \n                \n            </div>\n            <div class="app-commodity-popup-right">\n                <div class="app-commodity-popup-box">\n                    <div ng-show="commodity.brand" class="app-commodity-popup-brand">{{commodity.brand}}</div>\n                    <div class="app-commodity-popup-name">{{commodity.Fullname}}\n                    <span ng-show="commodity.UFname" class="app-commodity-popup-name-dop">{{commodity.UFname}}</span></div>\n                </div>\n                <div class="commodity-modal-price-box">\n                    <split-price discount="{{ commodity.discountSum }}" count="{{ count }}" default-with-discount="0" without-discount-box="0" price="{{ commodity.Sellprice }}"></split-price>\n                </div>\n                <div class="app-commodity-popup-btns">\n                        <div class="app-commodity-popup-btn-minus noselect icomoon color" ng-class="{\'count-button-disable\' : count === 1}" ng-click="countMinus()" title="Уменьшить количество">X</div>\n                        <div class="app-commodity-popup-count noselect">{{count}}</div>\n                        <div class="app-commodity-popup-btn-minus noselect icomoon color" ng-class="{\'count-button-disable\' : count === commodity.qtyTotal}" ng-click="countPlus()" title="Увеличить количество">Y</div>\n                    <div ng-click="choiceCommodity(); $event.stopPropagation();" ng-class="{\'added\':checkInCart()}" class="app-commodity-popup-btn-add-box icomoon background-color">\n                        <span class="app-commodity-popup-btn-add-button">{{checkInCart() ? organization.personal.commodityModal.cartRemove : organization.personal.commodityModal.cartAdd}}</span>\n                    </div>\n                </div>\n            </div>\n            <div class="clear"></div>\n            <div ng-if="commodity.descBookingSell.length" class="app-commodity-popup-desc-title noselect">{{organization.personal.commodityModal.description}}</div>\n            <div ng-if="commodity.descBookingSell.length" class="app-commodity-popup-desc" ng-bind-html="trustAsHtml(commodity.descBookingSell)"></div>\n            <span class="app-close-popup icomoon" ng-click="closePopup(); $event.stopPropagation();" title="Закрыть"></span>\n            <div class="clear"></div>\n        </div>\n    </div>\n</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("employeeModal",["$rootScope","$filter","$http","ClientInfo","Utils","$timeout",function($rootScope,$filter,$http,ClientInfo,Utils,$timeout){return{restrict:"E",replace:!0,scope:!0,link:function(scope){scope.complimentsSwiper={},scope.showComplimentsLoader=!1,scope.activeTap="",scope.chooseTab="",scope.photo=null,scope.compliments=[],scope.employee={},scope.showEmployeeModal=function(){return ClientInfo.showEmployeeModal},scope.hideEmployeeModal=function(){scope.employee={},angular.element(document.querySelector(".swiper-wrapper")).children().remove();var dialog=$(".ngdialog");ClientInfo.showEmployeeModal=!1,$("body").removeAttr("style"),ClientInfo.mobileWidth()?(dialog.css("animation","ngdialog-flyout .4s"),setTimeout(function(){dialog.removeAttr("style")},500)):dialog.removeAttr("style")},scope.$on("closeEmployeeModal",function(){scope.hideEmployeeModal()}),scope.employeeTaps=function(){scope.chooseTab?scope.activeTap=scope.chooseTab:scope.compliments.length?scope.activeTap="compliments":scope.employee.comments.comments.length&&(scope.activeTap="reviews")},scope.changeEmployeeTaps=function(tap){scope.activeTap=tap},scope.selectEmployeeModal=function(employee){scope.hideEmployeeModal(),ClientInfo.isSelectedAnyEmployee=!1,ClientInfo.selectEmployee(employee),ClientInfo.serviceCollection.length?$rootScope.$broadcast("goTo","calendar"):$rootScope.$broadcast("goTo","services")},scope.complimentsData=function(){return scope.compliments},scope.$watch(function(){return scope.showEmployeeModal()},function(value){value&&(scope.compliments=[],scope.employee=ClientInfo.selectedEmployeeModal,scope.chooseTab=ClientInfo.selectedEmployeeModalTab,Utils.loadEmployeeCompliments(scope.employee).then(function(response){scope.compliments=response,scope.employeeTaps(),scope.$$phase||scope.$apply()}))}),scope.initSwiper=function(){scope.showComplimentsLoader=!0,scope.complimentsSwiper.initialized&&scope.complimentsSwiper.destroy(),$timeout(function(){scope.complimentsSwiper=new Swiper(".employee-swiper-container",{slidesPerView:4,spaceBetween:0}),scope.showComplimentsLoader=!1},0)},scope.repeatComplimentsFinished=function(init){init&&scope.initSwiper()},scope.LANG=ClientInfo.LANG,scope.HOST=ClientInfo.HOST,scope.getMasterName=function(employee){return ClientInfo.getMasterName(employee)},scope.getReviewDate=function(text){var tempDate=new Date(text.replace(/-/g,"/"));return $filter("date")(tempDate,"dd.MM.yyyy")},scope.filePath=FILE_PATH},template:'\n<div ng-show="showEmployeeModal()" class="ngdialog ngdialog-theme-default e" role="alertdialog">\n    \n    <style>\n        .employee-swiper-container {\n            margin: 24px 0 30px 0;\n        }\n    </style>\n    <style ng-if="showEmployeeModal()">\n        body{\n            position: fixed;\n        }\n    </style>\n    \n    <div ng-click="hideEmployeeModal(); $event.stopPropagation();" class="ngdialog-overlay"></div>\n    <div class="ngdialog-content" role="document">\n<div class="employee-modal">\n    <div class="employee-modal-top">\n        <div class="employee-photo-area">\n            <div class="employee-photo-box">\n                <img class=\'employee-photo\' fallback-src="{{filePath}}images/default-employee.png" ng-src=\'{{HOST+employee.photo}}\' ng-if=\'employee.photo\'/>\n                <img class=\'employee-photo\' ng-src="{{filePath}}images/default-employee.png" ng-if=\'!employee.photo\'/>\n            </div>\n        </div>\n        <span class="employee-name">{{ getMasterName(employee) }}</span>\n        <span class="employee-position">{{ employee.positionName }}</span>\n        <div class="employee-adds-area">\n            <div class="employee-adds-box">\n                <div class="employee-adds-item" ng-if="employee.avarageRating">\n                    <span class="employee-adds-item-value">{{employee.avarageRating | number:1}}</span>\n                    <span ng-style="{\'background-image\': \'url(\' + filePath + \'images/star.svg)\'}" class="employee-item-icon rating-icon"></span>\n                    <span class="employee-adds-name">Оценка</span>\n                </div>\n            </div>\n            <div class="employee-adds-box">\n                <div ng-click="changeEmployeeTaps(\'compliments\'); $event.stopPropagation();" class="employee-adds-item" ng-if="compliments.length">\n                    <span class="employee-adds-item-value">{{compliments.length}}</span>\n                    <span ng-style="{\'background-image\': \'url(\' + filePath + \'images/heart.svg)\'}" class="employee-item-icon compliments-icon"></span>\n                    <span class="employee-adds-name">Комплименты</span>\n                </div>\n            </div>\n            <div class="employee-adds-box">\n                <div ng-click="changeEmployeeTaps(\'reviews\'); $event.stopPropagation();" class="employee-adds-item" ng-if="employee.countClientComment" >\n                    <span class="employee-adds-item-value">{{employee.countClientComment}}</span>\n                    <span ng-style="{\'background-image\': \'url(\' + filePath + \'images/comment.svg)\'}" class="employee-item-icon comments-icon"></span>\n                    <span class="employee-adds-name">Отзывы</span>\n                </div>\n            </div>\n        </div>\n        <div class="clear"></div>\n    </div>\n    <div ng-if="employee.description.length" class="employee-description">\n        {{ employee.description }}\n    </div>\n    <div ng-if="compliments.length || employee.comments.comments.length" class="employee-tabs color">\n        <span ng-class="{\'active\' : activeTap === \'compliments\'}" ng-show="compliments.length" class="employee-tab" ng-click="changeEmployeeTaps(\'compliments\')">{{organization.personal.employeeModal.tabCompliments}}</span>\n        <span ng-class="{\'active\' : activeTap === \'reviews\'}" ng-show="employee.comments.comments.length" class="employee-tab" ng-click="changeEmployeeTaps(\'reviews\')">{{organization.personal.employeeModal.tabReviews}}</span>\n        <div class="clear"></div>\n    </div>\n    <div ng-show="activeTap === \'compliments\'" class="employee-swiper-container swiper-container comliments-box" context-panel>\n        <div class="swiper-wrapper">\n            <div ng-init="repeatComplimentsFinished($last)" class="swiper-slide" ng-repeat="compliment in compliments">\n                <div class="employee-compliments-item">\n                    <img class="employee-item-compliments-item-icon" ng-src="{{filePath + compliment.img}}">\n                    <div class="employee-item-compliments-item-counter">{{compliment.count}}</div>\n                    <div class="employee-item-compliments-item-name">{{compliment.name}}</div>\n                </div>\n            </div>\n        </div>\n        <button class="time-calculating-overlay bg color text-center" ng-show="showComplimentsLoader"></button>\n    </div>\n    <div ng-show="activeTap === \'reviews\'" class="reviews-box" context-panel>\n        <div class="employee-reviews">\n            <div class="employee-review" ng-repeat="comment in employee.comments.comments">\n                <span class="employee-review-text">{{ comment.clientComment }}</span>\n                <span class="employee-review-date">{{ getReviewDate(comment.date) }}</span>\n            </div>\n        </div>\n    </div>\n    <div class="modal-select-employee-button-box">\n        <span ng-click="selectEmployeeModal(employee)" class="modal-select-employee-button background-color">{{organization.personal.employeeModal.button}}</span>\n    </div>\n</div>\n        <button ng-click="hideEmployeeModal(); $event.stopPropagation();" aria-label="Dismiss" class="ngdialog-close" title="Закрыть"></button>\n    </div>\n</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("fallbackSrc",function(){return{link:function(scope,iElement,iAttrs){iElement.bind("error",function(){angular.element(this).attr("src",iAttrs.fallbackSrc)})}}});var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("inputClick",function(){return{link:function(scope,element,attrs){element.bind("click",function(){var input=angular.element("#"+attrs.inputClick);setTimeout(function(){input.click()},0)})}}});var BookingAppDirectives=angular.module("BookingApp.directives"),BookingAppServices=angular.module("BookingApp.services");BookingAppServices.factory("Loadbar",[function(){var Loadbar={status:!1,show:function(){Loadbar.status=!0},hide:function(){Loadbar.status=!1}};return Loadbar}]),BookingAppDirectives.directive("loadbar",["Loadbar",function(Loadbar){return{restrict:"E",replace:!0,template:'<button class="time-calculating-overlay color text-center bg-white" ng-show="idShow()"></button>',link:function(scope,elem,attrs,controller){scope.idShow=function(){return Loadbar.status}}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("onLongPress",["$timeout",function($timeout){return{restrict:"A",link:function($scope,$elm,$attrs){$elm.bind("touchstart mousedown",function(evt){$scope.longPress=!0,$timeout(function(){$scope.longPress&&$scope.$apply(function(){$scope.$eval($attrs.onLongPress)})},parseInt($attrs.ms))}),$elm.bind("touchend mouseup",function(evt){$scope.longPress=!1,$attrs.onTouchEnd&&$scope.$apply(function(){$scope.$eval($attrs.onTouchEnd)})})}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("mainNextButton",["$filter","ClientInfo",function($filter,ClientInfo){return{restrict:"E",replace:!0,link:function(scope,element){scope.nextButton={activeButton:function(){return ClientInfo.serviceCollection.length>0&&Object.keys(ClientInfo.selectedEmployee).length&&ClientInfo.selectedDate instanceof Date&&ClientInfo.selectedTime&&ClientInfo.selectedTime.timeFormatted}}},template:'<div class="main-next-button-box">\n                    <span ng-class="{\'disabled\': !nextButton.activeButton()}"\n                     ng-click="goToButton(\'main\')" \n                     ng-if="showBackButton() && isSite()"\n                     ng-attr-title="{{getTitleForTopBackButton()}}"\n                     class="button main-next-button widget-buttons">Назад</span>\n                    <span ng-class="{\'disabled\': !nextButton.activeButton()}"\n                     ng-click="nextButton.activeButton() ? goTo(\'personal\') : \'\'"\n                     ng-class="{\'widget-buttons\':isSite()}"\n                     class="button main-next-button">{{organization.personal.nextButton}}</span>\n                     <div class="widget-bottom-link" ng-if="isSite()" ng-bind-html="getBottomLink()"></div>\n                </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("mainTelemedicine",[function(){return{restrict:"E",replace:!0,template:'\n<div>\n    <div class="m-box ng-scope" style="padding-bottom: 100px;">\n        <span class="m-logo ng-binding">Запись в клинику</span>\n    </div>\n    <div class="m-box" ng-show="!showLoader">\n        <div class="m-item-box">\n            <div ng-click="choseOfflineClick()"  class="m-item doctor">\n                <span class="m-item-text">В клинике</span>\n            </div>\n        </div>\n        <div class="m-item-box">\n            <div ng-click="choseOnlineClick()"  class="m-item online">\n                <span class="m-item-text">Онлайн</span>\n            </div>\n        </div>\n    </div>\n</div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("main",[function(){return{restrict:"E",replace:!0,template:'\n<div>\n    <button class="time-calculating-overlay color text-center" ng-show="showLoader"></button>\n    <div ng-show="!showLoader">\n        <stories-main-swiper-mobile ng-if="!isSite()"></stories-main-swiper-mobile>\n    </div>\n    <div class="m-box" style="padding-bottom: 0px;">\n        <span class="m-logo">{{organization.personal.main.title}}</span>\n        <span class="m-logo-2">{{organization.personal.main.title2}}</span>\n    </div>\n    <stories-main-swiper-desktop ng-if="!isSite()"></stories-main-swiper-desktop>\n    <div class="m-box" ng-show="!showLoader">\n        <select-service></select-service>\n        <select-employee></select-employee>\n        <select-time></select-time>\n        <div\n                ng-if="organization.networkID === 70 && !ClientInfo.isAuth &&\n                isArnica() && organization.akvarelBanners.akvarelBannerOZPage.length > 1"\n                class="akvarel-main-banner m-item-box"\n                ng-click="goTo(\'profile\')">\n            {{organization.akvarelBanners.akvarelBannerOZPage}}\n        </div>\n        <main-next-button></main-next-button>\n    </div>\n</div>'}}]),function(module){module.directive("marquee",function(){return{restrict:"A",link:function(scope,element,attrs){function browser(){var userAgent=window.navigator.userAgent,browsers={edge:/edge/i,ie:/internet explorer/i,firefox:/firefox/i,safari:/safari/i,chrome:/chrome/i};for(var key in browsers)if(browsers[key].test(userAgent))return key;return"unknown"}function watch(old,current){current&&setTimeout(function(){var child=element.find(attrs.marquee);if("edge"==browser())return void(element.text().replace(/\s/g,"").length+1>9&&element.addClass("marquee"));child&&child.length>0&&element.width()<=child.width()&&element.addClass("marquee")},300)}scope.$watch("taps",watch),watch(void 0,!0)}}}),module.directive("angMarquee",function(){return{restrict:"A",link:function(scope,element,attrs){var child=element,parent=element.parent();scope.$watch(attrs.angMarquee,function(old,current){old&&setTimeout(function(){child&&child.length>0&&child.width()>=parent.width()&&(old.length<20&&element.addClass("marquee-10"),old.length<40&&old.length>=20&&element.addClass("marquee-20"),old.length>40&&element.addClass("marquee-20"))},100)})}}})}(angular.module("BookingApp.directives"));var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("mask",function(){return{require:"ngModel",restrict:"A",link:function(scope,elem,attrs,controller){var element=$(elem);attrs.$observe("mask",function(){function replaceMask(mask){return baseMask=mask.split("#")[0],mask.replace(/(\d+)/g,"{$1}").replace(/\#/g,"0")}function UpdateInput(){var val=element.val();attrs.onmaskfull&&(scope.$eval(attrs.onmaskfull)&&"function"==typeof scope.$eval(attrs.onmaskfull)?attrs.mask.length==val.length&&/[0-9]/.test(val[val.length-1])?scope.$eval(attrs.onmaskfull+"("+!0+")"):scope.$eval(attrs.onmaskfull+"("+!1+")"):attrs.mask.length==val.length&&/[0-9]/.test(val[val.length-1])?scope.$eval(attrs.onmaskfull+"="+!0):scope.$eval(attrs.onmaskfull+"="+!1)),controller.$setViewValue(val)}var baseMask=null;if(attrs.mask){element.val(controller.$viewValue||"");var imask=new IMask(element.get(0),{mask:replaceMask(scope.$eval(angular.toJson(attrs.mask)))});scope.$watch(attrs.ngModel,function(val,old){if($(elem[0]).is(":focus")){if(old.length>val.length&&val.length<baseMask.length)return void(imask.value="");val=val.replace(/\D/g,"");var maskDigit=baseMask.replace(/\D/g,""),beginPhoneValDigit=val.replace(/\D/g,"").slice(0,maskDigit.length);"7"===maskDigit?"8"!==beginPhoneValDigit&&"7"!==beginPhoneValDigit||(val=val.slice(1)):beginPhoneValDigit===maskDigit&&(val=val.slice(maskDigit.length)),imask.value=baseMask+val}""===val&&imask.updateValue("")}),controller.$setViewValue(element.val()),element.attr("maxlength",attrs.mask.length),attrs.mask.split(".")&&attrs.mask.split(".").length>1&&scope.$watch(attrs.mask,function(value){new IMask(element.get(0),{mask:replaceMask(value)})}),"maskplaceholder"in attrs&&element.attr("placeholder",attrs.mask.replace(/\#/g," ˍ ").replace(/\s{2,2}/g," ")),element.keyup(function(){scope.$apply(UpdateInput)}),UpdateInput()}})}}});var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("match",["$sce",function($sce){var normText=function(text){return text?text.replace(/\s{2,}/," "):""};return{scope:{string:"@string",match:"@match"},restrict:"E",replace:!0,link:function(scope){var rx=new RegExp(scope.match,"i");scope.getResult=function(){var string=normText(scope.string),find=string.match(rx);return find?$sce.trustAsHtml(string.replace(rx,'<strong class="color">'+find[0]+"</strong>")):$sce.trustAsHtml(string)}},template:'<span ng-bind-html="getResult()"></span>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("moneyWidget",["$filter","$rootScope",function($filter,$rootScope){var number=$filter("number"),format=function(val,scale){return void 0===scale&&(scale=2),number(val,scale)};return{scope:{value:"@value",currency:"@currency",scale:"@scale"},restrict:"E",replace:!0,link:function(scope){scope.getNumber=function(){return format(scope.value,scope.scale)},scope.getCurrency=function(){return scope.currency||$rootScope.currency()}},template:function(element,attr){return attr.tag||(attr.tag="div"),"<"+attr.tag+'>&nbsp;<span class="number">{{ getNumber() }} {{ getCurrency() }}</span>  </'+attr.tag+">"}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("nearestRecordAnyMaster",["ClientInfo","EmployeeStorage","timeCalculator","settings","$http","$filter","Lang","CREATE_VISIT","CHANGE_VISIT",function(ClientInfo,EmployeeStorage,timeCalculator,settings,$http,$filter,Lang,CREATE_VISIT,CHANGE_VISIT){return{restrict:"E",replace:!0,scope:!0,template:'<div class="employee-times-items-wrapper ph2 pv2" ng-click="$event.stopPropagation()" ng-show="getServiceCollection().length">\n                        <p class="employee-times-header">{{getTitle()}}</p>\n                        <div class="employee-times-items" ng-show="timeElements.length">\n                            <time-element \n                                time="time"\n                                time-title="\'timeFormatted\'"\n                                click="selectEmployee(employee);onSelectTime(time);"\n                                field-selected="\'selected\'"\n                                ng-repeat="(key, time) in timeElements"\n                                ng-show="key < 5"\n                                class="employee-times-item"></time-element>\n                        </div>\n                </div>',link:function(scope,element,attrs){scope.employee&&scope.employee.timeIntervals&&(scope.step=timeCalculator.defaultStep||30,scope.timeElements=[],scope.today=new Date,scope.nearestRecordDate=null,scope.durationServices=ClientInfo.serviceCollection.reduce(function(sum,item){return sum+parseInt(item.duration)},0),scope.getServiceCollection=function(){return ClientInfo.serviceCollection||[]},scope.isToday=function(momentDate){return momentDate.isSame(moment().startOf("day"),"d")},scope.isTomorrow=function(momentDate){return momentDate.isSame(moment().subtract(-1,"days").startOf("day"),"d")},scope.getTitle=function(){var str={today:"сегодня",tomorrow:"завтра"},mDate=moment(scope.nearestRecordDate),key=scope.nearestRecordDate&&scope.isToday(mDate)&&"today";return key=key||scope.nearestRecordDate&&scope.isTomorrow(mDate)&&"tomorrow",scope.timeElements.length?"Ближайшая запись на ".concat(key?str[key]:"").concat(key?",":""," ").concat($filter("date")(scope.nearestRecordDate,"d MMM")):"К сожалению, нет возможности записаться на выбранные услуги на ближайшее время. Выберите ".concat(Lang.get("мастера")," и подберите удобное время.")},scope.init=function(_ref){var date=_ref.date,employeeId=_ref.employeeId,timeIntervals=_ref.timeIntervals,durationServices=_ref.durationServices;scope.freeTime=Object.values(timeIntervals).filter(function(item){return"object"===_typeof(item)}).map(function(item){return Object.assign({},item)}),scope.nearestRecordDate=moment(date).toDate(),scope.freeTime=scope.initDurationFreeTime(scope.freeTime,durationServices);var extremeTime=scope.getExtremeTime(scope.freeTime);scope.timeElements=scope.initTimeElements(extremeTime.startTime,extremeTime.endTime,scope.step),scope.isToday(moment(date))&&(scope.timeElements=scope.filterTodayTimeElements(scope.timeElements)),scope.timeElements.length||scope.getFirstDayByDuration(employeeId,durationServices).then(function(data){var empl;for(var key in data)key==employeeId&&(empl=data[key]);empl&&scope.init({employeeId:employeeId,date:empl.date,timeIntervals:empl.interval,durationServices:durationServices})})},scope.intervals=function(start,end){var current,step=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,result=[];for(start=moment(start,"hh:mm"),end=moment(end,"hh:mm"),end<start&&(end=end.add(1,"d")),current=moment(start);current<=end;)result.push({moment:moment(current),timeFormatted:current.format("HH:mm")}),current.add(step,"minutes");return result},scope.getFirstDayByDuration=function(employeeId,durationServices){return $http.get("".concat(HOST,"/booking/booking/getFirstDayByDuration"),{params:{ids:employeeId,duration:durationServices}}).then(function(res){return res.data})},scope.getBetweenDuration=function(startTime,endTime){return moment.duration(moment(endTime,"hh:mm").diff(moment(startTime,"hh:mm"))).as("minutes")},scope.filterTodayTimeElements=function(timeElements){var today=moment(new Date);return timeElements.filter(function(item){return item.moment>today})},scope.initDurationFreeTime=function(freeTime,duration){return freeTime.filter(function(item){return scope.getBetweenDuration(item.startTime,item.endTime)>=duration})},scope.initTimeElements=function(startTime,endTime,step){return scope.intervals(startTime,endTime,step).filter(function(time){return!!scope.freeTime.find(function(item){var endTime;return ClientInfo.type===CREATE_VISIT?(endTime=moment(item.endTime,"HH:mm").add(-scope.durationServices,"minutes"),time.moment>=moment(item.startTime,"hh:mm")&&time.moment<=endTime):ClientInfo.type===CHANGE_VISIT?(endTime=moment(item.endTime,"HH:mm").add(scope.durationServices,"minutes"),time.moment>=moment(item.startTime,"hh:mm")&&time.moment<=endTime):void 0})}).map(function(time){return time.selected=ClientInfo.selectedTime&&ClientInfo.selectedEmployee&&ClientInfo.selectedTime.timeFormatted===time.timeFormatted&&ClientInfo.selectedEmployee.id===scope.employee.id,time.time=60*time.moment.hours()+time.moment.minutes(),time})},scope.getExtremeTime=function(arr){if(!arr.length)return[];var res={startTime:arr[0].startTime,endTime:arr[0].endTime};return arr.forEach(function(time){moment(time.endTime,"hh.mm")>moment(res.endTime,"hh.mm")&&(res.endTime=time.endTime),moment(time.startTime,"hh.mm")<moment(res.startTime,"hh.mm")&&(res.startTime=time.startTime)}),res},scope.resetTimeElements=function(arr){return arr.map(function(item){return item.selected=!1,item})},scope.onSelectTime=function(time){scope.timeElements=scope.resetTimeElements(scope.timeElements),time.selected=!0;var countTime=moment(time.timeFormatted,"HH:mm");ClientInfo.selectedDate=new Date(scope.nearestRecordDate),ClientInfo.selectedTime={time:time.time,timeFormatted:time.timeFormatted,visitItems:ClientInfo.serviceCollection.map(function(item,key,arr){return key&&countTime.add(arr[key-1].duration,"minutes"),{employeeId:scope.employee.id,serviceId:item.id,startTime:countTime.format("HH:mm")}})},scope.goTo("personal")},scope.init({employeeId:scope.employee.id,date:scope.employee.timeIntervals.date,timeIntervals:scope.employee.timeIntervals,durationServices:scope.durationServices}))}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("nearestRecord",["ClientInfo","EmployeeStorage","timeCalculator","settings","$http","$filter","Lang","CREATE_VISIT","CHANGE_VISIT","nearestRecord",function(ClientInfo,EmployeeStorage,timeCalculator,settings,$http,$filter,Lang,CREATE_VISIT,CHANGE_VISIT,nearestRecord){return{restrict:"E",replace:!0,scope:!0,template:'<div class="employee-times-items-wrapper ph2 pv2" ng-click="$event.stopPropagation()" ng-show="checkServiceCollection()">\n                        <p class="employee-times-header">{{titleText}}</p>\n                        <div class="employee-times-items" ng-show="timeElements.length">\n                            <div \n                                class="time-el employee-times-item" \n                                ng-class="{\'background-color\': time[\'selected\']}" \n                                ng-click="selectEmployee(employee);onSelectTime(time);"\n                                onclick="window.MetrikaService.sendEvent(\'nearest_record_click\')"\n                                ng-repeat="(key, time) in timeElements | limitTo:5">\n                              {{time[\'timeFormatted\']}}\n                           </div>\n                           <div style="width: auto;padding: 0 15px;" ng-if="timeElements.length" ng-click="selectEmployee(employee);selectOtherTime()" class="time-el employee-times-item">Другое время</div>\n                           <div style="clear:both"></div>\n                        </div>\n                        <button style="padding-top: 9px" class="time-calculating-overlay color text-center" ng-show="showNearestRecordLoader"></button>\n                </div>',link:function(scope,element,attrs){scope.checkServiceCollection=function(){return ClientInfo.serviceCollection.length>0},scope.checkServiceCollection()&&(scope.showNearestRecordLoader=!0,scope.$on("nearestData",function(ev,data,durationServices){if(data&&data.employees&&scope.employee.id in data.employees||0===scope.employee.id){0===scope.employee.id&&(data.anyEmployee.interval=data.anyEmployee.interval.filter(function(item,index,self){return self.findIndex(function(t){return t.startTime===item.startTime&&t.endTime===item.endTime})===index}));var employee=0===scope.employee.id?data.anyEmployee:data.employees[scope.employee.id],nearestData=nearestRecord(employee,employee.step?employee.step:data.step,durationServices,data.cabinets,data.nowDateTime.date);scope.timeElements=nearestData.getTimeElements(),scope.titleText=nearestData.getTitleText(),scope.nearestRecordDate=nearestData.getNearestRecordDate(),scope.showNearestRecordLoader=!1}else scope.titleText="К сожалению, нет возможности записаться на выбранные услуги на ближайшее время. Выберите ".concat(Lang.get("мастера")," и подберите удобное время."),scope.showNearestRecordLoader=!1}),scope.$on("nearestDataEmpty",function(){scope.showNearestRecordLoader=!1,scope.titleText="К сожалению, нет возможности записаться на выбранные услуги на ближайшее время. Выберите ".concat(Lang.get("мастера")," и подберите удобное время.")}),scope.resetTimeElements=function(arr){return arr.map(function(item){return item.selected=!1,item})},scope.selectOtherTime=function(){scope.goTo("calendar")},scope.onSelectTime=function(time){var countTime=moment(time.timeFormatted,"HH:mm");ClientInfo.selectedDate=new Date(scope.nearestRecordDate),ClientInfo.selectedTime={time:time.time,timeFormatted:time.timeFormatted,visitItems:ClientInfo.serviceCollection.map(function(item,key,arr){key&&countTime.add(arr[key-1].duration,"minutes");var empID=scope.employee.id;if(0===empID){var check=!0;angular.forEach(scope.empsToServices,function(emp,key){check&&emp.includes(parseInt(item.id))&&(empID=key,check=!1)})}return{employeeId:empID,serviceId:item.id,startTime:countTime.format("HH:mm")}})},scope.goTo("personal")})}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("networkOrg",["$rootScope",function($rootScope){return{scope:{org:"=",go:"=",personal:"="},restrict:"E",replace:!0,link:function(scope){scope.isOpen=!1,scope.getMapUrl=function(){return"https://static-maps.yandex.ru/1.x/?ll=".concat(scope.org.yaCoordinates[1],",").concat(scope.org.yaCoordinates[0],"&l=map&z=16&pt=").concat(scope.org.yaCoordinates[1],",").concat(scope.org.yaCoordinates[0],",pm2rdl&size=300,160")}},template:'\n<div class="network-org-card">\n    <div class="head">\n        <div class="address">{{org.address}}\n            <div class="distance" ng-if="org.distance">{{org.distance}} {{personal.units.km}}</div>\n        </div>\n        <div class="icon-expand-arrow color" title="{{isOpen ? \'свернуть\' : \'развернуть\'}}" ng-class="{\'open\': isOpen}" ng-click="isOpen = !isOpen"></div>\n    </div>\n    <div class="expand" ng-class="{\'with-map\':org.yaCoordinates.length > 1 && org.yaIntegrationEnable}" ng-show="isOpen">\n        <div class="info">\n          <div class="network-work-days">\n                <div class="icon-work-clock color"></div>\n                <work-days schedule=\'{{org.workDays}}\'></work-days>                     \n          </div>\n          <div class="phone-container" ng-if="org.phone">\n                <div class="icon-work-phone color"></div>\n                <div><input type="hidden" mask="{{org.phoneMask}}" ng-model="org.notifyPhone">{{org.phone}}</div>\n          </div>\n          <img ng-if="org.yaCoordinates.length > 1 && org.yaIntegrationEnable" class="mobile" ng-src="{{getMapUrl()}}">\n          <button class="button-fill" ng-click="go(org.id)">Записаться</button>\n        </div>\n        <img ng-if="org.yaCoordinates.length > 1 && org.yaIntegrationEnable" class="desktop" ng-src="{{getMapUrl()}}">\n    </div>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("orderDetailsProducts",["$filter","Cart",function($filter,Cart){return{restrict:"E",replace:!0,link:function(scope){scope.hasDiscount=!1,scope.disc=0,scope.show=function(){return!Cart.isEmpty()},scope.getProducts=function(){return Cart.getAll()},scope.getAmountWithDiscount=function(){if(!Cart.isEmpty()){var result=Cart.getSumWithDiscount();return scope.checkDiscount(),scope.disc>0&&(result-=result/100*scope.disc,scope.hasDiscount=!0),result}return""},scope.getProductPrice=function(item){return Cart.isEmpty()?"":Cart.getSumItem(item)},scope.checkDiscount=function(){Cart.isEmpty()||(scope.hasDiscount=Cart.checkItemsHasDiscount())},scope.getAmountWithoutDiscount=function(){return Cart.isEmpty()?"":Cart.getSum()},scope.$watch("promoChecked",function(check,oldCheck){check&&check.result?scope.$watch("organization.settingsRefererProgram",function(value,old){value&&value.isActive&&(scope.referer=value,scope.referer.inviteeValue>0&&("percent"===scope.referer.inviteeArea?scope.inviteeType="%":scope.inviteeType=" "+scope.currency(),"friend_invitation_invitee_discount"===scope.referer.inviteeType?(scope.disc=scope.referer.inviteeValue,scope.getAmountWithDiscount(),scope.showFriendBlock=!1,scope.hasDiscount=!0):scope.showFriendBlock=!0))}):(scope.hasDiscount=!1,scope.disc=0,scope.getAmountWithDiscount(),scope.checkDiscount())}),scope.getPriceWithoutCentsWithDiscount=function(){return String(scope.getAmountWithDiscount().toFixed(2)).split(".")[0]},scope.getPriceCentsWithDiscount=function(){return String(scope.getAmountWithDiscount().toFixed(2)).split(".")[1]},scope.getPriceWithoutCents=function(){return String(scope.getAmountWithoutDiscount().toFixed(2)).split(".")[0]},scope.getPriceCents=function(){return String(scope.getAmountWithoutDiscount().toFixed(2)).split(".")[1]},scope.getCount=function(itemId){var count=Cart.itemsCount[itemId];return count||(count=0),count}},template:'\n    <div ng-show="show()" class="order-details">\n        <div ng-init="orderDetailsCheck()" ng-click="orderDetailsClick($event, true); $event.stopPropagation();" class="order-details-button color-after">{{organization.personal.orderDetails}}</div>\n            <div style="display:none" class="order-details-info products-info">\n                <div class="order-details-info_time-amount">\n                <span class="order-details-info__time">\n                    <span>Заказ</span>\n                </span>\n                <span ng-if="show()" class="order-details-info__amount">\n                    <span class="split-price">{{ getAmountWithDiscount() | money:true }} {{ currency() }}</span>\n                    <span ng-if="hasDiscount" class="split-discount-price-box ng-scope">\n                        <span class="split-discount-price">{{ getAmountWithoutDiscount() | money:true }} {{ currency() }}</span>\n                    </span>\n                </span>\n                <div class="clear"></div> \n            </div>\n            <div ng-if="show()" class="order-details-info_services">\n                <span ng-repeat="item in getProducts()" class="order-details-info__service order-details-info__product before-icon od-item od-before-icon">\n                    <span class="order-details-info__product-name">{{ item.Fullname }} x {{ getCount(item.Id) }}</span>\n                </span>\n                <div class="clear"></div>\n            </div>\n        </div>\n    </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("orderDetails",["$filter","ClientInfo","settings","$rootScope","$http",function($filter,ClientInfo,settings,$rootScope,$http){return{restrict:"E",replace:!0,link:function(scope,element,settings){scope.hasDiscount=!1,scope.disc=0,scope.orderDetails={showOrderDetails:function(){return this.showServices()},showEmployee:function(){return Object.keys(ClientInfo.selectedEmployee).length||ClientInfo.isSelectedAnyEmployee},showServices:function(){return ClientInfo.serviceCollection.length>0},showDate:function(){return this.showEmployee()&&this.showServices()&&ClientInfo.selectedDate instanceof Date},getServices:function(){return this.showServices()?ClientInfo.serviceCollection:[]},getEmployee:function(){if(this.showEmployee()){var masterName=ClientInfo.getMasterName(ClientInfo.selectedEmployee);return masterName||scope.getAnyMasterText()}return""},getDate:function(){return this.showDate?ClientInfo.selectedDate:""},getDatePersonal:function(){if(this.showDate())return ClientInfo.selectedDate.getDate()+" "+ClientInfo.getCalendarMonthSm(ClientInfo.selectedDate.getMonth())},getTime:function(){return this.showDate&&ClientInfo.selectedTime&&ClientInfo.selectedTime.timeFormatted?ClientInfo.selectedTime.timeFormatted:""},number:$filter("number"),format:function(val,scale){return void 0===scale&&(scale=2),this.number(val,scale)},getAmount:function(){if(this.showServices()){var priceSum=0,priceFromSum=0,priceTillSum=0,needFrom=!1,needTill=!1;return angular.forEach(ClientInfo.serviceCollection,function(service){Number(service.priceFrom)>0?priceFromSum+=Number(service.priceFrom)-Number(service.discountSum):priceFromSum+=Number(service.price)-Number(service.discountSum),Number(service.priceTill)>0?priceTillSum+=Number(service.priceTill)-Number(service.priceTillDiscountSum):priceTillSum+=Number(service.price)-Number(service.discountSum),priceSum+=Number(service.price)-Number(service.discountSum),Number(service.priceFrom)>0&&(needFrom=!0),Number(service.priceTill)>0&&(needTill=!0)}),scope.orderDetails.checkDiscount(),scope.disc>0&&(priceSum-=priceSum/100*scope.disc,priceFromSum-=priceFromSum/100*scope.disc,priceTillSum-=priceTillSum/100*scope.disc,scope.hasDiscount=!0),Number(priceSum)>0&&!needFrom&&!needTill&&($rootScope.orderDetailsResultThanks="price "+scope.currency(),$rootScope.orderDetailsResult=formatMoney(priceSum,null,!0)+" "+scope.currency()),needFrom&&!needTill&&($rootScope.orderDetailsResultThanks="от price "+scope.currency(),$rootScope.orderDetailsResult="от "+formatMoney(priceFromSum,null,!0)+" "+scope.currency()),!needFrom&&needTill&&($rootScope.orderDetailsResultThanks="до price "+scope.currency(),$rootScope.orderDetailsResult="до "+formatMoney(priceTillSum,null,!0)+" "+scope.currency()),needFrom&&needTill&&($rootScope.orderDetailsResultThanks='<span class="order-details-pr-part">от price</span><span class="order-details-pr-part"> до '+formatMoney(priceTillSum,null,!0)+" "+scope.currency()+"</span>",$rootScope.orderDetailsResult='<span class="order-details-pr-part">от '+formatMoney(priceFromSum,null,!0)+'</span><span class="order-details-pr-part"> до '+formatMoney(priceTillSum,null,!0)+" "+scope.currency()+"</span>"),$rootScope.orderDetailsResult}return""},getPriceTillAmount:function(){if(this.showServices()){var result=0;return angular.forEach(ClientInfo.serviceCollection,function(service){var price=service.price;service.isRangePrice&&(price=service.priceTill),result+=Number(price)-Number(service.discountSum)}),scope.amountPrice=result,scope.amountBasePrice=result,scope.orderDetails.checkDiscount(),scope.disc>0&&(scope.amountPrice=scope.amountBasePrice-scope.amountBasePrice/100*scope.disc,scope.hasDiscount=!0),scope.amountPrice}return""},checkDiscount:function(){this.showServices()&&(scope.hasDiscount=!1,angular.forEach(ClientInfo.serviceCollection,function(service){Number(service.discountSum)>0&&(scope.hasDiscount=!0)}))},getAmountWithoutDiscount:function(){if(this.showServices()&&scope.hasDiscount){var priceSum=0,priceFromSum=0,priceTillSum=0,needFrom=!1,needTill=!1;if(angular.forEach(ClientInfo.serviceCollection,function(service){Number(service.priceFrom)>0?priceFromSum+=Number(service.priceFrom):priceFromSum+=Number(service.price),Number(service.priceTill)>0?priceTillSum+=Number(service.priceTill):priceTillSum+=Number(service.price),priceSum+=Number(service.price),Number(service.priceFrom)>0&&(needFrom=!0),Number(service.priceTill)>0&&(needTill=!0)}),Number(priceSum)>0&&!needFrom&&!needTill)return formatMoney(priceSum,null,!0);if(needFrom&&!needTill)return"от "+formatMoney(priceFromSum,null,!0);if(!needFrom&&needTill)return"до "+formatMoney(priceTillSum,null,!0);if(needFrom&&needTill)return"от "+formatMoney(priceFromSum,null,!0)+" до "+formatMoney(priceTillSum,null,!0)}return""}},scope.$watch("promoChecked",function(check,oldCheck){check&&check.result?scope.$watch("organization.settingsRefererProgram",function(value,old){value&&value.isActive&&(scope.referer=value,scope.referer.inviteeValue>0&&("percent"===scope.referer.inviteeArea?scope.inviteeType="%":scope.inviteeType=" "+scope.currency(),"friend_invitation_invitee_discount"===scope.referer.inviteeType?(scope.disc=scope.referer.inviteeValue,scope.orderDetails.getAmount(),scope.showFriendBlock=!1,scope.hasDiscount=!0):scope.showFriendBlock=!0))}):(scope.hasDiscount=!1,scope.disc=0,scope.orderDetails.getAmount(),scope.orderDetails.checkDiscount())}),scope.$watch(function(){return ClientInfo.selectedClient},function(client,oldClient){client&&oldClient&&client.id!=oldClient.id&&ClientInfo.updateServiceCollectionWithDiscounts()}),scope.orderDetails.getAmount(),scope.orderDetails.checkDiscount(),ClientInfo.updateServiceCollectionWithDiscounts()},template:'\n    <div ng-show="orderDetails.showOrderDetails()" class="order-details">\n        <div ng-init="orderDetailsCheck()" ng-click="orderDetailsClick($event, true); $event.stopPropagation();" class="order-details-button color-after">{{organization.personal.orderDetails}}</div>\n            <div style="display:none" class="order-details-info">\n                <div class="order-details-info_time-amount">\n                <span class="order-details-info__time before-icon od-item od-before-icon">\n                    <span ng-show="orderDetails.showDate()">{{orderDetails.getDatePersonal()}} {{orderDetails.getTime()}}</span>\n                    <span ng-show="!orderDetails.showDate()">Не выбрано</span>\n                </span>\n                <span ng-show="orderDetails.showServices()" class="order-details-info__amount" >\n                    <span ng-bind-html="orderDetails.getAmount()" style="text-align:right;"></span>\n                    <span ng-show="hasDiscount" class="order-details-info__amount-w">\n                        <span style="color:black;text-align:right;">{{ orderDetails.getAmountWithoutDiscount() }} {{currency()}}</span>\n                    </span>\n                </span>          \n                <div style="clear:both"></div>\n            </div>\n            <div ng-show="orderDetails.showServices()" class="order-details-info_services">\n                <span ng-repeat="item in orderDetails.getServices()" class="order-details-info__service before-icon od-item od-before-icon">{{item.name}}</span>\n            </div>\n            <div ng-show="orderDetails.showEmployee()" class="order-details-info_employee">\n                <span class="order-details-info__employee before-icon od-item od-before-icon">{{ orderDetails.getEmployee() }}</span>\n            </div>\n        </div>\n    </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("paymentModal",["$rootScope","$http","ClientInfo","$location","$window","$document","settings","Cart","$sce","robokassa",function($rootScope,$http,ClientInfo,$location,$window,$document,settings,Cart,$sce,robokassa){return{restrict:"E",replace:!0,scope:!0,link:function(scope){scope.showPaymentLoader=!0,scope.interval=null,scope.iFrameUrl=null,scope.showModal=!1,scope.showPaymentModal=function(){return scope.showModal=!0,ClientInfo.showPaymentModal},scope.closePaymentModal=function(){scope.showModal=!1;var body=$("body");body.removeAttr("style"),body.removeClass("ovh"),clearInterval(scope.interval),ClientInfo.showPaymentModal=!1,$rootScope.$broadcast("checkVisitPayment"),robokassa.clearPaymentParameters()},scope.$watch(function(){return scope.showPaymentModal()},function(value){value&&window.Robokassa.StartPayment(robokassa.getPaymentParameters())}),window.addEventListener("message",function(e){"closeRobokassaFrame"===e.data.action&&scope.closePaymentModal()})},template:'\n<div class="overlay" ng-class="{open:showPaymentModal()}" ng-if="showModal">\n    <div class="overlay-content">\n        <div class="payment-modal">\n            <span class="payment-modal-close icomoon" ng-click="closePaymentModal(); $event.stopPropagation();" title="Закрыть"></span>\n            <div class="clear"></div>\n            <button class="time-calculating-overlay no-opacity color text-center" ng-show="showPaymentLoader"></button>\n        </div>\n    </div>\n</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("scrollToItem",["$rootScope",function($rootScope){return{restrict:"A",scope:{scrollTo:"@"},link:function(scope,$elm,attr){$elm.on("click",function(){$("html,body").animate({scrollTop:$(scope.scrollTo).offset().top},400)})}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("selectEmployee",["$filter","ClientInfo",function($filter,ClientInfo){return{restrict:"E",replace:!0,link:function(scope,element){scope.showEmployee=function(){return Object.keys(ClientInfo.selectedEmployee).length>0},scope.getEmployee=function(){return scope.showEmployee()?ClientInfo.getMasterName(ClientInfo.selectedEmployee):scope.getAnyMasterText()},scope.removeEmployee=function(){!Object.keys(ClientInfo.selectedEmployee).length||scope.existMastersForAllServices&&scope.employees&&1===scope.employees.length||!scope.existMastersForAllServices&&ClientInfo.serviceCollection.length||0===ClientInfo.selectedEmployee.id?scope.goTo("employees"):ClientInfo.selectedEmployee={}},scope.showRemoveButton=function(){return!0}},template:'<div class="m-item-box">\n                    <div onclick="window.MetrikaService.sendEvent(\'employees_click\')" ng-click="goTo(\'employees\')" amplitude-event="Онлайн-запись | Выбрать {{ ClientInfo.LANG.get(\'мастера\') }}" ng-class="{\'has-employee-icon\': checkEmployeeIcon()}" class="m-item select-employee has-subitems">\n                        <div ng-if="checkEmployeeIcon()" class="m-item-icon-box">\n                            <img ng-src="{{getEmployeeIconPath()}}" class="m-item-icon m-item-icon-services" />\n                        </div>\n                        <span class="m-item-text">{{getEmployeeText()}}</span>\n                    </div>\n                    <div ng-click="goTo(\'employees\'); $event.stopPropagation();" class="m-subitem employee" context-panel>\n                        <span class="m-subitem-employee">{{ getEmployee() }}</span>\n                        <span ng-show="showRemoveButton()" ng-click="removeEmployee(); $event.stopPropagation();" class="m-subitem-close-button" ng-attr-title="{{getEmployeeText()}}"></span>\n                    </div>\n                </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("selectService",["$filter","ClientInfo","$http","settings",function($filter,ClientInfo,$http,settings){return{restrict:"E",replace:!0,link:function(scope,element){scope.ClientInfo=ClientInfo,scope.services=ClientInfo.serviceCollection,scope.selectService={showServices:function(){return scope.services.length>0},getServices:function(){if(this.showServices())return scope.services},removeService:function(service){ClientInfo.serviceCollection.delete(service),angular.forEach(scope.services,function(svc,key){svc.id===service.id&&scope.services.splice(key,1)}),ClientInfo.endTimeVisit=null,ClientInfo.serviceCollection.length||ClientInfo.resetDateTime()},getAmount:function(){if(this.showServices()){var result=0;return angular.forEach(ClientInfo.serviceCollection,function(service){result+=Number(service.price)-Number(service.discountSum)}),result}return""},checkDiscount:function(){var result=!1;return this.showServices()&&angular.forEach(ClientInfo.serviceCollection,function(service){if(Number(service.discountSum)>0)return void(result=!0)}),result},getAmountWithoutDiscount:function(){if(this.showServices()&&this.checkDiscount()){var result=0;return angular.forEach(ClientInfo.serviceCollection,function(service){result+=Number(service.price)}),result}return""},goToService:function(service){ClientInfo.goToService=service}},ClientInfo.updateServiceCollectionWithDiscounts()},template:'<div class="m-item-box">\n                    <div onclick="window.MetrikaService.sendEvent(\'services_click\')" ng-click="goTo(\'services\')" amplitude-event="Онлайн-запись | Выбрать услугу" ng-class="{\'has-subitems\' : selectService.showServices(), \'has-services-icon\': checkServicesIcon()}" class="m-item select-service">\n                        <div ng-if="checkServicesIcon()" class="m-item-icon-box">\n                            <img ng-src="{{getServicesIconPath()}}" class="m-item-icon m-item-icon-services" />\n                        </div>\n                        <span class="m-item-text">{{getServicesText()}}</span>\n                    </div>\n                    <div ng-click="selectService.goToService(item); goTo(\'services\'); $event.stopPropagation();" ng-if="selectService.showServices() && item.id" ng-repeat="item in selectService.getServices()" class="m-subitem service">\n                        <span class="m-subitem-service-name">{{item.name}}</span>\n                        <span ng-if="!item.discountSum > 0 && !item.isRangePrice" class="m-subitem-price">\n                                от {{ item.price | number:2 }}\n                        </span>\n                        <span ng-if="item.discountSum > 0 && !item.isRangePrice" class="m-subitem-price">\n                                от {{ item.price - item.discountSum | number:2 }}\n                                <span ng-show="item.discountSum > 0" class="m-subitem-discount-price-box" style="left: 14px;">\n                                    <span class="m-subitem-discount-price">{{ item.price | number:2 }}</span>\n                                </span>\n                        </span>\n                        <span ng-if="item.discountSum > 0 && item.isRangePrice" class="m-subitem-price">\n                            <span ng-if="item.priceFrom > 0 && item.priceTill > 0">\n                                от {{ item.price - item.discountSum | number:2 }}\n                                <span ng-show="item.discountSum > 0" class="m-subitem-discount-price-box" style="left: 14px;">\n                                <span class="m-subitem-discount-price">{{ item.price | number:2 }}</span>\n                            </span>\n                            </span>\n                            <span ng-if="item.priceFrom > 0 && (item.priceTill == 0 || item.priceTill == undefined)">\n                                от {{ item.price - item.discountSum | number:2 }} {{currency()}}\n                                <span ng-show="item.discountSum > 0" class="m-subitem-discount-price-box" style="left: 14px;">\n                                <span class="m-subitem-discount-price">{{ item.price | number:2 }} {{currency()}}</span>\n                            </span>\n                            </span>\n                            <span ng-if="(item.priceFrom == 0 || item.priceFrom == undefined) && item.priceTill > 0">\n                                до {{ item.price - item.discountSum | number:2 }} {{currency()}}\n                                <span ng-show="item.discountSum > 0" class="m-subitem-discount-price-box" style="left: 14px;">\n                                <span class="m-subitem-discount-price">{{ item.price | number:2 }} {{currency()}}</span>\n                            </span>\n                            </span>\n                        </span>\n                        <span ng-if="item.discountSum > 0 && item.isRangePrice && item.priceFrom > 0 && item.priceTill > 0" class="m-subitem-price">\n                                до {{ item.priceTill - item.discountSum | number:2 }} {{currency()}}\n                                <span ng-show="item.discountSum > 0" class="m-subitem-discount-price-box" style="left: 14px;">\n                                <span class="m-subitem-discount-price">{{ item.priceTill | number:2 }} {{currency()}}</span>\n                            </span>\n                        </span>\n                        <span ng-if="!item.discountSum > 0 && item.isRangePrice" class="m-subitem-price">\n                            <span ng-if="item.priceFrom > 0 && item.priceTill > 0">\n                                от {{ item.price | number:2 }}\n                            </span>\n                            <span ng-if="item.priceFrom > 0 && (item.priceTill == 0 || item.priceTill == undefined)">\n                                от {{ item.price | number:2 }} {{currency()}}\n                            </span>\n                            <span ng-if="(item.priceFrom == 0 || item.priceFrom == undefined) && item.priceTill > 0">\n                                до {{ item.price | number:2 }} {{currency()}}\n                            </span>\n                        </span>\n                        <span ng-if="!item.discountSum > 0 && item.isRangePrice && item.priceFrom > 0 && item.priceTill > 0" class="m-subitem-price">\n                                до {{ item.priceTill | number:2 }} {{currency()}}\n                        </span>\n                        <span class="m-subitem-service-duration">{{ ClientInfo.serviceTimeConvert(item.duration) }}</span>\n                        <span ng-click="selectService.removeService(item); $event.stopPropagation();" class="m-subitem-close-button" title="Удалить услугу"></span>\n                    </div>\n                </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("selectTime",["$filter","ClientInfo",function($filter,ClientInfo){return{restrict:"E",replace:!0,link:function(scope,element){scope.selectTime={showEmployee:function(){return Object.keys(ClientInfo.selectedEmployee).length},showServices:function(){return ClientInfo.serviceCollection.length>0},showDate:function(){return this.showEmployee()&&this.showServices()},showDateSubitem:function(){return this.showEmployee()&&this.showServices()&&ClientInfo.selectedDate instanceof Date&&ClientInfo.selectedTime&&ClientInfo.selectedTime.timeFormatted},getDate:function(){return this.showDate()?ClientInfo.selectedDate:""},checkDate:function(){return this.showDate()&&ClientInfo.selectedTime&&ClientInfo.selectedTime.timeFormatted},getTime:function(){return this.checkDate()?ClientInfo.selectedTime.timeFormatted:""},getEndTimeVisit:function(){return this.checkDate()?" - "+ClientInfo.getEndTimeVisit():""},removeDateTime:function(){ClientInfo.resetDateTime()}}},template:'<div class="m-item-box">\n                        <div onclick="window.MetrikaService.sendEvent(\'select_time_click\')" class="m-item select-time" ng-class="{\'has-subitems\': selectTime.showDateSubitem(), disabled: !selectTime.showDate(), \'has-time-icon\': checkTimeIcon()}" ng-click="selectTime.showDate() ? goTo(\'calendar\') : \'\'" amplitude-event="Онлайн-запись | Выбрать время">\n                            <div ng-if="checkTimeIcon()" class="m-item-icon-box">\n                                <img ng-src="{{getTimeIconPath()}}" class="m-item-icon m-item-icon-services" />\n                            </div>\n                            <span class="m-item-text">{{getTimeText()}}</span>\n                        </div>\n                        <div ng-click="selectTime.showDate() ? goTo(\'calendar\') : \'\'" ng-if="selectTime.showDateSubitem()" class="m-subitem time">\n                            <span class="m-subitem-time">{{selectTime.getDate() | date :\'dd MMMM\'}} {{selectTime.getTime()}} {{selectTime.getEndTimeVisit()}}</span>\n                            <span ng-click="selectTime.removeDateTime(); $event.stopPropagation();" class="m-subitem-close-button" title="Удалить дату и время"></span>\n                        </div>\n                    </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("servicePriceFromTemplate",["ClientInfo",function(ClientInfo){return{restrict:"E",replace:!0,link:function(scope,element,attrs){},template:'<span>{{ clientInfo.getClearDiscPrice(item, \'priceFrom\') | number }}<span ng-show="clientInfo.getClearDiscPriceCent(item) > 0 ">,<span class="app-service-cents">{{ clientInfo.getClearDiscPriceCent(item, \'priceFrom\') }}</span>\n                </span>\n                <span ng-show="item.discountSum > 0">\n                    <span class="app-service-price-discount" style="left: 32px">{{ clientInfo.getClearPrice(item, \'priceFrom\') | number }}<span ng-show="clientInfo.getClearPriceCent(item) > 0 ">,<span>{{ clientInfo.getClearPriceCent(item, \'priceFrom\') }}</span></span></span>\n                    </span>\n                </span>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("servicePriceTemplate",["ClientInfo",function(ClientInfo){return{restrict:"E",replace:!0,link:function(scope,element,attrs){},template:'<span>{{ clientInfo.getClearDiscPrice(item, \'price\') | number }}<span ng-show="clientInfo.getClearDiscPriceCent(item) > 0 ">,<span class="app-service-cents">{{clientInfo.getClearDiscPriceCent(item, \'price\')}}</span>\n                </span>\n                <span ng-show="item.discountSum > 0">\n                    <span class="app-service-price-discount">{{ clientInfo.getClearPrice(item, \'price\') | number }}<span ng-show="clientInfo.getClearPriceCent(item) > 0 ">,<span>{{clientInfo.getClearPriceCent(item, \'price\')}}</span></span></span>\n                    </span>\n                </span>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("servicePriceTillTemplate",["ClientInfo",function(ClientInfo){return{restrict:"E",replace:!0,link:function(scope,element,attrs){},template:'<span>{{ clientInfo.getClearDiscPrice(item, \'priceTill\') | number }}<span ng-show="clientInfo.getClearDiscPriceCent(item) > 0 ">,<span class="app-service-cents">{{ clientInfo.getClearDiscPriceCent(item, \'priceTill\') }}</span>\n                </span>\n                <span ng-show="item.discountSum > 0" class="app-service-price-discount" style="left: 32px">{{ clientInfo.getClearPrice(item, \'priceTill\') | number }}<span ng-show="clientInfo.getClearPriceCent(item) > 0 ">,<span>{{ clientInfo.getClearPriceCent(item, \'priceTill\') }}</span></span>\n                </span>\n            </span>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("servicesSearchDesktop",["$filter","Utils","$timeout",function($filter,Utils,$timeout){return{restrict:"E",replace:!0,link:function(scope,element){scope.searchValueDesktop="",scope.resultItemsDesktop=[],scope.searchPs={};var itemsForSearch=scope.getItemsForSearch(Utils.servicesData);scope.$watch("searchValueDesktop",function(value){value?(value=value.replace(/[^0-9a-zA-Zа-яА-Я ]/g,""),value.length>=3?(scope.searchPs.isAlive&&(scope.searchPs.destroy(),$timeout(function(){scope.initSearchPs()},100)),scope.resultItemsDesktop=itemsForSearch.filter(function(item){return-1!==item.name.toLowerCase().indexOf(value.toLowerCase())})):scope.resultItemsDesktop=[]):scope.resultItemsDesktop=[]}),scope.initSearchPs=function(){scope.searchPs=new PerfectScrollbar(".d-ss-result-box")},scope.checkSearchValueDesktop=function(){return scope.searchValueDesktop.length>0},scope.repeatFinishedDesktop=function(init){init&&(scope.searchPs.isAlive||$timeout(function(){scope.initSearchPs()},0))},scope.clearSearchDesktop=function(){scope.searchValueDesktop=""},scope.getTitleDesktop=function(){return scope.checkSearchValueDesktop()?"Очистить":"Поиск по услугам"},scope.selectServiceDesktop=function(service){var category=Utils.servicesData.filter(function(item){return item.id===service.rootCategoryId});scope.choiceService(service,!1),scope.changeCategoryAndScrollToService(service,category[0]),scope.clearSearchDesktop()}},template:'\n<div data-title="{{getTitleDesktop()}}" ng-click="checkSearchValueDesktop() ? clearSearchDesktop() : \'\'" class="desktop d-services-search-box">\n    <input placeholder="{{organization.personal.services.search}}" ng-click="$event.stopPropagation();" ng-model="searchValueDesktop" class="d-ss-input border-color color color-placeholder"/>\n    <span ng-attr-title="{{getTitleDesktop()}}" ng-class="{\'active\': checkSearchValueDesktop()}" class="d-services-search-box-icon color-after"></span>\n    <div ng-click="$event.stopPropagation();" class="d-ss-result-box" ng-if="resultItemsDesktop.length" context-panel>\n        <div ng-init="repeatFinishedDesktop($last)" ng-click="selectServiceDesktop(item)" ng-class="{\'last\': $last}" class="d-ss-result-item" ng-repeat="item in resultItemsDesktop">\n            <span class="d-ss-result-item-category-name">{{item.categoryName}}</span>\n            <span class="d-ss-result-item-name">{{item.name}}</span>\n        </div>\n    </div>\n    \n</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("servicesSearchMobile",["$filter","ClientInfo","$timeout","Utils",function($filter,ClientInfo,$timeout,Utils){return{restrict:"E",replace:!0,link:function(scope,element){scope.searchValueMobile="",scope.resultItemsMobile=[];var itemsForSearch=scope.getItemsForSearch(Utils.servicesData);scope.$watch("searchValueMobile",function(value){value?(value=value.replace(/[^0-9a-zA-Zа-яА-Я ]/g,""),value.length>=3?scope.resultItemsMobile=itemsForSearch.filter(function(item){return-1!==item.name.toLowerCase().indexOf(value.toLowerCase())}):scope.resultItemsMobile=[]):scope.resultItemsMobile=[]}),scope.checkSearchValueMobile=function(){return scope.searchValueMobile.length>0},scope.clearSearchMobile=function(){scope.searchValueMobile=""},scope.selectServiceMobile=function(service){var category=Utils.servicesData.filter(function(item){return item.id===service.rootCategoryId});scope.choiceService(service,!1),scope.changeCategoryAndScrollToService(service,category[0]),scope.closeServicesSearchModal()},scope.openServicesSearchModal=function(){ClientInfo.showServicesSearchModal=!0,$("body").addClass("ovh")},scope.closeServicesSearchModal=function(){ClientInfo.showServicesSearchModal=!1,$("body").removeClass("ovh"),scope.clearSearchMobile()},scope.$on("closeServicesSearchModal",function(){scope.closeServicesSearchModal()}),scope.showServicesSearchModal=function(){return ClientInfo.showServicesSearchModal},scope.$watch(function(){return scope.showServicesSearchModal()},function(value){value&&$timeout(function(){var input=$(".ssm-input");input.trigger("click"),input.focus()},0)})},template:'\n<div context-panel>\n    <span title="Поиск по услугам" ng-click="openServicesSearchModal()" class="m-services-search-button mobile color">4</span>\n    <div class="mobile overlay services-search" ng-class="{\'open\':showServicesSearchModal()}">\n        <div class="overlay-content">\n            <div class="services-search-modal-content">\n                <div ng-click="$event.stopPropagation();" class="ssm-input-box">\n                    <input class="ssm-input color border-color color-placeholder" placeholder="{{organization.personal.services.search}}" ng-model="searchValueMobile"/>\n                    <span title="Закрыть" ng-click="closeServicesSearchModal()" class="ssm-close-button color"></span>\n                </div>\n                <div ng-click="$event.stopPropagation();" class="ssm-result-box" ng-if="resultItemsMobile.length">\n                    <div ng-click="selectServiceMobile(item)" ng-class="{\'last\': $last}" class="ssm-result-item" ng-repeat="item in resultItemsMobile">\n                        <span class="ssm-result-item-category-name">{{item.categoryName}}</span>\n                        <span class="ssm-result-item-name">{{item.name}}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</divcontext-panel>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("splitPrice",["$filter","$rootScope",function($filter,$rootScope){var number=$filter("number"),format=function(val,scale){return void 0===scale&&(scale=0),number(val,scale)};return{scope:{price:"@price",count:"@count",scale:"@scale",discount:"@discount",defaultWithDiscount:"@defaultWithDiscount",withoutDiscountBox:"@withoutDiscountBox"},restrict:"E",replace:!0,link:function(scope){scope.price=scope.price||0,scope.count=scope.count||1,scope.scale=scope.scale||0,scope.discount=scope.discount||0,scope.defaultWithDiscount=scope.defaultWithDiscount||0,scope.withoutDiscountBox=scope.withoutDiscountBox||0,scope.getCurrency=function(){return scope.currency||$rootScope.currency()},scope.getNumber=function(){return format(scope.price,scope.scale)},scope.getPriceWithoutCentsWithDiscount=function(){var d="0"!=scope.defaultWithDiscount?scope.discount:0;return String(((parseFloat(scope.price)-d)*scope.count).toFixed(2)).split(".")[0]},scope.getPriceCentsWithDiscount=function(){var d="0"!=scope.defaultWithDiscount?scope.discount:0;return String(((parseFloat(scope.price)-d)*scope.count).toFixed(2)).split(".")[1]},scope.getPriceWithoutCents=function(){return String((parseFloat(scope.price)*scope.count).toFixed(2)).split(".")[0]},scope.getPriceCents=function(){return String((parseFloat(scope.price)*scope.count).toFixed(2)).split(".")[1]},scope.showWithoutDiscountBox=function(){return"0"!=scope.withoutDiscountBox&&scope.discount>0}},template:function(element,attr){return attr.tag||(attr.tag="span"),"<"+attr.tag+' ng-class=\'{"has-box": withoutDiscountBox }\' class="split-price-box"><span class="split-price">{{ getPriceWithoutCentsWithDiscount() }}<span ng-show="getPriceCentsWithDiscount() > 0">,<span class="split-cents">{{ getPriceCentsWithDiscount() }}</span></span> {{ getCurrency() }}</span><span ng-if="showWithoutDiscountBox()" class="split-discount-price-box"><span class="split-discount-price">{{ getPriceWithoutCents() }}<span ng-show="getPriceCents() > 0">,<span class="split-discount-cents">{{ getPriceCents() }}</span></span> {{ getCurrency() }}</span></span></'+attr.tag+">"}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("star",["$parse","starService",function($parse,starService){return{restrict:"A",template:'<span class="rating-star" ng-repeat="item in starElements"></span>',link:function(scope,element,attrs){var data=scope.$eval(attrs.star);"number"==typeof data?scope.starElements=starService.initNumber(data):data instanceof Array&&(scope.starElements=starService.initArray(data))}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("storiesDesktop",["$timeout",function($timeout){return{restrict:"E",replace:!0,link:function(scope,element){scope.showStories_Desktop=!1,scope.activeStory_Desktop={},scope.slideTime_Desktop=1e4,scope.activeSlideIndex_Desktop=-1,scope.pause_Desktop=!1,scope.fakeClick=!1,scope.openStory_Desktop=function(id){angular.forEach(scope.stories,function(story){parseInt(story.id)===parseInt(id)&&(scope.showStories_Desktop=!0,story.active=!0,scope.startStory_Desktop(story))})},scope.initClass=function(slide,index){var i=scope.stories.findIndex(function(i){return i.active}),lefter=!1,righter=!1;return index<i&&(lefter=!0),index>i&&(righter=!0),{"stories-slide-lefter":lefter,"stories-slide-left":scope.stories[index+1]&&scope.stories[index+1].active,"stories-slide-center":scope.stories[index].active,"stories-slide-right":scope.stories[index-1]&&scope.stories[index-1].active,"stories-slide-righter":righter}},scope.startStory_Desktop=function(story){scope.time_Desktop&&scope.time_Desktop.clear(),scope.activeStory_Desktop=story,angular.forEach(scope.stories,function(s){s.active=!1,s.id!==scope.activeStory_Desktop.id&&angular.forEach(s.slides,function(slide,key){slide.showPreview=0===key,slide.active=!1,slide.seen=!1})}),scope.activeStory_Desktop.active=!0,scope.startSlide_Desktop(0)},scope.startSlide_Desktop=function(slideIndex){scope.activeSlideIndex_Desktop=slideIndex,scope.activeStory_Desktop.slides[slideIndex].showPreview=!1,scope.activeStory_Desktop.slides[slideIndex].active=!0,scope.time_Desktop=new scope.Timer(function(){scope.activeStory_Desktop.slides[slideIndex].active=!1,scope.activeStory_Desktop.slides[slideIndex].seen=!0,scope.activeStory_Desktop.slides[slideIndex+1]?scope.startSlide_Desktop(slideIndex+1):(scope.activeStory_Desktop.slides[slideIndex].active=!0,scope.nextStory_Desktop()),scope.$apply()},scope.slideTime_Desktop)},scope.storeClick=function(story,index){!story.active&&scope.stories[index+1]&&scope.stories[index+1].active?scope.prevStory_Desktop():!story.active&&scope.stories[index-1]&&scope.stories[index-1].active&&scope.nextStory_Desktop()},scope.prevStory_Desktop=function(){scope.stories[scope.activeStory_Desktop.number-1]&&scope.startStory_Desktop(scope.stories[scope.activeStory_Desktop.number-1])},scope.nextStory_Desktop=function(){scope.stories[scope.activeStory_Desktop.number+1]?scope.startStory_Desktop(scope.stories[scope.activeStory_Desktop.number+1]):scope.closeStories_Desktop()},scope.goPrevSlide_Desktop=function(){scope.fakeClick||(scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop-1]?(scope.time_Desktop&&scope.time_Desktop.clear(),scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop].active=!1,scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop].seen=!1,scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop-1].seen=!1,scope.startSlide_Desktop(scope.activeSlideIndex_Desktop-1)):scope.prevStory_Desktop())},scope.goNextSlide_Desktop=function(){scope.fakeClick||(scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop+1]?(scope.time_Desktop&&scope.time_Desktop.clear(),scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop].active=!1,scope.activeStory_Desktop.slides[scope.activeSlideIndex_Desktop].seen=!0,scope.startSlide_Desktop(scope.activeSlideIndex_Desktop+1)):scope.nextStory_Desktop())},scope.closeStories_Desktop=function(){scope.showStories_Desktop=!1,scope.activeStory_Desktop={},scope.activeSlideIndex_Desktop=-1,scope.time_Desktop&&scope.time_Desktop.clear(),angular.forEach(scope.stories,function(story){story.active=!1,angular.forEach(story.slides,function(slide,key){slide.showPreview=!1,slide.active=!1,slide.seen=!1})})},scope.hideElementsAndEnablePause_Desktop=function(){scope.pause_Desktop=!0,scope.fakeClick=!0,scope.time_Desktop&&scope.time_Desktop.pause()},scope.showElementsAndDisablePause_Desktop=function(){scope.pause_Desktop=!1,scope.time_Desktop&&scope.time_Desktop.resume(),setTimeout(function(){scope.fakeClick=!1,scope.$apply()},200)},scope.onLongPress_Desktop=function(){scope.hideElementsAndEnablePause_Desktop()},scope.onTouchEnd_Desktop=function(){scope.showElementsAndDisablePause_Desktop()}},template:'\n<div ng-if="showStories_Desktop" class="desktop stories-wrapper flex">\n    <style>\n        body {\n            overflow: hidden;\n        }\n    </style>\n    <div class="stories-slides relative" style="width:100%;max-width: 800px;height:600px;margin: auto;">\n        <div class="stories-slide" ng-repeat="(index, story) in stories" ng-init="initStory(story)"  ng-click="storeClick(story, index)" ng-class="initClass(story, index, stories)" context-panel>\n            \n            <div ng-class="{\'pause\': pause_Desktop && story.active}" class="slides-pointers">\n                <div>\n                    <span ng-class="{\'seen\': slide.seen, \'active\': slide.active}" ng-repeat="slide in story.slides">\n                        <b style="animation-duration:{{slideTime_Desktop / 1000}}s"></b>\n                    </span>\n                </div>\n            </div>\n            \n            <div ng-class="{\'active\':slide.active || slide.showPreview, \'pause\': pause_Desktop}" class="story-content" ng-repeat="slide in story.slides">\n                <img class="story-img" ng-src="{{host + slide.photo}}">\n                <div class="story-text-content">\n                    <span class="story-text-logo">{{slide.logo}}</span>\n                    <div class="story-text" ng-bind-html="slide.textFormatted"></div>\n                    <div class="story-buttons">\n                        <div ng-if="story.canLike && isAuth()" class="story-like-button v-mid">\n                            <img class="v-mid" \n                                ng-click="toggleLike(story)"\n                                ng-src="{{filePath}}{{ story.liked ? \'images/like-active.svg\' : \'images/like-inactive.svg\'}}" \n                                alt="{{story.liked ? \'Убрать лайк\' : \'Поставить лайк\'}}">\n                        </div>\n                        <div ng-if="story.canDislike && isAuth()" class="story-dislike-button v-mid">\n                            <img class="v-mid"\n                                ng-click="toggleDislike(story)"\n                                ng-src="{{filePath}}{{story.disliked ? \'images/dislike-active.svg\' : \'images/dislike-inactive.svg\'}}" \n                                alt="{{story.disliked ? \'Убрать дизлайк\' : \'Поставить дизлайк\'}}">\n                        </div>\n                        <div class="story-action-button-box has-like-dislike v-mid">\n                            <div ng-if="storyHasButton(story)" ng-click="storyActionButtonClick(story)" class="story-action-button">{{story.button}}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div alt="Предыдущий слайд" ng-if="story.active" ng-click="goPrevSlide_Desktop(); $event.stopPropagation()" ms="200" on-long-press="onLongPress_Desktop()" on-touch-end="onTouchEnd_Desktop()" class="stories-go-to-slide-nav stories-go-to-prev-slide"></div>\n            <div alt="Следующий слайд" ng-if="story.active" ng-click="goNextSlide_Desktop(); $event.stopPropagation()" ms="200" on-long-press="onLongPress_Desktop()" on-touch-end="onTouchEnd_Desktop()" class="stories-go-to-slide-nav stories-go-to-next-slide"></div>\n            \n            <div ng-if="story.active && clickFix" class="story-click-fix"></div>\n            \n            <div class="story-layer"></div>\n        </div>\n    </div>\n    <div title="Закрыть" ng-click="closeStories_Desktop(); $event.stopPropagation();" class="close-stories-button"></div>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("storiesMainSwiperDesktop",["$filter","ClientInfo","$rootScope",function($filter,ClientInfo,$rootScope){return{restrict:"E",replace:!0,scope:{},link:function(scope,element){scope.storiesMainSwiper={},scope.showStories=!1,scope.$watch(function(){return ClientInfo.storiesData},function(value){scope.stories=value}),scope.repeatFinishedInitSwiper=function(init){init&&scope.stories.length>4&&(scope.storiesMainSwiper.initialized&&scope.storiesMainSwiper.destroy(),setTimeout(function(){scope.storiesMainSwiper=new Swiper("#stories-swiper-desktop",{direction:"horizontal",spaceBetween:16,slidesPerView:5,mousewheel:!1,simulateTouch:!1,navigation:{nextEl:".main-stories-swiper-button-next",prevEl:".main-stories-swiper-button-prev"}}),scope.showStories=!0,scope.$apply()},0))},scope.openStory=function(id){$rootScope.$broadcast("openStory",id)},scope.host=window.HOST},template:'\n<div class="noselect main-stories-wrapper">\n    <div id="stories-swiper-desktop" style="width: 536px;" class="stories-main-swiper-container swiper-container desktop">\n        <div class="swiper-wrapper">\n            <div \n            class="swiper-slide story-main-swiper-slide" \n            back-img="{{host + story.photo}}" \n            ng-init="repeatFinishedInitSwiper($last)" \n            ng-repeat="story in stories" \n            ng-click="openStory(story.id)">\n                <span class="story-main-text">{{story.name}}</span>\n                <div class="story-main-layer"></div>\n            </div>\n        </div> \n    </div>\n    <div ng-show="showStories" class="main-stories-swiper-button-next icomoon color-before" title="Следующие истории"></div>\n    <div ng-show="showStories" class="main-stories-swiper-button-prev icomoon color-before" title="Предыдущие истории"></div>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("storiesMainSwiperMobile",["$filter","ClientInfo","$rootScope",function($filter,ClientInfo,$rootScope){return{restrict:"E",replace:!0,scope:{},link:function(scope,element){scope.storiesMainSwiper={},scope.storiesSwiper={},scope.showStories=!1,scope.activeStory={},scope.slideTime=1e4,scope.activeSlideIndex=-1,scope.pause=!1,scope.$watch(function(){return ClientInfo.storiesData},function(value){scope.stories=value}),scope.repeatFinishedInitSwiper=function(init){init&&(scope.storiesMainSwiper.initialized&&scope.storiesMainSwiper.destroy(),setTimeout(function(){scope.storiesMainSwiper=new Swiper("#stories-swiper-mobile",{direction:"horizontal",spaceBetween:0,freeMode:!0,slidesPerView:"auto",mousewheel:!0})},0))},scope.openStory=function(id){$rootScope.$broadcast("openStory",id)},scope.host=window.HOST},template:'\n<div id="stories-swiper-mobile" style="width: 100%" class="stories-main-swiper-container swiper-container mobile">\n    <div class="swiper-wrapper main-stories">\n        <div \n        class="swiper-slide story-main-swiper-slide" \n        back-img="{{host + story.photo}}" \n        ng-init="repeatFinishedInitSwiper($last)" \n        ng-repeat="story in stories" \n        ng-click="openStory(story.id)">\n            <span class="story-main-text">{{story.name}}</span>\n            <div class="story-main-layer"></div>\n        </div>\n    </div>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("storiesMobile",["isMobile",function(isMobile){return{restrict:"E",replace:!0,link:function(scope,element){scope.storiesSwiper_Mobile={},scope.showStories_Mobile=!1,scope.activeStory_Mobile={},scope.slideTime_Mobile=1e4,scope.activeSlideIndex_Mobile=-1,scope.pause_Mobile=!1,scope.paramsSwiper={effect:"cube",cubeEffect:{shadow:!1,slideShadows:!1,shadowOffset:20,shadowScale:.94},direction:"horizontal",spaceBetween:0,slidesPerView:"auto",mousewheel:!0},isMobile.apple.device&&(delete scope.paramsSwiper.effect,delete scope.paramsSwiper.cubeEffect),scope.initstoriesSwiper_Mobile=function($last){$last&&(scope.storiesSwiper_Mobile.initialized&&scope.storiesSwiper_Mobile.destroy(),setTimeout(function(){scope.storiesSwiper_Mobile=new Swiper("#stories-swiper-container-mobile",scope.paramsSwiper),scope.storiesSwiper_Mobile.slideTo($("#story-"+scope.activeStory_Mobile.id).index(),0,!1),scope.storiesSwiper_Mobile.on("slideChange",function(){scope.startStory_Mobile(scope.stories[scope.storiesSwiper_Mobile.activeIndex])})},0))},scope.openStory_Mobile=function(id){angular.element(document.querySelector(".close-stories-button")).click(),angular.forEach(scope.stories,function(story){parseInt(story.id)===parseInt(id)&&(scope.showStories_Mobile=!0,scope.startStory_Mobile(story))})},scope.startStory_Mobile=function(story){scope.time_Mobile&&scope.time_Mobile.clear(),scope.activeStory_Mobile=story,setTimeout(function(){angular.forEach(scope.stories,function(story){story.id!==scope.activeStory_Mobile.id&&angular.forEach(story.slides,function(slide,key){slide.showPreview=0===key,slide.active=!1,slide.seen=!1})}),scope.$apply()},500),scope.startSlide_Mobile(0)},scope.startSlide_Mobile=function(slideIndex){scope.activeSlideIndex_Mobile=slideIndex,scope.activeStory_Mobile.slides[slideIndex].showPreview=!1,scope.activeStory_Mobile.slides[slideIndex].active=!0,scope.time_Mobile=new scope.Timer(function(){scope.activeStory_Mobile.slides[slideIndex].active=!1,scope.activeStory_Mobile.slides[slideIndex].seen=!0,scope.activeStory_Mobile.slides[slideIndex+1]?scope.startSlide_Mobile(slideIndex+1):(scope.activeStory_Mobile.slides[slideIndex].active=!0,scope.nextStory_Mobile()),scope.$apply()},scope.slideTime_Mobile)},scope.prevStory_Mobile=function(){scope.stories[scope.activeStory_Mobile.number-1]&&scope.storiesSwiper_Mobile.slidePrev()},scope.nextStory_Mobile=function(){scope.stories[scope.activeStory_Mobile.number+1]?scope.storiesSwiper_Mobile.slideNext():scope.closeStories_Mobile()},scope.goPrevSlide_Mobile=function(){scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile-1]?(scope.time_Mobile&&scope.time_Mobile.clear(),scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile].active=!1,scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile].seen=!1,scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile-1].seen=!1,scope.startSlide_Mobile(scope.activeSlideIndex_Mobile-1)):scope.prevStory_Mobile()},scope.goNextSlide_Mobile=function(){scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile+1]?(scope.time_Mobile&&scope.time_Mobile.clear(),scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile].active=!1,scope.activeStory_Mobile.slides[scope.activeSlideIndex_Mobile].seen=!0,scope.startSlide_Mobile(scope.activeSlideIndex_Mobile+1)):scope.nextStory_Mobile()},scope.closeStories_Mobile=function(){scope.showStories_Mobile=!1,scope.activeStory_Mobile={},scope.activeSlideIndex_Mobile=-1,scope.time_Mobile&&scope.time_Mobile.clear(),angular.forEach(scope.stories,function(stories){angular.forEach(stories.slides,function(slide,key){slide.showPreview=!1,slide.active=!1,slide.seen=!1})})},scope.hideElementsAndEnablePause_Mobile=function(){scope.pause_Mobile=!0,scope.time_Mobile&&scope.time_Mobile.pause()},scope.showElementsAndDisablePause_Mobile=function(){scope.pause_Mobile=!1,scope.time_Mobile&&scope.time_Mobile.resume()},scope.onLongPress_Mobile=function(){scope.hideElementsAndEnablePause_Mobile()},scope.onTouchEnd_Mobile=function(){scope.showElementsAndDisablePause_Mobile()},scope.openLink=function(link){window.open(link,"_system")},scope.layerClick=function(story){scope.storyHasButton(story)&&"Хочу участвовать"!==story.button&&scope.storyActionButtonClick(story),scope.storyHasButton(story)&&"Хочу участвовать"===story.button&&scope.openLink(story.wantJoiningLink)}},template:'\n<div ng-if="showStories_Mobile" class="mobile overlay stories" ng-class="{open:showStories_Mobile}">\n    <style>\n        body {\n            position: fixed;\n            width: 100%;\n            overflow: hidden;\n            top: 0;\n            bottom: 0;\n        }\n    </style>\n    <div class="stories-overlay-content" ng-click="closePopup()">\n        <div class="stories-modal">\n            <div id="stories-swiper-container-mobile" style="width: 100%; max-height: 100%; height: 100%;" class="stories-swiper-container swiper-container">\n                <div class="swiper-wrapper">\n                    <div id="story-{{story.id}}" class="swiper-slide" ng-init="initstoriesSwiper_Mobile($last); initStory(story)" ng-if="story.slides.length" ng-repeat="story in stories">\n                        <div ng-class="{\'pause\': pause_Mobile}" class="slides-pointers">\n                            <div>\n                                <span ng-class="{\'seen\': slide.seen, \'active\': slide.active}" ng-repeat="slide in story.slides">\n                                    <b style="animation-duration:{{slideTime_Mobile / 1000}}s"></b>\n                                </span>\n                            </div>\n                        </div>\n                        <div ng-class="{\'active\':slide.active || slide.showPreview}" class="story-content" ng-repeat="slide in story.slides">\n                            <img class="story-img" ng-src="{{host + slide.photo}}">\n                            <div class="story-text-content">\n                                <span class="story-text-logo">{{slide.logo}}</span>\n                                <div class="story-text" ng-bind-html="slide.textFormatted"></div>\n                                <div class="story-buttons">\n                                    <div ng-if="story.canLike && isAuth()" class="story-like-button v-mid">\n                                        <img class="v-mid" \n                                            ng-click="toggleLike(story)"\n                                            ng-src="{{filePath}}{{ story.liked ? \'images/like-active.svg\' : \'images/like-inactive.svg\'}}" \n                                            alt="{{story.liked ? \'Убрать лайк\' : \'Поставить лайк\'}}">\n                                    </div>\n                                    <div ng-if="story.canDislike && isAuth()" class="story-dislike-button v-mid">\n                                        <img class="v-mid"\n                                            ng-click="toggleDislike(story)"\n                                            ng-src="{{filePath}}{{story.disliked ? \'images/dislike-active.svg\' : \'images/dislike-inactive.svg\'}}" \n                                            alt="{{story.disliked ? \'Убрать дизлайк\' : \'Поставить дизлайк\'}}">\n                                    </div>\n                                    <div class="story-action-button-box has-like-dislike v-mid">\n                                        <div ng-if="storyHasButton(story) && story.button !== \'Хочу участвовать\'" ng-click="storyActionButtonClick(story)" class="story-action-button">{{story.button}}</div>\n                                        <div ng-if="storyHasButton(story) && story.button === \'Хочу участвовать\'" ng-click="openLink(story.wantJoiningLink)" class="story-action-button">{{story.button}}</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div alt="Предыдущий слайд" ms="200" on-long-press="onLongPress_Mobile()" on-touch-end="onTouchEnd_Mobile()" ng-click="goPrevSlide_Mobile()" class="stories-go-to-slide-nav stories-go-to-prev-slide"></div>\n                        <div alt="Следующий слайд" ms="200" on-long-press="onLongPress_Mobile()" on-touch-end="onTouchEnd_Mobile()" ng-click="goNextSlide_Mobile()" class="stories-go-to-slide-nav stories-go-to-next-slide"></div>\n                        \n                        <div class="story-layer" ng-click="layerClick(story)"></div>\n                    </div>\n                </div>\n            </div>\n            <div ng-click="closeStories_Mobile(); $event.stopPropagation();" class="close-stories-button">g</div>\n        </div>\n    </div>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("stories",["ClientInfo","$http","settings","ServiceCollection","$rootScope","Cart","$window",function(ClientInfo,$http,settings,ServiceCollection,$rootScope,Cart,$window){return{restrict:"E",replace:!0,scope:{},link:function(scope){scope.like=!1,scope.dislike=!1,scope.MOBILE_APP=window.mobileapp,scope.$watch(function(){return ClientInfo.storiesData},function(value){scope.stories=value||[],scope.stories.forEach(function(story){story.slides&&story.slides.length&&story.slides.forEach(function(slide){if(slide.photo){(new Image).src=window.HOST+slide.photo}})})}),scope.$on("onChangeSalon",function(event,salon,networks){scope.stories=salon.stories}),scope.$on("openStory",function(ev,id){id&&(ClientInfo.mobileWidth()?scope.openStory_Mobile(id):scope.openStory_Desktop(id))}),scope.initStory=function(story){story.wantJoiningLink&&!window.mobileapp?(story.wantJoiningLink=story.wantJoiningLink.replace(/https?\:/g,""),/^\/\//g.test(story.wantJoiningLink)||(story.wantJoiningLink="//"+story.wantJoiningLink)):story.wantJoiningLink&&-1===story.wantJoiningLink.indexOf("http://")&&-1===story.wantJoiningLink.indexOf("https://")&&(story.wantJoiningLink="http://"+story.wantJoiningLink)},scope.Timer=function(callback,delay){var timerId,start,remaining=delay;this.pause=function(){window.clearTimeout(timerId),remaining-=new Date-start},this.resume=function(){start=new Date,window.clearTimeout(timerId),timerId=window.setTimeout(callback,remaining)},this.clear=function(){window.clearTimeout(timerId)},this.resume()},scope.validURL=function(str){return!!new RegExp("^(//)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(str)},scope.storyHasButton=function(story){return"buttonActive"in story&&"button"in story&&story.buttonActive},scope.storyActionButtonClick=function(story){if("Записаться"===story.button&&story.serviceList){var ids=[];angular.forEach(story.serviceList,function(serviceId){ids.push(serviceId)}),ServiceCollection.loadForIds(ids).then(function(){ClientInfo.mobileWidth()?scope.closeStories_Mobile():scope.closeStories_Desktop(),$rootScope.$broadcast("goTo","employees")})}else if("Купить"===story.button&&(story.commodityList||story.certificateList||story.abonementList)){var commodityIds=[],certificateIds=[],abonementIds=[];angular.forEach(story.commodityList,function(id){commodityIds.push(id)}),angular.forEach(story.certificateList,function(id){certificateIds.push(id)}),angular.forEach(story.abonementList,function(id){abonementIds.push(id)}),$http.get(window.HOST+"/booking/booking/getCommoditiesCategoriesList",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,withSubscriptions:!0}}).success(function(data){Cart.addCommodityItemsByIds(data,commodityIds),Cart.addCertificateItemsByIds(data,certificateIds),Cart.addAbonementItemsByIds(data,abonementIds),ClientInfo.mobileWidth()?scope.closeStories_Mobile():scope.closeStories_Desktop(),$rootScope.$broadcast("goTo","products-personal")})}else"Хочу участвовать"===story.button&&"wantJoiningLink"in story&&scope.validURL(story.wantJoiningLink)&&$window.open(story.wantJoiningLink,"_blank")},scope.isAuth=function(){return ClientInfo.isAuth},scope.toggleLike=function(story){story.liked=!story.liked,story.disliked=!1;var sessionCookie=window.localStorage.getItem("client_session_id");$http.get(window.HOST+"/booking/bookingStories/"+(story.liked?"":"un")+"like",{params:{storyID:story.id,networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,sesid:sessionCookie}})},scope.toggleDislike=function(story){story.disliked=!story.disliked,story.liked=!1;var sessionCookie=window.localStorage.getItem("client_session_id");$http.get(window.HOST+"/booking/bookingStories/"+(story.disliked?"":"un")+"dislike",{params:{storyID:story.id,networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,sesid:sessionCookie}})},scope.checkLike=function(story){return story.liked},scope.checkDislike=function(story){return story.disliked},scope.filePath=window.FILE_PATH,scope.host=window.HOST},template:"\n<div>\n    <stories-mobile></stories-mobile>\n    <stories-desktop></stories-desktop>\n</div>\n\n "}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("autoResize",autoResize),autoResize.$inject=["$timeout"];var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("timeElement",[function(){return{scope:{time:"=",fieldSelected:"=",timeTitle:"=",click:"&"},restrict:"E",replace:!0,template:'<div class="time-el" ng-class="{\'background-color\': time[fieldSelected]}" ng-click="select()">\n                      {{time[timeTitle]}}\n                   </div>',link:function(scope,element,attrs){scope.select=function(){scope.time[scope.fieldSelected]=!scope.time[scope.fieldSelected],scope.click({time:scope.time})}}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("timer",["$rootScope",function($rootScope){return{scope:{minutes:"@",tenSeconds:"@",seconds:"@",text:"@"},restrict:"E",template:'<div class="auth-block-timer">\n                       <p>{{text}} 0{{minutes}}:{{tenSeconds}}{{seconds}}</p>\n                   </div>',link:function(scope,element,attrs){scope.minutes=scope.minutes||0,scope.tenSeconds=scope.tenSeconds||0,scope.seconds=scope.seconds||0;var timer=setInterval(function(){if(0==scope.minutes&&0==scope.seconds&&0==scope.tenSeconds)return $rootScope.$broadcast("timeOver"),void clearInterval(timer);scope.seconds>0?scope.seconds--:0==scope.seconds&&0!=scope.tenSeconds?(scope.tenSeconds--,scope.seconds=9):0==scope.tenSeconds&&0==scope.seconds&&(scope.minutes--,scope.tenSeconds=5,scope.seconds=9),scope.$apply()},1e3)}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("toCartModal",["$rootScope","$filter","$http","ClientInfo",function($rootScope,$filter,$http,ClientInfo){return{restrict:"E",replace:!0,scope:!0,link:function(scope){scope.commodity={},scope.showModal=function(){return ClientInfo.showToCartModal},scope.closePopup=function(){var closeCommodityModal=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ClientInfo.showToCartModal=!1,$("body").removeAttr("style"),closeCommodityModal&&$rootScope.$broadcast("closeCommodityModal")},scope.getImg=function(){return ClientInfo.showToCartModal},scope.toCart=function(){scope.closePopup(!0),$rootScope.$broadcast("goTo","cart")},scope.getCommodityPhoto=function(){return ClientInfo.getCommodityPhoto(scope.commodity)},scope.$watch(function(){return scope.showModal()},function(value){value&&(scope.commodity=ClientInfo.selectedToCartCommodityModal)}),scope.filePath=FILE_PATH},template:'\n<div class="overlay to-cart" ng-class="{open:showModal()}">\n    <div class="overlay-content" ng-click="closePopup(); $event.stopPropagation();">\n        <div class="to-cart-popup" ng-click="$event.stopPropagation();" context-panel>\n        <span class="app-close-popup icomoon" ng-click="closePopup(); $event.stopPropagation();" title="Закрыть "></span>\n        <span class="tcm-close-mobile icomoon mobile" ng-click="closePopup(); $event.stopPropagation();" title="Закрыть "></span>\n        <span class="tcm-logo desktop">{{organization.personal.toCartModal.logo}}</span>\n        <span class="tcm-logo mobile">{{organization.personal.toCartModal.logo}}</span>\n        <img class="tcm-img" ng-src="{{ getCommodityPhoto() }}" fallback-src="{{filePath}}images/noCommodity.svg">\n        <span class="tcm-commodity-name">{{commodity.Fullname}}</span>\n        <span class="tcm-button b1 background-color border-color" ng-click="toCart(); $event.stopPropagation();">{{organization.personal.toCartModal.button1}}</span>\n        <span class="tcm-button b2 color" ng-click="closePopup(true); $event.stopPropagation();">{{organization.personal.toCartModal.button2}}</span>\n        </div>\n    </div>\n</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("widgetMenu",[function(){return{template:'\n            <div ng-if="isSite()">\n                <div ng-if="showTopBanner()" class="top-banner-wrapper background-color">\n                        <div class="top-banner-content">{{getTopBannerText()}}</div>\n                </div>\n                <div class="widget-network"><div ng-click="goToNetwork()" ng-if="networks.length > 1">{{organization.personal.menu[\'list\']}}</div></div>\n                <div class="widget-menu desktop clearfix"  ng-controller="mainMenu">\n                    <div class="items main-font main-menu-items">\n                        <div class="item" ng-repeat="(key, item) in mainMenu | toArray | orderBy:\'widget.order\' | limitTo: visibleCount() > 5 ? 5 : null" amplitude-event="Меню | {{key == \'profile\' ? \'Профиль\' : (isFunction(item.name) ? item.name() : item.name) }}">\n                            <div class="item-name one-line" ng-class="{\'active\':checkMenuActive(item, $location.path()), \'inactive\':!checkMenuActive(item, $location.path())}" ng-click="item.click();closeAdditional()" ng-show="item.visible && item.widget.visible">\n                                <span class="main-menu-image item-image image-calendar {{item.icon}}"></span>\n                                <span class="menu-name">{{ item.widget.name }}</span>\n                            </div>\n                        </div>\n                        <span class="widget-menu-kebab" ng-show="visibleCount() > 5" ng-click="additionalShow = !additionalShow">\n                            <svg width="4px" height="18px" viewBox="0 0 4 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                                <title>Group 9</title>\n                                <desc>Created with Sketch.</desc>\n                                <g id="ОЗ-модальное-окно-на-сайте" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                                    <g id="widget-menu-kebab-img" transform="translate(-1402.000000, -98.000000)" fill="#BBBBBB" fill-rule="nonzero">\n                                        <g id="Group-9" transform="translate(1402.000000, 98.000000)">\n                                            <circle id="Oval" cx="2" cy="2" r="2"></circle>\n                                            <circle id="Oval" cx="2" cy="9" r="2"></circle>\n                                            <circle id="Oval" cx="2" cy="16" r="2"></circle>\n                                        </g>\n                                    </g>\n                                </g>\n                            </svg>\n                        </span>\n                        <span class="widget-menu-additional" ng-show="additionalShow">\n                            <div class="item" ng-repeat="(key, item) in mainMenu | toArray | orderBy:\'widget.order\' | limitTo:5:5" amplitude-event="Меню | {{key == \'profile\' ? \'Профиль\' : (isFunction(item.name) ? item.name() : item.name) }}">\n                                <div class="item-name one-line" ng-class="{\'active\':checkMenuActive(item, $location.path()), \'inactive\':!checkMenuActive(item, $location.path())}" \n                                ng-click="closeAdditional();item.click()" ng-show="item.visible && item.widget.visible" style="margin-left: 14px; border-bottom: none">\n                                    <span class="main-menu-image item-image image-calendar {{item.icon}}"></span>\n                                    <span class="menu-name">{{ item.widget.name }}</span>\n                                </div>\n                            </div>\n                        </span>\n                        <div style="clear:both"></div>\n                    </div>\n                </div>\n            </div>'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("workDays",["$rootScope",function($rootScope){return{scope:{schedule:"@"},restrict:"E",replace:!0,link:function(scope){scope.workDays=JSON.parse(scope.schedule)},template:function(element,attr){return'\n            <div class="working-days-container">\n                <div class="contacts-operating_mode-weekday" ng-repeat="day in workDays.scheduleWeekday">\n                    {{day.days[0]}}<span ng-show="day.days.length > 1">-</span>{{day.days[1]}}:      {{day.times[0]}} - {{day.times[1]}}\n                </div>\n                <div class="contacts-operating_mode-weekday" ng-repeat="day in workDays.scheduleWeekend">\n                    {{day.days[0]}}<span ng-show="day.days.length > 1">-</span>{{day.days[1]}}:      {{day.times[0]}} - {{day.times[1]}}\n                </div>\n            </div>\n            '}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("header",[function(){return{restrict:"E",replace:!0,template:'\n        <div class="organization-title relative header" ng-class="{\'show-menu\': showMenu}">\n            <div class="desktop clearfix">\n                <div ng-if="showTopBanner() && !isSite()" class="top-banner-wrapper background-color">\n                    <div class="top-banner-content">{{getTopBannerText()}}</div>\n                </div>\n                <div class="organization-title-desktop-wrapper relative">\n                    <div class="organization-title-desktop-block">\n                            <button ng-show="showMenuButton() && !isSite()" class="menu-button icomoon icon-sidebar2" ng-click="toggleMenu()" title="Меню"></button>\n                        <div class="organization-desktop-header-title-table" ng-class="{\'widget\' : isSite(), \'cut-header\': showBackButton()}">\n                            <div class="main-header items-center tc" ng-show="!idShow()">\n                                <div class="header-wrapper" ng-style="isSite() ? {} : {\'flex-basis\': \'100%\'}">\n                                <div class="organization-name text-line truncate" ng-show="organization.name">\n                                    <span ang-marquee="organization.name">{{organization.name}}</span>\n                                </div>\n                                    <div class="salon-address text-line truncate">\n                                        <div>\n                                            <span ang-marquee="organization.address">{{organization.address}}</span>\n                                            <span ang-marquee="organization.telephone">{{organization.telephone}}</span>\n                                        </div>\n                                        <div  ng-class="{\'item-adress-movement\': showBackButton()}" class="address-wrapper">\n                                    <a href="#" class="switch-salon-item-address bb link color" ng-show="organization.address" ng-click="showMapSalon(organization);$event.stopPropagation()">Как проехать?</a>\n                                    </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div ng-if="showBackButton() && !isSite()" ng-click="goToButton(\'main\')" class="go-back-button flex justify-center" ng-attr-title="{{getTitleForTopBackButton()}}"></div>\n                            <div class="close-frame" onclick="window.MetrikaService.sendEvent(\'close_frame\')" >\n                                <div class="icon" title="Закрыть">x</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="mobile">\n                <div class="organization-title-table">\n                    <div ng-show="showMenuButton() && !isSite()" class="menu-button-wrapper" ng-click="toggleMenu()">\n                        <button  class="menu-button icomoon icon-sidebar2" title="Открыть меню"></button>\n                    </div>\n                    <div class="organization-info-title">\n                        <div class="title-block" ng-show="!idShow()">\n                            <div class="organization-name text-line truncate" ng-show="organization.name">\n                                <span ang-marquee="organization.name">{{organization.name}}</span>\n                            </div>\n                            <div class="organization-info text-line one-line" ng-show="organization.address">{{organization.address}}</div>\n                            <div class="close-frame" onclick="window.MetrikaService.sendEvent(\'close_frame\')">x</div>\n                            <div ng-show="!organization.id" class="hide" ng-class="{\'hide\':!BookingControllerOnload}">\n                                <span class="error-title"></span>\n                            </div>\n                        </div>\n                    </div>\n                    <div ng-if="showBackButton()" ng-click="goToButton(\'main\')" class="go-back-button" title="Перейти на главную страницу"></div>\n                </div>\n                <div ng-if="showTopBanner()" class="top-banner-wrapper background-color">\n                    <div class="top-banner-content">{{getTopBannerText()}}</div>\n                </div>\n            </div>\n        </div>',link:function($scope,element,attrs){}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("switchSalon",["settings","$rootScope","MapLayout","$location",function(settings,$rootScope,MapLayout,$location){return{restrict:"E",replace:!0,template:'\n        <div class="switch-salon" ng-show="networks.length > 1 && ($location.path() === \'/main\' || ($location.path() === \'/products\' && organization.onlyCommodity) || ($location.path() === \'/cart\' && organization.onlyCommodity))">\n            <div class="desktop relative">\n                <div class="swiper-container">\n                    <div class="switch-salon-items swiper-wrapper" ng-class="{\'switch-salon-flex\': networks.length < 4}">\n                        <div class="switch-salon-item swiper-slide" ng-repeat="(key, salon) in networks" ng-init="initSalon(key, salon, networks, $last)" ng-click="selectSalon(salon, key, networks)" context-panel>\n                            <div class="tl">\n                                <div class="switch-salon-item-name font-size14 fw" ng-show="salon.address">{{salon.address}}</div>\n                                <div class="switch-salon-item-phone font-size14" ng-show="salon.phone">{{salon.phone}}</div>\n                                <a href="#" class="switch-salon-item-addres bb link color" ng-show="salon.address" ng-click="showMapSalon(salon);$event.stopPropagation()">Как проехать?</a>\n                            </div>\n                            <div alt="{{getCheckMarkAlt()}}" class="switch-salon-item-selected background-color flex items-center justify-center"\n                             ng-show="salon.visible" ng-attr-title="Выбрано: {{salon.name}}"></div>\n                        </div>\n                    </div>\n                </div>\n                <div class="swiper-button-next-wrapper" ng-show="networks.length > 3">\n                    <div class="swiper-button-next flex items-center justify-center" alt="Следующие"></div>\n                </div>\n                <div class="swiper-button-prev-wrapper" ng-show="networks.length > 3">\n                    <div class="swiper-button-prev flex items-center justify-center" alt="Предыдущие"></div>\n                </div>\n            </div>\n        </div>',link:function($scope,element,attrs){$scope.activeSlide=0,$scope.$location=$location,$scope.initSalon=function(key,salon,networks,$last){salon.visible&&($scope.activeSlide=key),$last&&networks.length>3&&setTimeout(function(){new Swiper(".switch-salon .swiper-container",{slidesPerView:3,initialSlide:$scope.activeSlide,spaceBetween:15,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})},10)},$scope.selectSalon=function(salon,key,networks){var id=salon.id;settings.ORG_ID=id,networks.forEach(function(salon){salon.visible=!1}),salon.visible=!0,$rootScope.$broadcast("onChangeSalon",salon,networks)},$scope.showMapSalon=function(salon){return MapLayout.show(salon)}}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("clientHistory",["$http","settings","$rootScope","$filter","ClientInfo","$location","timeFormatter","EmployeeStorage","$timeout","CHANGE_VISIT","paymentSettings","robokassa",function($http,settings,$rootScope,$filter,ClientInfo,$location,timeFormatter,EmployeeStorage,$timeout,CHANGE_VISIT,paymentSettings,robokassa){return{scope:{client:"=",organization:"=",getPersonalValue:"=",keysForObject:"=",serviceRequired:"=",changeVisitType:"=",setLoader:"=",goTo:"="},restrict:"E",replace:!0,link:function(scope){scope.paymentEnabledServices=paymentSettings.paymentEnabledServices(),scope.isOpen=!1,scope.visits=scope.client.visits?$filter("groupBy")(scope.client.visits,"idVisit"):[],scope.commodityVisits=scope.client.commodityVisits?scope.client.commodityVisits.commodityVisits:[],scope.LANG=ClientInfo.LANG,scope.HOST=window.HOST,"ac"===scope.LANG.getName()&&(scope.isOpen=!0,$timeout(function(){scope.initSwiper(),scope.initCommoditySwiper()},100)),scope.showMasterName=function(visit){return!("employees"in visit&&1===visit.employees.length&&visit.employees[0].isAdmin&&window.ARNICA)},scope.expand=function(){"ac"!==scope.LANG.getName()&&(scope.isOpen=!scope.isOpen,$timeout(function(){scope.initSwiper(),scope.initCommoditySwiper()},10))},scope.initSwiper=function(){!scope.initSwiper.init&&scope.client.id&&(scope.initSwiper.init=!0,scope.swiper=new Swiper(".swiper-client-".concat(scope.client.id),{slidesPerView:"auto",on:{slideNextTransitionStart:function(){if(scope.swiper instanceof Array){var $this=this;scope.swiper.forEach(function(el){$this!=el&&el.slideTo(0,500)})}}}}))},scope.initCommoditySwiper=function(){!scope.initCommoditySwiper.init&&scope.client.id&&(scope.initCommoditySwiper.init=!0,scope.commoditySwiper=new Swiper(".commodity-swiper-client-".concat(scope.client.id),{slidesPerView:"auto",on:{slideNextTransitionStart:function(){if(scope.commoditySwiper instanceof Array){var $this=this;scope.commoditySwiper.forEach(function(el){$this!=el&&el.slideTo(0,500)})}}}}))},scope.toogleShowVisit=function(index){var swiper=scope.swiper[index]||scope.swiper;swiper.activeIndex?(swiper.slideTo(0),swiper.activeIndex=0):(swiper.slideTo(1),swiper.activeIndex=1)},scope.toogleShowCommodityVisit=function(index){var swiper=scope.commoditySwiper[index]||scope.commoditySwiper;swiper.activeIndex?(swiper.slideTo(0),swiper.activeIndex=0):(swiper.slideTo(1),swiper.activeIndex=1)},scope.initVisits=function(item){item.summa=item[0].totalCost,angular.forEach(item,function(value){if(value.date&&!(value.date instanceof Date)){var s=value.date.split(/[^0-9]/);value.date=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5])}item.minTime?value.date.getTime()<item.minTime&&(item.minTime=value.date.getTime()):item.minTime=value.date.getTime()}),item._minTime=item.minTime,item.minTime=new Date(item.minTime)},scope.initCommodityVisits=function(item){if(item.summa=item.sum,item.date&&!(item.date instanceof Date)){var s=item.date.split(/[^0-9]/);item.date=new Date(s[2],s[1]-1,s[0])}item.minTime?item.date.getTime()<item.minTime&&(item.minTime=item.date.getTime()):item.minTime=item.date.getTime(),item._minTime=item.minTime,item._visitId=item.visitId,item.minTime=new Date(item.minTime)},scope.deleteVisit=function(arrService){if(arrService){scope.setLoader(!0);var idVisit=arrService[0]&&arrService[0].idVisit,sessionCookie=window.localStorage.getItem("client_session_id");$http.delete(window.HOST+"/booking/booking/removeAppointment",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,visitid:idVisit,sesid:sessionCookie}}).success(function(data){data&&(angular.forEach(scope.client.visits,function(service,index){service.idVisit===idVisit&&delete scope.client.visits[index]}),scope.visits=$filter("groupBy")(scope.client.visits,"idVisit"),$timeout(function(){scope.initSwiper.init=!1,scope.initSwiper()},10))}).error(function(err){console.log(err)}).finally(function(){scope.setLoader(!1)}),ClientInfo.resetSelection()}},scope.deleteCommodityVisit=function(commodityItem){if(commodityItem){scope.setLoader(!0);var idVisit=commodityItem.visitId,sessionCookie=window.localStorage.getItem("client_session_id");$http.delete(window.HOST+"/booking/booking/removeAppointment",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,visitid:idVisit,type:"commodity",sesid:sessionCookie}}).success(function(data){data&&scope.client.commodityVisits&&scope.client.commodityVisits.commodityVisits&&(angular.forEach(scope.client.commodityVisits.commodityVisits,function(item,index){item.visitId===idVisit&&delete scope.client.commodityVisits.commodityVisits[index]}),$timeout(function(){scope.initCommoditySwiper.init=!1,scope.initCommoditySwiper()},10))}).error(function(err){console.log(err)}).finally(function(){scope.setLoader(!1)})}},scope.selectService=function(service){ClientInfo.selectedClient=scope.client,ClientInfo.serviceCollection.splice(0,ClientInfo.serviceCollection.length),ClientInfo.serviceCollection.add(service),$location.path("/main")},scope.changeVisit=function(serviceList){ClientInfo.selectedClient=scope.client,ClientInfo.type=CHANGE_VISIT,ClientInfo.serviceCollection.splice(0,ClientInfo.serviceCollection.length),ClientInfo.selectedDate=serviceList.minTime,ClientInfo.visit=serviceList,ClientInfo.selectedTaps="services",ClientInfo.goToEmployeesChangeVisit=!1;var strTime=$filter("date")(serviceList.minTime,"HH:mm");ClientInfo.time=timeFormatter.stringToMinutes(strTime);var visitItems=[],employeeID=serviceList[0].employeeID;angular.forEach(serviceList,function(service){service.employeeID!=employeeID&&(employeeID=0),service.serviceID&&visitItems.push({startTime:service.startTime?service.startTime.substring(0,5):null,serviceId:parseInt(service.serviceID),employeeId:Object.keys(EmployeeStorage.getEmployeeForId(parseInt(service.employeeID))).length?parseInt(service.employeeID):0})}),ClientInfo.selectedEmployee=EmployeeStorage.getEmployeeForId(employeeID),ClientInfo.selectedTime={timeFormatted:strTime,time:ClientInfo.time,visitItems:visitItems},angular.forEach(serviceList,function(service){0!=service.visible&&service.hasBooking&&ClientInfo.serviceCollection.add({id:parseInt(service.serviceID),categoryID:parseInt(service.categoryID),name:service.serviceName,duration:service.duration,discountSum:service.discountSum,price:service.price,employeeID:parseInt(service.employeeID),startTime:service.startTime?service.startTime.substring(0,5):null,endTime:service.endTime?service.endTime.substring(0,5):null})}),ClientInfo.selectedIdVisit=serviceList[0].idVisit,$location.path("/main")},scope.$watch("client.visits",function(visits){visits&&(scope.visits=$filter("groupBy")(visits,"idVisit"))}),scope.$watch("client.commodityVisits",function(commodityVisits){commodityVisits&&commodityVisits.commodityVisits&&(scope.commodityVisits=commodityVisits.commodityVisits)}),scope.payVisit=function(item){scope.setLoader(!0);var visitId=item[0].idVisit;$http.get(window.HOST+"/booking/booking/visitPaymentData",{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID,visitId:visitId,sesid:window.localStorage.getItem("client_session_id")}}).success(function(_ref){var data=_ref.data;data&&(robokassa.setMerchatLogin(data.MerchantLogin),robokassa.setOutSum(data.sum),robokassa.setInvId(data.InvId),robokassa.setDescription(data.description),robokassa.setSignatureValue(data.sign),robokassa.setShpIds(data.shpIds),robokassa.setShpOrgid(data.shp_orgid),robokassa.setReceipt(data.Receipt),scope.$emit("openPaymentModal"))}).finally(function(){scope.setLoader(!1)})}},template:'\n        <div class="client-history-container">\n\n    <div class="header" ng-click="expand()">\n        <span class="icon-account"></span>\n        <div>{{client.lastname || client.surname}} {{client.firstname}} {{client.patronymic}}</div>\n        <span class="icon-expand-arrow color" title="{{isOpen ? \'свернуть\' : \'развернуть\'}}" ng-class="{\'open\': isOpen}" ng-if="LANG.getName() != \'ac\'"></span>\n    </div>\n    <div class="expand" ng-show="isOpen">\n        <div class="profile-you-recorder" ng-show="keysForObject(visits).length">\n            <div class="profile-you-recorder-head">{{organization.personal.profile.youBooking}}</div>\n            <div class="profile-you-recorder-services">\n                <div class="profile-you-recorder-service" ng-repeat="item in visits | toArray:true | orderBy:\'_minTime\'" ng-init="initVisits(item)">\n                    <div class="mobile"  ng-include="(HOST ? \'\' : \'/booking/\' )+\'views/profile/v2/visits-item.mobile.html\'"></div>\n                    <div class="desktop" ng-include="(HOST ? \'\' : \'/booking/\' )+\'views/profile/visits-item.desktop.html\'"></div>\n                </div>\n            </div>\n        </div>\n                <div class="profile-you-recorder" ng-show="keysForObject(commodityVisits).length">\n            <div class="profile-you-recorder-head">{{getPersonalValue(\'profile\',\'orders\')}}</div>\n            <div class="profile-you-recorder-services">\n                <div class="profile-you-recorder-service commodity-recorder-item" ng-repeat="item in commodityVisits | toArray:true | orderBy: \'-_visitId\'" ng-init="initCommodityVisits(item)">\n                    <div class="mobile"  ng-include="(HOST ? \'\' : \'/booking/\' )+\'views/profile/v2/commodity-visits-item.mobile.html\'"></div>\n                    <div class="desktop" ng-include="(HOST ? \'\' : \'/booking/\' )+\'views/profile/commodity-visits-item.desktop.html\'"></div>\n                </div>\n            </div>\n        </div>\n         <div class="profile-best-services" ng-show="client.bestServices.length && serviceRequired">\n            <div class="profile-you-recorder-head">{{getPersonalValue(\'profile\',\'bestService\')}}</div>\n            <div class="profile-best-services-items">\n                <div class="profile-best-services-item profile-padding-l-r" ng-repeat="item in client.bestServices">\n                    <div class="table">\n                        <div class="cell profile-best-services-item-name">{{item.name}}</div>\n                        <div class="cell profile-best-services-item-price">\n                            <money-widget value="{{item.price - item.discountSum}}" class="service-price desktop" tag="span" scale="2"></money-widget>\n                            <span style="cursor:pointer" class="profile-best-services-item-select color" ng-click="selectService(item)" title="{{getPersonalValue(\'profile\',\'retry\')}}"></span>\n                        </div>\n                    </div>\n                    <money-widget value="{{item.price - item.discountSum}}" class="service-price mobile profile-best-services-item-price" tag="span" scale="2"></money-widget>\n                </div>\n            </div>\n        </div>\n        <div ng-include="(HOST ? \'\' : \'/booking/\' )+\'views/profile/subscription-and-certificates.html\'"></div>\n        <div ng-controller="VisitsHistory" data-ng-init="init(client)">\n            <div ng-include="(HOST ? \'\' : \'/booking/\' )+\'views/profile/v2/visits-history.html\'"></div>\n        </div>\n    </div>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives"),BookingAppServices=angular.module("BookingApp.services"),BookingAppConstants=angular.module("BookingApp.constant");BookingAppConstants.constant("MAP_LAYOUT_SHOW","MAP_LAYOUT.SHOW"),BookingAppConstants.constant("MAP_LAYOUT_HIDE","MAP_LAYOUT.HIDE"),BookingAppServices.factory("MapLayout",["$rootScope","MAP_LAYOUT_SHOW","MAP_LAYOUT_HIDE",function($rootScope,MAP_LAYOUT_SHOW,MAP_LAYOUT_HIDE){var MapLayout={visible:!1,show:function(address){MapLayout.visible=!0,$rootScope.$broadcast(MAP_LAYOUT_SHOW,address)},close:function(){MapLayout.visible=!1,$rootScope.$broadcast(MAP_LAYOUT_HIDE)}};return MapLayout}]),BookingAppDirectives.directive("map",["ClientInfo","MapLayout","MAP_LAYOUT_SHOW","MAP_LAYOUT_HIDE",function(ClientInfo,MapLayout,MAP_LAYOUT_SHOW,MAP_LAYOUT_HIDE){return{restrict:"E",replace:!0,template:'<div class="map flex items-center justify-center" ng-show="isVisible()">\n                        <div class="relative">\n                            <div class="map-content" id="map-layout" ng-hide="showError" alt=""></div>\n                            <div class="map-close flex justify-center items-center" ng-click="closeMap()" alt="Закрыть"></div>\n                            <button class="time-calculating-overlay color text-center" ng-show="showMapLoader"></button>\n                        </div>\n                   </div>',link:function($scope,element){var ID_MAP_LAYOUT="map-layout";$scope.showError=!1,$scope.showMapLoader=!0,$scope.isVisible=function(){return MapLayout.visible},$scope.$on(MAP_LAYOUT_SHOW,function(e,address){$scope.showMap(address),$scope.showMapLoader=!0,$scope.showError=!1}),$scope.$on(MAP_LAYOUT_HIDE,function(){$("#"+ID_MAP_LAYOUT).empty(),$scope.showMapLoader=!0,$scope.showError=!1}),$scope.showMap=function(salon){"undefined"!=typeof ymaps&&ymaps.ready(function(){ymaps.geocode(salon.yaFullAddress).then(function(res){$scope.showMapLoader=!1,$scope.$apply(),$("#"+ID_MAP_LAYOUT).attr("alt","карта загружена");var coords=res.geoObjects.get(0).geometry.getCoordinates(),myMap=new ymaps.Map(ID_MAP_LAYOUT,{center:coords,zoom:16,controls:[]}),myPlacemark=new ymaps.Placemark(coords,{content:salon.city,balloonContent:salon.address});myMap.geoObjects.add(myPlacemark)},function(err){$scope.showMapLoader=!1,$scope.$apply(),console.log(err)})})},$scope.closeMap=MapLayout.close,$scope.initMap=function(){if(!ClientInfo.yandexMapScriptLoaded){var ymapsScript=document.createElement("script");ymapsScript.src="https://api-maps.yandex.ru/2.1/?apikey=ec7bb99e-f600-4824-b62d-87433a69d389&lang=ru_RU",document.body.appendChild(ymapsScript),ymapsScript.onload=function(){ClientInfo.yandexMapScriptLoaded=!0}}},$scope.initMap()}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("personalDataForm",["$http","settings","$rootScope",function($http,settings,$rootScope){return{scope:{client:"=",organization:"=",isAdditional:"=",isNew:"=",goTo:"="},restrict:"E",replace:!0,link:function(scope,element){scope.loader=!1,scope.clientForm=JSON.parse(JSON.stringify(scope.client)),scope.personal=scope.organization.personal;var dateParts=[];scope.clientForm.birthDate&&(dateParts=scope.clientForm.birthDate.split(".")),scope.birthDate=scope.clientForm.birthDate?new Date("".concat(dateParts[2],"-").concat(dateParts[1],"-").concat(dateParts[0])):null,scope.errors={firstname:"",lastname:"",patronymic:"",birthDate:"",email:"",additionalPhone:""},scope.requiredFields=["firstname"],organization.validationRules.surName&&scope.requiredFields.push("lastname"),scope.emailPlaceholder="",scope.phonePlaceholder="",scope.phonePlaceholderFill=scope.organization.phoneMask.replace(/\#/g," ˍ ").replace(/\s{2,2}/g," "),scope.hasContent=function(value){return value&&value.length>0},scope.requiredCheck=function(){var check=!0;return scope.requiredFields.map(function(field){scope.clientForm[field].length<1&&(scope.errors[field]="Поле «"+scope.personal.editProfile[field]+"» обязательно для заполнения",check=!1)}),check},scope.errorsCheck=function(){var check=!0;return Object.keys(scope.errors).map(function(key){scope.errors[key].length>0&&(check=!1)}),check},scope.updateClient=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){var url;return _regeneratorRuntime().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:scope.requiredCheck()&&scope.errorsCheck()&&(scope.loader=!0,url=scope.isNew?window.HOST+"/booking/client/addAdditionalClient":window.HOST+"/booking/client/updateClient",$http.post(url,{client:{id:scope.clientForm.id,additionalPhone:scope.clientForm.additionalPhone,email:scope.clientForm.email,lastname:scope.clientForm.lastname,firstname:scope.clientForm.firstname,patronymic:scope.clientForm.patronymic,birthDate:scope.birthDate?moment(scope.birthDate).format("YYYY-MM-DD"):null}},{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}}).success(function(response){if(response.result)$rootScope.$emit("ClientInfoChanged");else{for(var _i=0,_Object$keys=Object.keys(response.errors);_i<_Object$keys.length;_i++)for(var key=_Object$keys[_i],error=response.errors[key][0],_i2=0,_Object$keys2=Object.keys(scope.errors);_i2<_Object$keys2.length;_i2++){var erKey=_Object$keys2[_i2];key===erKey&&(scope.errors[erKey]=error)}scope.loader=!1}}).error(function(e){scope.loader=!1,console.log(e.message)}));case 1:case"end":return _context.stop()}},_callee)})),scope.birthDateChangeHandler=function(){scope.errors.birthDate="",scope.birthDate>new Date&&(scope.errors.birthDate="Дата рождения не может быть больше текущей"),"Invalid Date"==new Date(scope.birthDate)&&(scope.errors.birthDate="Некоректная дата")}},template:'\n<div class="personal-data-form">\n\n    <div class="field personal-field" ng-class="{\'has-error\': errors.lastname}">\n        <div class="input-effect">\n            <input \n            class="personal-input" \n            ng-model="clientForm.lastname" \n            ng-class="{\'has-content\':hasContent(clientForm.lastname)}"\n            id="surname" \n            type="text"\n            ng-change="errors.lastname = \'\'" \n            >\n            <label class="color" for="surname">{{personal.editProfile.lastname}} <span ng-if="organization.validationRules.surName" style="color: #e41542;">*</span></label>\n            <span class="focus-border background-color"></span>\n        </div>\n    </div>\n    <span class="error-message" ng-if="errors.lastname">{{errors.lastname}}</span>\n    <span class="error-message" ng-if="errors.surname">{{errors.surname}}</span>\n    \n    <div class="field personal-field name-data" ng-class="{\'has-error\': errors.firstname}">\n            <div class="input-effect">\n                <input \n                class="personal-input" \n                ng-model="clientForm.firstname"\n                ng-class="{\'has-content\':hasContent(clientForm.firstname)}" \n                id="firstname" \n                type="text"\n                ng-change="errors.firstname = \'\'" \n                >\n                <label class="color" for="firstname">{{personal.editProfile.firstname}} <span style="color: #e41542;">*</span></label>\n                <span class="focus-border background-color"></span>\n            </div>\n     </div>\n     <span class="error-message" ng-if="errors.firstname">{{errors.firstname}}</span>\n     \n    <div class="field personal-field" ng-class="{\'has-error\': errors.patronymic}">\n        <div class="input-effect">\n            <input \n            class="personal-input" \n            ng-model="clientForm.patronymic" \n            ng-class="{\'has-content\':hasContent(clientForm.patronymic)}"\n            id="patronymic" \n            ng-change="errors.patronymic = \'\'" \n            type="text"\n            >\n            <label class="color" for="patronymic">{{personal.editProfile.patronymic || \'Отчество\'}}</label>\n            <span class="focus-border background-color"></span>\n        </div>\n    </div>\n    <div class="error-message" ng-show="errors.patronymic">{{errors.patronymic}}</div>\n    \n    <div class="field personal-field phone-data" ng-class="{error:isError(\'phone-data\'), \'has-error\': errors.additionalPhone}" ng-if="!isAdditional">\n            <div class="input-effect">\n                <input class="personal-input" \n                 mask=\'{{organization.phoneMask}}\'\n                 id="telephoneFormatted" \n                 ng-model="clientForm.additionalPhone" \n                 ng-class="{\'has-content\':hasContent(clientForm.additionalPhone)}"\n                 type="tel" \n                 ng-change="errors.additionalPhone = \'\'" \n                 ng-focus="phonePlaceholder = phonePlaceholderFill" \n                 ng-blur="phonePlaceholder = \'\';" \n                 placeholder="{{phonePlaceholder}}">\n                <label class="color" for="telephoneFormatted">{{personal.editProfile.phone || \'Доп. телефон\'}}</label>\n                <span class="focus-border background-color"></span>\n            </div>\n    </div>\n    <div class="error-message" ng-show="errors.additionalPhone" ng-if="!isAdditional">{{errors.additionalPhone}}</div>\n    \n    <div class="field personal-field" ng-class="{\'has-error\': errors.email}" ng-if="!isAdditional">\n        <div class="input-effect">\n            <input class="personal-input" \n            ng-model="clientForm.email" \n            ng-class="{\'has-content\':hasContent(clientForm.email)}"\n            id="email" \n            ng-focus="emailPlaceholder = \'something@example.ru\'" \n            ng-blur="emailPlaceholder = \'\';" \n            placeholder="{{emailPlaceholder}}"\n            ng-change="errors.email = \'\'"\n            type="text">\n            <label class="color" for="email">{{personal.editProfile.email || \'E-mail\'}}</label>\n            <span class="focus-border background-color"></span>\n        </div>\n    </div>\n    <div class="error-message" ng-show="errors.email" ng-if="!isAdditional">{{errors.email}}</div >\n    \n    <div class="field personal-field" ng-class="{\'has-error\': errors.birthDate}">\n        <div class="input-effect">\n            <input \n            class="personal-input has-content" \n            ng-model="birthDate"\n            id="birthDate"\n            type="date"\n            ng-change="birthDateChangeHandler()"\n            >\n            <label class="color" title="{{personal.editProfile.birthDate || \'Дата рождения\'}}" for="birthDate">{{personal.editProfile.birthDate || \'Дата рождения\'}}</label>\n            <span class="focus-border background-color"></span>\n        </div>\n    </div>\n    <div class="error-message" ng-show="errors.birthDate">{{errors.birthDate}}</div>\n    \n    <div class="button-bar table changed-phone">\n        <button class="button profile-save" ng-class="{disabled:submitted}" ng-click="updateClient()" ng-disabled="submitted">\n        {{personal.editProfile.save || \'Сохранить\'}}\n        </button>\n    </div>\n    \n    <div ng-if="organization.regional === \'RU\' || organization.regional === \'RU_UA\'" class="privacy-text">\n        Нажимая кнопку, я соглашаюсь на <span class="pseudo-link" ng-click="goTo(\'policy\');">обработку персональных данных</span>\n    </div>\n    \n   <button class="time-calculating-overlay color text-center" ng-show="loader"></button>\n</div>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("personalList",["$rootScope","ClientInfo",function($rootScope,ClientInfo){return{scope:{client:"=",editClient:"=",isAdditional:"=",isNew:"=",startEdit:"=",cancelEdit:"=",isEditable:"=",toogleShowProfile:"=",swiperIndex:"=",deleteClient:"=",personal:"="},restrict:"E",replace:!0,link:function(scope){scope.client.surname&&(scope.client.lastname=scope.client.surname),scope.getFIO=function(){scope.client.surname&&(scope.client.lastname=scope.client.surname);var fio="";return scope.client.lastname&&(fio=fio+scope.client.lastname+" "),scope.client.firstname&&(fio=fio+scope.client.firstname+" "),scope.client.patronymic&&(fio+=scope.client.patronymic),fio}},template:'\n<span>\n    <div class="profile-header desktop" context-panel ng-show="!isEditable && !isNew|| isEditable && !isNew && editClient.id === client.id">\n        <div class="icon-account"></div>\n        <div ng-bind-html="getFIO()" class="fio"></div>\n        <div class="icon-edit edit-profile" ng-if="!isEditable" ng-click="startEdit(client, isAdditional)" title="Редактировать"\n             ng-attr-title="Редактировать"></div>\n        <div class="close icomoon edit-profile" ng-if="!isEditable && isAdditional" ng-click="deleteClient(client)" title="Удалить"\n             ng-attr-title="Удалить"></div>     \n        <div class="edit-profile-cancel" ng-if="isEditable" ng-click="cancelEdit()">{{personal.editProfile.cancel || \'Отмена\'}}</div>\n    </div>\n    <div class="swiper-container mobile" ng-show="!isEditable"\n    ng-class="{\'swiper-profile-container-additional\':isAdditional, \'swiper-profile-container\': !isAdditional}" \n    ng-show="!isEditable">\n    <div class="swiper-wrapper">\n   \n            <div class="swiper-slide" ng-class="{\'profile-menu-main-profile-additional\':isAdditional, \'profile-menu-main-profile\':!isAdditional}">\n                <div class="profile-you-recorder-service-settings">\n                    <div class="profile-sidemenu-change background-color" ng-click="startEdit(client, isAdditional)"\n                         data-ng-attr-title="изменить">\n                        <div class="flex-center">\n                            <div class="icon-change-visit icomoon"></div>\n                            <span>изменить</span>\n                        </div>\n                    </div>\n                    <div class="profile-sidemenu-delete" ng-click="deleteClient(client)" title="удалить" ng-if="isAdditional">\n                        <div class="flex-center">\n                            <div class="commodity-visit-delete-icon icomoon"></div>\n                            <span>удалить</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="swiper-slide profile-header">\n                <div></div>\n                <div class="icon-account"></div>\n                <div ng-bind-html="getFIO()" class="fio"></div>\n                <div class="sidemenu  background-color" ng-click="toogleShowProfile(swiperIndex)" title="Свайп">\n                    <div class="profile-menu-sidemenu-point"></div>\n                    <div class="profile-menu-sidemenu-point"></div>\n                    <div style="margin-right:0" class="profile-menu-sidemenu-point"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="swiper-slide profile-header profile-header-editable mobile" context-panel ng-show="isEditable && editClient.id === client.id">\n        <div></div>\n        <div class="icon-account"></div>\n        <div ng-bind-html="getFIO()" class="fio"></div>\n        <div class="color icomoon icon-delete-mobile" ng-click="cancelEdit()"></div>\n    </div>\n    <div class="client-data-preview" ng-if="!isEditable">\n        <div class="item-ico icon-acc-phone" ng-if="!isAdditional"></div>\n        <div class="item-text" ng-if="!isAdditional">{{ client.telephone ? client.formatPhone : \'Телефон не указан\' }}</div>\n        <div class="item-ico icon-email" ng-if="!isAdditional"></div>\n        <div class="item-text" ng-if="!isAdditional">{{ client.email ? client.email : \'Почта не указана\' }}</div>\n        <div class="item-ico icon-acc-calendar"></div>\n        <div class="item-text">{{ client.birthDate ? client.birthDate : \'Дата рождения не указана\' }}\n        </div>\n    </div>\n </span>\n '}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("personalModal",["$rootScope","$http","ClientInfo","$location","$window","$document","settings","Cart",function($rootScope,$http,ClientInfo,$location,$window,$document,settings,Cart){return{restrict:"E",replace:!0,scope:!0,link:function(scope){},template:'\n<div class="overlay" ng-class="{open: isPopupOpen}">\n    <div class="overlay-content">\n        <div class="personal-popup" context-panel>\n            <div class="description">Вы уверены, что хотите удалить аккаунт:</div>\n            <div class="client-name">{{editClient.firstname}} {{editClient.lastname}} {{editClient.patronymic}}</div>\n            <div class="btn-container">\n            <button class="btn-contain" ng-click="deleteClientQuery(editClient.id)">Удалить</button>\n            <button class="btn-outline" ng-click="closePopup()">Отмена</button>\n            </div>\n            <span class="close icomoon" ng-click="closePopup()" title="Закрыть"></span>\n            <div class="clear"></div>\n        </div>\n    </div>\n</div>\n'}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("leftMenu",["settings",function(settings){return{restrict:"E",replace:!0,scope:!0,template:'\n            <div ng-show="isSelectNetwork()" class="left-menu">\n                <div ng-show="showMenu" class="wrapper mobile" ng-click="toggleMenu()"></div>\n                <div ng-show="showMenu" id="menu" class="mobile">\n                    <div class="organization-title-table">\n                        <div class="menu-button-wrapper" ng-click="toggleMenu()">\n                            <button class="menu-button icomoon icon-sidebar2" title="Закрыть меню"></button>\n                        </div>\n                        <div class="organization-info-title one-line">\n                            <div class="title-block">\n                                <div class="organization-name text-line truncate" ng-show="organization.name">\n                                    <span ang-marquee="organization.name">{{organization.name}}</span>\n                                </div>\n                                <div class="organization-info text-line" ng-show="organization.id">{{networks.length > 1 ? LANG.get(\'Сеть салонов\') : organization.address}}</div>\n                                <div ng-show="!organization.id">\n                                    <span style="font-size: 20px;"></span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n        \n                    <main-menu></main-menu>\n                    \n                </div>\n                \n                \n                 <div ng-show="showMenu" id="menu" class="desktop fade" context-panel>\n                    \n                    <div class="menu-button-wrapper pt3" style="padding-left: 17px;">\n                        <button class="menu-button icomoon close" ng-click="toggleMenu()" title="Закрыть меню"></button>\n                    </div>\n        \n                    <main-menu class="mt5"></main-menu>\n                    \n                </div>\n            </div>\n        ',link:function($scope,element,attrs){$scope.isSelectNetwork=function(){return!!settings.ORG_ID}}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("mainMenu",["$timeout",function(){return{restrict:"E",replace:!0,template:'\n            <div ng-controller="mainMenu">\n                \n            <div class="items main-font main-menu-items">\n                    <div ng-show="item.visible" class="item" ng-repeat="(key, item) in mainMenu" amplitude-event="Меню | {{key == \'profile\' ? \'Профиль\' : (isFunction(item.name) ? item.name() : item.name) }}">\n                        <div class="item-name one-line" ng-click="item.click()">\n                            <span class="main-menu-image item-image image-calendar {{item.icon}}"></span>\n                            <span>{{ isFunction(item.name) ? item.name() : item.name}}</span>\n                            <span ng-if="item.showCartIcon" ng-show="!isEmptyCart()" class="menu-cart-icon background-color" ng-class="{\'primaryBackgroundColor\': LANG.getName() !== \'ac\'}">{{ getCartCount() }}</span>\n                            <span ng-if="item.showNext" class="item-image image-next"></span>\n                        </div>\n                        <div class="sub-items">\n                            <div class="items">\n                                <div class="item" ng-class="{\'disabled\': subItem.disabled()}" ng-repeat="subItem in item.subItems" ng-show="subItem.visible" ng-click="subItem.click()">\n                                    <div class="item-name one-line">\n                                        <span>{{subItem.name()}}</span>\n                                        <span class="item-image image-next"></span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="item">\n                        <div ng-if="checkAuth()" class="item exit-menu-box">\n                            <div class="item-name one-line" ng-click="logOut()" ng-show="true">\n                                <span class="main-menu-image item-image icon-exit icon-exit-menu"></span>\n                                <span class="exit-menu-text">{{organization.personal.menu.exit}}</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="item">\n                        <div ng-if="checkAuth() && checkDelete()" class="item exit-menu-box exit-menu-box-delete">\n                            <div class="item-name one-line" ng-click="logOut()" ng-show="true">\n                                <span class="main-menu-image item-image icon-exit-menu cart-delete-icon"></span>\n                                <span class="exit-menu-text">Удалить аккаунт</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div style="clear:both"></div>\n                </div>\n            </div>\n\n        ',link:function($scope,element,attrs){}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("ratingVisitDesktop",["$http","settings","$route",function($http,settings,$route){return{template:'\n            <div ng-show="visible">\n                    <style ng-if="visible">\n                        body{\n                            overflow:hidden;\n                        }\n                    </style>\n                    <style>\n                        .vh-svg-preload {\n                           background-image: url({{filePath}}images/star-enabled.svg);\n                           opacity: 0;    \n                        }\n                    \n                        .rating-employee-item__ratings-star.vh {\n                            background-image: url({{filePath}}images/star-disabled.svg);\n                        }\n                        \n                        .rating-employee-item__ratings-star.vh.rating-employee-item__ratings-star-select {\n                            background-image: url({{filePath}}images/star-enabled.svg);\n                        }\n                    </style>\n                    <div class="rating-employee" ng-class="{\'slideInUp\' : showRatings}">\n                        <div class="rating-employee-wrapper vh" context-panel>\n                            <div class="rating-employee-header">\n                                <div class="rating-employee-header-title">{{$parent.organization.personal.rating.title}}</div>\n                                <div class="rating-employee-header-date">{{date | date :  "d MMMM yyyy" }}</div>\n                                <div class="rating-employee-header-close close icomoon" ng-click="close()" title="{{$parent.organization.personal.rating.close}}"></div>\n                            </div>\n                    \n                            \n                           \n                            <div class="rating-employee-item-wrapper">\n                                <div class="rating-employee-item" ng-repeat="employee in items" ng-init="initEmployee(employee)" context-panel>\n                                    <div class="flex justify-between">\n                                        <div class="rating-employee-item-user flex">\n                                            <img class="rating-employee-item-user-logo"  \n                                                fallback-src="{{HOST + \'/booking/images/default-employee.png\'}}" \n                                                ng-src="{{employee.photo ? HOST + employee.photo : HOST + \'/booking/images/default-employee.png\'}}" alt="{{$parent.$parent.organization.personal.rating.employee}}" title="{{$parent.$parent.organization.personal.rating.employee}}">\n                                            <div class="rating-employee-item-user-info">\n                                                <div class="rating-employee-item-user-name">{{getEmployeeName(employee)}}</div>\n                                                <div class="rating-employee-item-user-position">{{employee.position}}</div>\n                                            </div>\n                                        </div>\n                                        <div class="flex flex-column">\n                                            <div class="rating-employee-item__ratings vh">\n                                                <div class="vh-svg-preload"></div>\n                                                <div class="rating-employee-item__ratings-star vh"\n                                                     ng-repeat="item in employee.starts"\n                                                     ng-class="{\'rating-employee-item__ratings-star-select\': item.select || item.hover}"\n                                                     alt="{{item.id}} звезда"\n                                                     ng-click="selectStar(employee, item)"\n                                                     ng-mouseenter="hoverStar(employee, item, true)"\n                                                     ng-mouseleave="hoverStar(employee, item, false)"></div>\n                                            </div>\n                                            <div class="text-right rating-employee-item__ratings-text vh">\n                                                <div class="rating-employee-item__do-not-evaluate color" ng-click="resetStars(employee, employee.starts)">{{$parent.$parent.organization.personal.rating.noRate}}</div>\n                                            </div>\n                                        </div>\n                                        \n                                    </div>\n                                    \n                                    <div ng-if="employee.service.ServiceName" class="rating-employee-item-service-name before-icon vh">{{employee.service.ServiceName}}</div>\n                                    \n                                     <div class="compliments-item-compliments swiper-container" ng-show="employee.star && employee.star.id > 4">\n                                        <div class="compliments-item-compliments-header vh cml color">{{$parent.$parent.organization.personal.rating.addCompliment}}</div>\n                                        <div class="flex justify-between">\n                                    \n                                            <div ng-repeat="compliment in compliments"\n                                                 class="flex-auto tc compliments-itm"\n                                                 ng-init="initCompliment(compliment, $last)"\n                                                 ng-if="(employee.isAdmin ? compliment.position == \'admin\' : compliment.position == \'master\' ) || compliment.position == \'common\'"\n                                                 ng-click="employee.compliment = compliment"\n                                                 ng-class="{\'compliments-item-compliments-item-select\':employee.compliment === compliment}">\n                                                <div class="compliments-item-compliments-item vh">\n                                                    <div class="compliments-item-compliments-item-icon compliment-master" ng-style="{\'background-image\': \'url(\' + filePath + compliment.img + \')\'}"></div>\n                                                    <div class="compliments-item-compliments-item-name">{{compliment.name}}</div>\n                                                </div>\n                                            </div>\n                                    \n                                        </div>\n                                    </div>\n                                    \n                                    <div class="improve" ng-show="employee.star && employee.star.id < 5">\n                                        <div class="compliments-item-compliments-header vh color">{{$parent.$parent.organization.personal.rating.whatImprove}}</div>\n                                        <div class="improve-table">\n                                    \n                                            <div class="improve-row">\n                                                <div class="improve-cell"\n                                                     ng-repeat="improve in improves"\n                                                     ng-click="employee.compliment = improve"\n                                                     ng-if="(employee.isAdmin ? improve.position == \'admin\' : improve.position == \'master\' ) || improve.position == \'common\'"\n                                                     ng-class="{\'improve-cell-select\':employee.compliment === improve}">\n                                                    <div class="improve-cell-text border-color color">\n                                                        <div class="improve-cell-text-value vh">{{improve.name}}</div>\n                                                        <div class="improve-cell-text-animate background-color"></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                    \n                                        </div>\n                                    </div>\n                                </div>\n                                <button ng-show="showLoader" class="time-calculating-overlay color text-center"></button>\n                                \n                                <div class="compliments vh">\n                                    <div class="comment-visit rating-employee-padding vh">\n                                        <div class="vh-textarea-box">\n                                            <div class="input-effect">\n                                                <textarea class="vh-rating-textarea vh-rating-input has-content" auto-resize id="comment" maxlength="255" ng-model="commentVisit"></textarea>\n                                                <label class="color label" for="comment">{{$parent.organization.personal.rating.comment}}</label>\n                                                <span class="focus-border background-color"></span>\n                                            </div>\n                                        </div>\n                                        <button class="comment-visit-button button" onclick="window.MetrikaService.sendEvent(\'rate_click\')" ng-click="isSettingSomeRating(items) && sendAll()" ng-class="{\'comment-visit-button-disable\': !isSettingSomeRating(items)}">{{$parent.organization.personal.rating.button}}</button>\n                                    </div>\n                                </div>\n                            </div>\n                    \n                        </div>\n                    </div>\n            </div>',link:function($scope,$element,attr){}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("ratingVisit",["$http","settings","$route","Utils","$rootScope",function($http,settings,$route,Utils,$rootScope){return{template:'\n        <div>\n            <rating-visit-mobile class="mobile"></rating-visit-mobile>\n            <rating-visit-desktop class="desktop"></rating-visit-desktop>\n        </div>\n        ',replace:!0,scope:{visible:"=",titleText:"=",items:"=",visitId:"=",date:"="},link:function($scope,$element,attr){$scope.HOST=window.HOST,$scope.improves=[],$scope.compliments=[],$scope.showLoader=!0,$scope.mySwiper={},$scope.filePath=window.FILE_PATH,$scope.commentVisit="",$scope.templates={getTemplate:function(name){if(this[name])return this[name]()},compliment:function(){return($scope.MOBILE_APP?"":"/booking/")+"views/rating-employee/template-compliment.html"},improve:function(){return($scope.MOBILE_APP?"":"/booking/")+"views/rating-employee/template-improve.html"}},$scope.initEmployee=function(employee){employee.starts=[{id:1},{id:2},{id:3},{id:4},{id:5}]},$scope.resetStars=function(employee,starts){employee.star=!1,starts.forEach(function(s){s.select=!1,s.hover=!1})},$scope.sendAll=function(){var employees=$scope.items;$scope.$parent.showLoader=!0,$rootScope.$broadcast("closePushRatingModal",$scope.visitId),$scope.sendRatings(employees).then(function(){return $scope.sendCompliments(employees)}).finally(function(){$scope.$parent.showLoader=!1,$route.reload()})},$scope.selectStar=function(employee,star){employee.star=star,employee.compliment=null,employee.starts=employee.starts.map(function(s){return s.id<=star.id?s.select=!0:s.select=!1,s})},$scope.hoverStar=function(employee,star,status){employee.starts=employee.starts.map(function(s){return s.id<=star.id&&(s.hover=status),s})},$scope.isSettingAllRating=function(employees){var res=!0;return angular.forEach(employees,function(emp){emp.star||(res=!1)}),res},$scope.isSettingSomeRating=function(employees){var res=!1;return angular.forEach(employees,function(emp){emp.star&&(res=!0)}),res},$scope.close=function(){var body=$("body");body.removeAttr("style"),body.removeClass("ovh"),$scope.visible=!1,$scope.commentVisit="",$scope.showLoader=!1,$scope.items=[],$rootScope.$broadcast("closePushRatingModal",$scope.visitId)},$scope.$on("closeProfileRatingModal",function(){$scope.close()}),$scope.sendRatings=function(employees){var items={};if(angular.forEach(employees,function(empl){empl.star&&(items[empl.id]=empl.star.id)}),Object.keys(items).length<1)return new Promise(function(res,rej){rej("Пустые поля")});$scope.showLoader=!0;var arrMarksEmployees=[];for(var item in items)arrMarksEmployees.push({id:item,rating:items[item]});var promise=$http.post(window.HOST+"/booking/rating/saveRatings",{visitId:$scope.visitId,employees:arrMarksEmployees},{params:{orgid:settings.ORG_ID,networkid:settings.NETWORK_ID}});return promise.finally(function(){$scope.showLoader=!1}),promise},$scope.sendCompliments=function(items){var employees=[];angular.forEach(items,function(empl){empl.compliment&&employees.push({id:empl.id,ratingDescription:empl.compliment.alias})}),$scope.showLoader=!0;var prom=$http.post(window.HOST+"/booking/rating/saveRatingDescription",{visitId:$scope.visitId,commentVisit:$scope.commentVisit,employees:employees},{params:{networkid:settings.NETWORK_ID,orgid:settings.ORG_ID}});return prom.error(function(){alert("Ошибка соединения с сервером")}).finally(function(){$scope.close(),$route.reload()}),prom},$scope.initCompliments=function(compliments){angular.forEach(compliments,function(compliment){compliment=$scope.setPersonalCompliment(compliment),"compliment"!==compliment.type&&"common"!==compliment.type||$scope.compliments.push(compliment),"improve"!==compliment.type&&"common"!==compliment.type||$scope.improves.push(compliment)})},$scope.changeCompliment=function(employee,compliment){if(null===employee.compliment)employee.compliment=[],employee.compliment.push(compliment);else{var check=!1;angular.forEach(employee.compliment,function(employeeCompliment,key){employeeCompliment.alias===compliment.alias&&(check=!0,employee.compliment.splice(key,1))}),check||employee.compliment.push(compliment)}},$scope.setPersonalCompliment=function(compliment){if("ac"===window.LANGUAGE)switch(compliment.alias){case"master":compliment.name=$scope.$parent.organization.personal.compliments.comp1;break;case"obslushivanie":compliment.name=$scope.$parent.organization.personal.compliments.comp2;break;case"instruments":compliment.name=$scope.$parent.organization.personal.compliments.comp3;break;case"purity":compliment.name=$scope.$parent.organization.personal.compliments.comp4;break;case"best-service":compliment.name=$scope.$parent.organization.personal.compliments.comp5;break;case"knowledge-of-services-and-goods":compliment.name=$scope.$parent.organization.personal.compliments.comp6;break;case"professionalism":compliment.name=$scope.$parent.organization.personal.compliments.comp7;break;case"friendliness":compliment.name=$scope.$parent.organization.personal.compliments.comp8;break;case"tooling":compliment.name=$scope.$parent.organization.personal.compliments.comp9;break;case"job":compliment.name=$scope.$parent.organization.personal.compliments.comp10;break;case"service":compliment.name=$scope.$parent.organization.personal.compliments.comp11;break;case"bad-knowledge-of-services-and-goods":compliment.name=$scope.$parent.organization.personal.compliments.comp12}else switch(compliment.alias){case"real-professional":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp1;break;case"goodwill":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp2;break;case"excellent-advice":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp3;break;case"attention-to-the-patient":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp4;break;case"best-service":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp5;break;case"knowledge-of-services-and-goods":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp6;break;case"purity":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp7;break;case"professionalism":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp8;break;case"friendliness":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp9;break;case"bad-consult":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp10;break;case"bad-attention-to-the-patient":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp11;break;case"service":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp12;break;case"bad-knowledge-of-services-and-goods":compliment.name=$scope.$parent.organization.personal.compliments_zr.comp13}return compliment},$scope.employeeHasCompliment=function(employee,compliment){var check=!1;return Array.isArray(employee.compliment)&&angular.forEach(employee.compliment,function(employeeCompliment){employeeCompliment.alias===compliment.alias&&(check=!0)}),check},$scope.initSizeWindow=function(){window.innerWidth>=769?($scope.desktop=!0,$scope.mobile=!1):($scope.mobile=!0,$scope.desktop=!1)},$scope.getEmployeeName=function(employee){return employee.lastname.length?employee.lastname+" "+employee.firstname:employee.firstname},$scope.initSizeWindow(),$scope.$on("getNetworkDone",function(){$http.get((window.MOBILE_APP?"":"/booking/")+"data/"+window.LANGUAGE+"/compliments_new.json").success($scope.initCompliments).finally(function(){$scope.showLoader=!1})})}}}]);var BookingAppDirectives=angular.module("BookingApp.directives");BookingAppDirectives.directive("ratingVisitMobile",["$http","settings",function($http,settings){return{template:'\n            <div ng-show="visible">\n                    <style ng-if="visible">\n                        body{\n                            overflow:hidden;\n                        }\n                    </style>\n                    <style>\n                        .vh-svg-preload {\n                           background-image: url({{filePath}}images/star-enabled.svg);\n                           opacity: 0;    \n                        }\n                    \n                        .rating-employee-item__ratings-star.vh {\n                            background-image: url({{filePath}}images/star-disabled.svg);\n                        }\n                        \n                        .rating-employee-item__ratings-star.vh.rating-employee-item__ratings-star-select {\n                            background-image: url({{filePath}}images/star-enabled.svg);\n                        }\n                    </style>\n                    <div class="rating-employee" ng-class="{\'slideInUp\' : showRatings}">\n                        <div class="rating-employee-wrapper vh" context-panel>\n                            <div class="rating-employee-header">\n                                <div class="rating-employee-header-title">{{titleText}}</div>\n                                <div class="rating-employee-header-date">{{date | date :  "d MMMM yyyy" }}</div>\n                                <div class="rating-employee-header-close vh close color icomoon" ng-click="close()" title="{{$parent.organization.personal.rating.close}}"></div>\n                            </div>\n                    \n                            \n                           \n                            <div class="rating-employee-item-wrapper">\n                                <div class="rating-employee-item" ng-repeat="employee in items" ng-init="initEmployee(employee)" context-panel>\n                                    <div class="rating-employee-item-user">\n                                        <img class="rating-employee-item-user-logo"  \n                                            fallback-src="{{HOST + \'/booking/images/default-employee.png\'}}" \n                                            ng-src="{{employee.photo ? HOST + employee.photo : HOST + \'/booking/images/default-employee.png\'}}" alt="{{$parent.$parent.organization.personal.rating.employee}}" title="{{$parent.$parent.organization.personal.rating.employee}}">\n                                        <div class="rating-employee-item-user-info">\n                                            <div class="rating-employee-item-user-name">{{getEmployeeName(employee)}}</div>\n                                            <div class="rating-employee-item-user-position">{{employee.position}}</div>\n                                        </div>\n                                    </div>\n                                    <div ng-if="employee.service.ServiceName" class="rating-employee-item-service-name vh before-icon">{{employee.service.ServiceName}}</div>\n                                    <div class="rating-employee-item__ratings vh">\n                                        <div class="vh-svg-preload"></div>\n                                        <div class="rating-employee-item__ratings-star vh"\n                                             ng-repeat="item in employee.starts"\n                                             alt="{{item.id}} звезда"\n                                             ng-class="{\'rating-employee-item__ratings-star-select\': item.select}"\n                                             ng-click="selectStar(employee, item)"></div>\n                                    </div>\n                                    <div class="text-center">\n                                        <div class="rating-employee-item__do-not-evaluate color" ng-click="resetStars(employee, employee.starts)">{{$parent.$parent.organization.personal.rating.noRate}}</div>\n                                    </div>\n                                     <div class="compliments-item-compliments swiper-container vh-swiper-container" ng-if="employee.star && employee.star.id > 4">\n                                        <div class="compliments-item-compliments-header color">{{$parent.$parent.organization.personal.rating.addCompliment}}</div>\n                                        <div class="swiper-wrapper">\n                                    \n                                            <div class="swiper-slide vh" ng-repeat="compliment in compliments"\n                                                ng-init="initCompliment(compliment, $last)"\n                                                 ng-if="(employee.isAdmin ? compliment.position == \'admin\' : compliment.position == \'master\' ) || compliment.position == \'common\'"\n                                                 ng-click="employee.compliment = compliment">\n                                                <div class="compliments-item-compliments-item vh"\n                                                     ng-class="{\'compliments-item-compliments-item-select\':employee.compliment === compliment}">\n                                                    <div class="compliments-item-compliments-item-icon compliment-master" ng-style="{\'background-image\': \'url(\' + filePath + compliment.img + \')\'}"></div>\n                                                    <div class="compliments-item-compliments-item-name vh">{{compliment.name}}</div>\n                                                </div>\n                                                \n                                                <script ng-if="$index === 3 || $last">\n                                                    new Swiper(\'.vh-swiper-container\', {\n                                                        slidesPerView: 4,\n                                                        spaceBetween: 0,\n                                                        freeMode: true,\n                                                    });\n                                                <\/script>\n                                            </div>\n                                    \n                                        </div>\n                                    </div>\n                                    <div class="improve" ng-show="employee.star && employee.star.id < 5">\n                                        <div class="compliments-item-compliments-header color">{{$parent.$parent.organization.personal.rating.whatImprove}}</div>\n                                        <div class="improve-table">\n                                            <div class="improve-row" >\n                                                <div class="improve-cell"\n                                                     ng-repeat="improve in improves"\n                                                     ng-click="employee.compliment = improve"\n                                                     ng-if="(employee.isAdmin ? improve.position == \'admin\' : improve.position == \'master\' ) || improve.position == \'common\'"\n                                                     ng-class="{\'improve-cell-select\':employee.compliment === improve}">\n                                                    <div class="improve-cell-text border-color color">\n                                                        <div class="improve-cell-text-value vh">{{improve.name}}</div>\n                                                        <div class="improve-cell-text-animate background-color"></div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="compliments vh">\n                                <div class="comment-visit rating-employee-padding">\n                                    <div class="comment-visit-title color">{{$parent.organization.personal.rating.comment}}</div>\n                                    <textarea name="" id="" rows="5" maxlength="255" class="comment-visit-textarea" ng-model="$parent.commentVisit" placeholder={{$parent.$parent.organization.personal.rating.comment}}></textarea>\n                                    <button class="comment-visit-button button" onclick="window.MetrikaService.sendEvent(\'rate_click\')" ng-click="isSettingSomeRating(items) && sendAll()" ng-class="{\'comment-visit-button-disable\': !isSettingSomeRating(items)}">{{$parent.$parent.organization.personal.rating.button}}</button>\n                                </div>\n                            </div>\n                            <button ng-show="showLoader" class="time-calculating-overlay color text-center"></button>\n                        </div>\n                    </div>\n            </div>',replace:!0,scope:!0,link:function($scope,$element,attr){}}}]);